"use strict";(self.webpackChunkstandalone_copilot=self.webpackChunkstandalone_copilot||[]).push([[7845],{17548:(e,t,i)=>{i.d(t,{z:()=>r});var n=i(18763);const r=e=>{var t,i,r,a;return{appEligibilityInformation:e.appEligibilityInformation,composeExtension:void 0!==e.composeExtensions&&e.composeExtensions.length>0?{botId:e.composeExtensions[0].botId,type:e.composeExtensions[0].type,commands:o(e)}:void 0,copilotAgents:{customEngineAgents:(null===(i=null===(t=e.copilotExtensions)||void 0===t?void 0:t.customEngineCopilots)||void 0===i?void 0:i.length)?e.copilotExtensions.customEngineCopilots.map((e=>({id:new n.k(e.id),type:e.type}))):[]},connector:void 0!==e.connectors&&e.connectors.length>0?{connectorId:e.connectors[0].connectorId,scopes:e.connectors[0].scopes,configurationUrl:e.connectors[0].configurationUrl}:void 0,devicePermissions:e.devicePermissions||[],id:e.appId,isFullTrust:e.isFullTrustApp||!1,isMicrosoftOwned:e.isMicrosoftOwned||!1,isLOB:!!e.tenantId,pages:{configurable:(null===(r=e.galleryTabs)||void 0===r?void 0:r.map((e=>({configurationUrl:e.configurationUrl}))))||[],static:(null===(a=e.staticTabs)||void 0===a?void 0:a.map((e=>({entityId:e.entityId,contentUrl:e.contentUrl,name:e.name}))))||[]},showLoadingIndicator:e.showLoadingIndicator||!1,validDomains:e.validDomains||[],manifestVersion:e.manifestVersion,version:e.version,webApplicationInfo:e.webApplicationInfo}},o=e=>{var t;return(null===(t=e.composeExtensions[0].commands)||void 0===t?void 0:t.map((e=>({id:e.id,parameterNames:e.parameters?e.parameters.map((e=>e.name)):[]}))))||[]}},7237:(e,t,i)=>{i.d(t,{Q:()=>o});var n=i(18763);const r=["conversations","about"],o=e=>{var t,i,n,o;return{appEligibilityInformation:e.titleDefinition.appEligibilityInformation,composeExtension:void 0!==e.titleDefinition.elementDefinitions.composeExtensions&&e.titleDefinition.elementDefinitions.composeExtensions.length>0?{botId:e.titleDefinition.elementDefinitions.composeExtensions[0].botId,type:a(e.titleDefinition.elementDefinitions.composeExtensions[0].composeExtensionType),commands:s(e)}:void 0,copilotAgents:{customEngineAgents:l(e.titleDefinition.elementDefinitions)},connector:void 0!==e.titleDefinition.elementDefinitions.connectors&&e.titleDefinition.elementDefinitions.connectors.length>0?{connectorId:e.titleDefinition.elementDefinitions.connectors[0].connectorId,scopes:e.titleDefinition.elementDefinitions.connectors[0].scopes,configurationUrl:e.titleDefinition.elementDefinitions.connectors[0].configurationUrl}:void 0,devicePermissions:e.titleDefinition.devicePermissions||[],id:e.appId||e.titleId,isFullTrust:null!==(t=e.titleDefinition.isFullTrust)&&void 0!==t&&t,isMicrosoftOwned:null!==(i=e.titleDefinition.isMicrosoftOwned)&&void 0!==i&&i,isLOB:"Tenant"===e.titleDefinition.scope,manifestVersion:e.titleDefinition.manifestVersion,pages:{configurable:(null===(n=e.titleDefinition.elementDefinitions.configurableTabs)||void 0===n?void 0:n.map((e=>({configurationUrl:e.configurationUrl}))))||[],static:(null===(o=e.titleDefinition.elementDefinitions.staticTabs)||void 0===o?void 0:o.filter((e=>e.name&&!r.includes(e.name))).map((e=>({contentUrl:e.contentUrl,entityId:e.entityId,name:e.name}))))||[]},showLoadingIndicator:e.titleDefinition.showLoadingIndicator||!1,validDomains:e.titleDefinition.validDomains||[],version:e.titleDefinition.version,webApplicationInfo:e.titleDefinition.webApplicationInfo}},a=e=>{switch(e){case"botBased":return"BotBased";case"apiBased":return"ApiBased";default:return}},s=e=>{var t;return(null===(t=e.titleDefinition.elementDefinitions.composeExtensions[0].commands)||void 0===t?void 0:t.map((e=>({id:e.id,parameterNames:e.parameters?e.parameters.map((e=>e.name)):[]}))))||[]};function l(e){var t,i;const{copilotAgents:r,copilotExtensions:o}=e;return(null===(t=null==r?void 0:r.customEngineAgents)||void 0===t?void 0:t.length)?r.customEngineAgents.map((e=>({id:new n.k(e.id),type:e.type}))):(null===(i=null==o?void 0:o.customEngineCopilots)||void 0===i?void 0:i.length)?o.customEngineCopilots.map((e=>({id:new n.k(e.id),type:e.type}))):[]}},17282:(e,t,i)=>{i.d(t,{n:()=>F});var n,r,o,a,s,l,d=i(35574),c=i(17576),p=i(65964),u=i(69537),h=i(79236),g=i(75973),v=i(23404),m=i(57532);!function(e){e.Unknown="Unknown",e.Windows="Windows",e.iOS="iOS",e.Android="Android",e.Linux="Linux",e.tvOS="tvOS",e.MacOS="MacOS"}(n||(n={})),function(e){e.Unknown="Unknown",e.EXO="EXO",e.SPO="SPO",e.OXO="OXO",e.MileIQ="MileIQ",e.AFS="AFS",e.Teams="Teams",e.Stream="Stream",e.ODB="ODB",e.MicrosoftPowerBI="MicrosoftPowerBI",e.Yammer="Yammer"}(r||(r={})),function(e){e.NotSpecified="NotSpecified",e.User="User",e.System="System"}(o||(o={})),function(e){e.Unknown="Unknown",e.Anonymous="Anonymous",e.AAD="AAD",e.MSA="MSA",e.Self="Self"}(a||(a={})),function(e){e.Unknown="Unknown",e.AccessControlData="AccessControlData",e.CustomerContent="CustomerContent",e.EUII="EUII",e.OII="OII",e.AccountData="OII",e.SystemMetaData="SystemMetaData"}(s||(s={})),function(e){e.ApplicationEngaged="ApplicationEngaged"}(l||(l={}));class S{constructor(e,t,i){var n,r,s;this.appSdkHost=e,this.hubServices=t,this.appContext=i,this.getDefaultSignalAuthToken=()=>(0,c.__awaiter)(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.hubServices.authenticationService)||void 0===e?void 0:e.acquireToken))throw new Error("Cancelled since service is not available.");const t=yield this.hubServices.authenticationService.acquireToken(S.DEFAULT_SIGS_RESOURCE_URL,void 0,!0);if(t&&t.token)return t.token;throw new Error("Empty token response.")})),this.delay=e=>new Promise((t=>{var i;setTimeout(t,Math.pow(null!==(i=this.jestDelay)&&void 0!==i?i:100,e))}));const l=this.appSdkHost.getAppDefinition();this.actorInfo={ActorId:a.Self,ActorIdType:a.Self,ActorType:o.User,AadTenantId:a.Self},this.applicationInfo={AppName:"",AadAppId:null!==(n=null==l?void 0:l.id)&&void 0!==n?n:"",Workload:this.getWorkLoad(null===(r=this.appContext)||void 0===r?void 0:r.app.host.name)},this.deviceInfo={Os:this.getOs(),UserAgent:window.navigator.userAgent},this.commonCustomProperties={HubName:null===(s=this.appContext)||void 0===s?void 0:s.app.host.name,MetaOSHubSDKVersion:p.eO}}createSignal(e){return{SignalType:e.signalType,Compliance:s.CustomerContent,CV:this.appContext.app.sessionId,StartTime:this.getDateTime(e.startTime),EndTime:this.getDateTime(e.endTime),Application:Object.assign({},this.applicationInfo),Actor:Object.assign({},this.actorInfo),Device:Object.assign({},this.deviceInfo),CustomProperties:Object.assign(Object.assign({},this.commonCustomProperties),e.customProperties)}}getDateTime(e){return e&&e>0?new Date(e):new Date}getWorkLoad(e){switch(e){case v.UH.office||v.UH.outlookWin32||v.UH.office:return r.OXO;case v.UH.teams||v.UH.teamsModern:return r.Teams;default:return r.Unknown}}getOs(){let e="Unknown";if(window&&window.navigator.userAgent){let t=window.navigator.userAgent;-1!=t.indexOf("Windows")?e="Windows":-1!=t.indexOf("Mac OS")?e="MacOS":-1!=t.indexOf("Android")?e="Android":-1!=t.indexOf("Linux")?e="Linux":/iPad|iPhone|iPod/.test(t)&&(e="iOS")}return e}sendSignal(e,t){return new Promise(((i,n)=>(0,c.__awaiter)(this,void 0,void 0,(function*(){if(t)i(this.postSignalWithRetry(e,t,1));else try{const t=yield this.getDefaultSignalAuthToken();i(this.postSignalWithRetry(e,t,1))}catch(e){n(e)}}))))}postSignalWithRetry(e,t,i){return i>S.RETRY_LIMIT?Promise.reject("Retry Limit reached. Unable to send Signal."):fetch(S.SIGS_ENDPOINT,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json","X-SignalInstanceId":e.CV,Authorization:"Bearer "+t}}).catch((e=>Promise.reject(e))).then((n=>(0,c.__awaiter)(this,void 0,void 0,(function*(){return n&&n.ok?Promise.resolve(e.CV):n&&S.RETRY_CODES.has(n.status)?(yield this.delay(i),this.postSignalWithRetry(e,t,++i)):Promise.reject(n)}))))}}function f(e,t,i){return(0,c.__awaiter)(this,void 0,void 0,(function*(){try{let i=yield e.getAppContext();if(i.page.frameContext!=v.E2.authentication){const n=new S(e,t,i),r=n.createSignal({signalType:l.ApplicationEngaged,startTime:e.getUserClickTime(),endTime:Date.now()});let o=yield n.sendSignal(r);e.getLogger().log(h.$.Debug,"sendAppEngageSignal","Successfully posted the signal",o)}}catch(t){let n=t;if("status"in t){n=t.status+"";const e=null==i?void 0:i.createScenario("sigsSendSignalFailure");null==e||e.fail(n)}e.getLogger().log(h.$.Error,"sendAppEngageSignal","Error occurred while sending substrate signal",n)}}))}S.SIGS_ENDPOINT="https://substrate.office.com/sigsapi/v1.0/Me/Signals",S.RETRY_LIMIT=2,S.RETRY_CODES=new Set([503]),S.DEFAULT_SIGS_RESOURCE_URL="https://outlook.office.com";var A=i(46467),C=i(19141),I=i(18549),y=i(66310),E=i(90850),b=i(51144);function R(e,t){const i=Object.assign({},e);return t.forEach((e=>delete i[e])),i}const T=[{versionToDowngradeFrom:4,downgradeToPreviousVersion:e=>{var t,i,n,r,o;return{apiVersion:3,hostVersionsInfo:e.hostVersionsInfo,supports:Object.assign(Object.assign({},e.supports),{dialog:e.supports.dialog?{url:(null===(t=e.supports)||void 0===t?void 0:t.dialog.url)?(null===(n=null===(i=e.supports)||void 0===i?void 0:i.dialog.url)||void 0===n?void 0:n.bot)?{bot:{}}:{}:void 0,card:null===(r=e.supports.dialog)||void 0===r?void 0:r.card,update:null===(o=e.supports.dialog)||void 0===o?void 0:o.update}:void 0})}}},{versionToDowngradeFrom:3,downgradeToPreviousVersion:e=>({apiVersion:2,hostVersionsInfo:e.hostVersionsInfo,supports:R(e.supports,["clipboard","webStorage"])})},{versionToDowngradeFrom:2,downgradeToPreviousVersion:e=>{var t,i,n,r,o;return{apiVersion:1,supports:Object.assign(Object.assign({},e.supports),{dialog:e.supports.dialog?{bot:null===(n=null===(i=null===(t=e.supports)||void 0===t?void 0:t.dialog)||void 0===i?void 0:i.url)||void 0===n?void 0:n.bot,card:null===(r=e.supports.dialog)||void 0===r?void 0:r.card,update:null===(o=e.supports.dialog)||void 0===o?void 0:o.update}:void 0})}}}];var w=i(669);const D="App failed to call initialize(). Immediate or Loading Screen apps are required to call app.initialize().",k="App failed to call notifySuccess(). Loading screen apps are required to call app.notifySuccess() when the app is loaded.";var x;!function(e){e[e.initialAppInitializationTimerExpiration=1]="initialAppInitializationTimerExpiration",e[e.extendedAppInitializationTimerExpiration=2]="extendedAppInitializationTimerExpiration"}(x||(x={}));class O extends b.R{constructor(e,t,i,n,r,o,a){var s,l,c,g,v,m,S;super(e,i),this.appSdkHost=e,this.hubServices=t,this.telemetryService=i,this.hostVersionsInfo=n,this.usingCachedApp=r,this.isNAAChannelRecommended=o,this.originsToBlock=a,this.initializationStatusReported=!1,this.appInitializationScenarioAlreadyStopped=!1,this.getOCDIWarning=()=>{var e;const t=null===(e=this.telemetryService)||void 0===e?void 0:e.getAppSdkVersion();return(0,y.AU)(window.location.href)&&t&&(0,y.Di)(t,p.DX)?p.f:""},this.startTimerToWaitForInitializeCallFromApp=()=>this.usingCachedApp?window.setTimeout((()=>{var e,t,i;this.failAppInitializationScenario("Cached app load timed out"),null===(e=this.extendedAppInitializationScenario)||void 0===e||e.fail("Cached app load timed out"),this.appSdkHost.setAppInitInfo({state:u.Jz.Failed,reason:p.Af.CachedAppLoadTimedOut,appSdkVersion:null===(t=this.telemetryService)||void 0===t?void 0:t.getAppSdkVersion()}),null===(i=this.hubServices.logger)||void 0===i||i.log(h.$.Error,"Error Screen Reason",k+this.getOCDIWarning())}),this.timeToWaitForStateTransitionsInMs):this.isLoadingScreenApp()?window.setTimeout((()=>{this.onInitializeCallTimedOutForLoadingScreenApp()}),this.timeToWaitForStateTransitionsInMs):window.setTimeout((()=>{this.onInitializeCallTimedOutForImmediateApp()}),this.timeToWaitForStateTransitionsInMs),this.stopAppInitializationScenario=()=>{var e;this.stopInitializeStateTransitionTimer(),null===(e=this.appInitializationScenario)||void 0===e||e.stop(),this.appInitializationScenarioAlreadyStopped=!0},this.failAppInitializationScenario=(e,t)=>{var i;this.stopInitializeStateTransitionTimer(),null===(i=this.appInitializationScenario)||void 0===i||i.fail(e,t)},this.stopInitializeStateTransitionTimer=()=>{window.clearTimeout(this.initStateTransitionTimerId)},this.recordInitializationDoubleStopAttempt=e=>{const t=this.telemetryService.createScenario("initializationDoubleStopAttempt");t.addOrUpdateActivityDataField("doubleInitEndAttemptCodeLocation",e),t.stop()},this.appSdkHost.startAppInitializationScenario(),this.appInitializationScenario=null===(s=this.appSdkHost)||void 0===s?void 0:s.getAppInitializationScenario(),null===(l=this.appInitializationScenario)||void 0===l||l.markPhase("ClickToBeginLoad"),this.logTelemetryForAppSdkLoaded(),this.isShowLoadingIndicatorEnabled=(null===(c=e.getAppDefinition())||void 0===c?void 0:c.showLoadingIndicator)||!1,this.forceAppToBeLoadingScreenApp=null!==(g=(0,d.eZ)().resetTimerWhenInitCalledAndWaitForNotifySuccess)&&void 0!==g&&g,null===(v=this.appInitializationScenario)||void 0===v||v.addOrUpdateActivityDataField("resetTimerFlag",this.forceAppToBeLoadingScreenApp),this.recordCachingServiceState();const f=null===(m=this.appSdkHost.getAppDefinition())||void 0===m?void 0:m.id,A=null===(S=this.telemetryService)||void 0===S?void 0:S.enableExtendedInitializationTracking,C=f&&p.pm.has(f);(A||C)&&(this.extendedAppInitializationScenario=this.createExtendedAppInitTelemetry(f)),this.timeToWaitForStateTransitionsInMs=this.isLoadingScreenApp()?this.getTimeoutValueForLoadingScreenAppInMills():this.getTimeoutValueForImmediateAppInMills(),this.initStateTransitionTimerId=this.startTimerToWaitForInitializeCallFromApp()}recordCachingServiceState(){var e,t;null===(e=this.appInitializationScenario)||void 0===e||e.addOrUpdateActivityDataField("isLifecycleServiceProvided",!!this.hubServices.lifecycleService),null===(t=this.appInitializationScenario)||void 0===t||t.addOrUpdateActivityDataField("isCacheManagementServiceProvided",!!this.hubServices.cacheManagementService)}createExtendedAppInitTelemetry(e){var t;const i=null===(t=this.telemetryService)||void 0===t?void 0:t.createScenario("appInitializationExtended",e);return null==i||i.markPhase("ClickToBeginLoad"),null==i||i.addOrUpdateActivityDataField("resetTimerFlag",this.forceAppToBeLoadingScreenApp),i}initHandlers(){this.registerHandler(p.tz.initialize,this.onInitializeCalled),this.registerHandler(p.tz.getContext,this.getContext,{errorCallback:this.onGetContextError}),this.registerHandler(p.tz.readyToUnload,this.readyToUnload),this.registerHandler(p.tz.appInitialization.appLoaded,this.onNotifyAppLoadedCalled),this.registerHandler(p.tz.appInitialization.success,this.onNotifySuccessCalled),this.registerHandler(p.tz.appInitialization.failure,this.onNotifyFailureCalled),this.registerHandler(p.tz.appInitialization.expectedFailure,this.onNotifyExpectedFailureCalled)}getTimeoutValueForImmediateAppInMills(){var e;const t=function(){const e=(0,d.eZ)().overrideForEachInitStateChangeTimeoutsInMs;return null!=e?e:3e4}();return null!=(0,d.eZ)().overrideForEachInitStateChangeTimeoutsInMs&&(null===(e=this.hubServices.logger)||void 0===e||e.log(h.$.Info,"Feature Flag overrideForEachInitStateChangeTimeoutsInMs",`Using timeout for immediate app: ${t} milliseconds`)),t}getTimeoutValueForLoadingScreenAppInMills(){var e,t;const i=function(){const e=(0,d.eZ)().extendedAppLoadTimeoutInMillis,t=(0,d.eZ)().overrideForEachInitStateChangeTimeoutsInMs;return null!=t?t:null!=e?e:45e3}();return null!=(0,d.eZ)().overrideForEachInitStateChangeTimeoutsInMs&&(null===(e=this.hubServices.logger)||void 0===e||e.log(h.$.Info,"Feature Flag overrideForEachInitStateChangeTimeoutsInMs",`Using timeout for loading screen app: ${i} milliseconds`)),null!=(0,d.eZ)().extendedAppLoadTimeoutInMillis&&(null===(t=this.hubServices.logger)||void 0===t||t.log(h.$.Info,"Feature Flag extendedAppLoadTimeoutInMillis",`Using timeout for loading screen app: ${i} milliseconds`)),i}isLoadingScreenApp(){return this.forceAppToBeLoadingScreenApp||this.isShowLoadingIndicatorEnabled}updateTelemetryDataFieldAppSdkVersion(e,t){t.forEach((t=>{null==t||t.addOrUpdateActivityDataField(m.u7.APPSDK_VERSION_FIELD_NAME,e)}))}updateTelemetryDataFieldAppSdkApiVersionTag(e,t,i){const n=e.data.apiVersionTag;i.forEach((e=>{null==e||e.addOrUpdateActivityDataField(m.u7.APPSDK_API_VERSION_TAG_FIELD_NAME,m.u7.getApiVersionTagForTelemetry(n,t))}))}updateTelemetryDataFieldUsingCachedApp(e){e.forEach((e=>{var t;null==e||e.addOrUpdateActivityDataField(m.u7.CACHEDAPP_IND_FIELD_NAME,null!==(t=this.usingCachedApp)&&void 0!==t&&t)}))}updateAppInitializationScenarioFields(e,t){this.updateTelemetryDataFieldAppSdkVersion(e,[this.appInitializationScenario,this.extendedAppInitializationScenario]),this.updateTelemetryDataFieldAppSdkApiVersionTag(t,e,[this.appInitializationScenario,this.extendedAppInitializationScenario]),this.updateTelemetryDataFieldUsingCachedApp([this.appInitializationScenario,this.extendedAppInitializationScenario])}markTelemetryForAppInitializationPhases(e,t,i){var n,r;null===(n=this.appInitializationScenario)||void 0===n||n.markPhase(e),null===(r=this.extendedAppInitializationScenario)||void 0===r||r.markPhase(e),this.telemetryService.setAppSdkVersion(t),this.updateAppInitializationScenarioFields(t,i)}trackMessageDelayForAppInitAPIs(e,t){var i,n,r,o;if(g.kh.has(e)&&t){const a=(0,E.wF)(e,t),s=g.kh.get(e);if(!s)return;(0,E.e5)(E.Ct.Start,`${s}MessageProcessTime_ms`),null===(n=null===(i=this.appInitializationScenario)||void 0===i?void 0:i.trackMessageDelay)||void 0===n||n.call(i,s,t,a),null===(o=null===(r=this.extendedAppInitializationScenario)||void 0===r?void 0:r.trackMessageDelay)||void 0===o||o.call(r,s,t,a)}}onInitializeCalled(e,t,i,n){var r,o,a,s,l,c;this.markTelemetryForAppInitializationPhases("BeginLoadToInitialized",t,e);const g=null===(r=this.originsToBlock)||void 0===r?void 0:r.isOriginBlocked(new I.l(null!==(a=null===(o=this.appDefinition)||void 0===o?void 0:o.id)&&void 0!==a?a:""),n||[]);if(this.originsToBlock&&!(null==g?void 0:g.isOriginValid))return this.onNotifyFailureCalled(new MessageEvent(""),p.Af.Validation_InvalidDomains,null==g?void 0:g.message),(0,w.PR)(null==g?void 0:g.message);i||(i=1),this.appSdkHost.setInitialized(!0);const v=this.appSdkHost.getHubInfo();let m=this.constructHubConfig(v);var S;(null===(s=m.hostVersionsInfo)||void 0===s?void 0:s.appEligibilityInformation)&&(null===(l=m.supports.copilot)||void 0===l?void 0:l.eligibility)&&(null===(c=this.hubServices.logger)||void 0===c||c.log(h.$.Warn,"AppEligibilityInformation from host","Host has provided appEligibilityInformation AND ICopilotEligibilityService. Only one of these should be provided.")),S=i<m.apiVersion?((e,t,i=T)=>{if(e.apiVersion<=t)return e;let n=e;for(let e of i)if(n.apiVersion===e.versionToDowngradeFrom&&(n=e.downgradeToPreviousVersion(n)),n.apiVersion<=t)break;return n})(m,i):m;const A=[this.appSdkHost.getFrameContext(),this.appSdkHost.getHubInfo().clientType,"2.0.0",JSON.stringify(S)];return(0,E.e5)(E.Ct.End,E.Z1.InitializeMessageProcessTime),this.isLoadingScreenApp()?(this.stopInitializeStateTransitionTimer(),this.initStateTransitionTimerId=window.setTimeout((()=>{var e,t,i,n;this.appInitializationScenarioAlreadyStopped?(this.recordInitializationDoubleStopAttempt(x.extendedAppInitializationTimerExpiration),this.appSdkHost.setAppInitInfo({state:u.Jz.Loaded,appSdkVersion:null===(e=this.telemetryService)||void 0===e?void 0:e.getAppSdkVersion()})):(this.failAppInitializationScenario(k),null===(t=this.extendedAppInitializationScenario)||void 0===t||t.fail(k),this.appSdkHost.setAppInitInfo({state:u.Jz.Failed,reason:p.Af.AppInitTimeout,appSdkVersion:null===(i=this.telemetryService)||void 0===i?void 0:i.getAppSdkVersion()})),null===(n=this.hubServices.logger)||void 0===n||n.log(h.$.Error,"Error Screen Reason",k+this.getOCDIWarning())}),this.timeToWaitForStateTransitionsInMs)):(this.appSdkHost.setAppInitInfo({state:u.Jz.Loaded,appSdkVersion:t}),this.stopAppInitializationScenario(),(0,d.eZ)().createAndSendSignalsToSubstrate&&f(this.appSdkHost,this.hubServices,this.telemetryService)),(0,w.PR)(A)}getUpdatedHostVersionsInfo(){var e,t,i,n;const r=null!==(t=null===(e=this.appDefinition)||void 0===e?void 0:e.appEligibilityInformation)&&void 0!==t?t:null===(i=this.hostVersionsInfo)||void 0===i?void 0:i.appEligibilityInformation;return!(0,A.wr)(this.appDefinition)&&r?(null===(n=this.hubServices.logger)||void 0===n||n.log(h.$.Warn,"AppEligibilityInformation from host","App is not a copilot app, so `hostVersionInfo.appEligibilityInformation` is removed before sending the object to teams-js."),Object.assign(Object.assign({},this.hostVersionsInfo),{appEligibilityInformation:void 0})):Object.assign(Object.assign({},this.hostVersionsInfo),{appEligibilityInformation:r})}getContext(){return(0,c.__awaiter)(this,void 0,void 0,(function*(){const e=(0,A.ut)(yield this.appSdkHost.getAppContext(),this.appDefinition);return(0,w.PR)(e)}))}onGetContextError(e,t){return null==t||t.fail((0,w.oE)(e)),(0,w.PR)({})}onNotifyAppLoadedCalled(e,t){var i;return(0,c.__awaiter)(this,void 0,void 0,(function*(){return this.markTelemetryForAppInitializationPhases("InitializedToAppLoadedInvoked",t,e),this.appSdkHost.setAppInitInfo({state:u.Jz.Loaded,appSdkVersion:null===(i=this.telemetryService)||void 0===i?void 0:i.getAppSdkVersion()}),(0,E.e5)(E.Ct.End,E.Z1.AppLoadedMessageProcessTime),w.f1}))}onNotifySuccessCalled(e,t){var i,n;return(0,c.__awaiter)(this,void 0,void 0,(function*(){return this.markInitializationStatusAsReported()?(this.appSdkHost.setAppInitInfo({state:u.Jz.Loaded,appSdkVersion:null===(i=this.telemetryService)||void 0===i?void 0:i.getAppSdkVersion()}),(this.isLoadingScreenApp()||this.usingCachedApp)&&((0,d.eZ)().createAndSendSignalsToSubstrate&&f(this.appSdkHost,this.hubServices,this.telemetryService),this.telemetryService.setAppSdkVersion(t),this.updateAppInitializationScenarioFields(t,e),(0,E.e5)(E.Ct.End,E.Z1.SuccessMessageProcessTime),this.stopAppInitializationScenario()),null===(n=this.extendedAppInitializationScenario)||void 0===n||n.stop(),(0,w.PR)([null])):(0,w.PR)([null])}))}onNotifyFailureCalled(e,t,i){var n,r;return(0,c.__awaiter)(this,void 0,void 0,(function*(){return this.markInitializationStatusAsReported()?(this.isShowLoadingIndicatorEnabled&&((0,E.e5)(E.Ct.End,E.Z1.FailureMessageProcessTime),this.failAppInitializationScenario(t,i)),this.appSdkHost.setAppInitInfo({state:u.Jz.Failed,reason:t,appSdkVersion:null===(n=this.telemetryService)||void 0===n?void 0:n.getAppSdkVersion()}),null===(r=this.extendedAppInitializationScenario)||void 0===r||r.fail(t,i),w.f1):w.f1}))}onNotifyExpectedFailureCalled(e,t,i){var n,r;return(0,c.__awaiter)(this,void 0,void 0,(function*(){if(!this.markInitializationStatusAsReported())return w.f1;this.appSdkHost.setAppInitInfo({state:u.Jz.Loaded,appSdkVersion:null===(n=this.telemetryService)||void 0===n?void 0:n.getAppSdkVersion()});const e="Expected."+t;return this.isShowLoadingIndicatorEnabled&&((0,E.e5)(E.Ct.End,E.Z1.ExpectedFailureMessageProcessTime),this.failAppInitializationScenario(e,i)),null===(r=this.extendedAppInitializationScenario)||void 0===r||r.fail(e,i),w.f1}))}markInitializationStatusAsReported(){return this.initializationStatusReported?(this.cleanup(),!1):(this.initializationStatusReported=!0,!0)}readyToUnload(){return(0,c.__awaiter)(this,void 0,void 0,(function*(){return this.appSdkHost.setAppInitInfo({state:u.Jz.Unloaded}),w.f1}))}cleanup(){this.stopInitializeStateTransitionTimer()}isTeamsCoreSupported(e){return!!this.isTeamsHub(e)||this.isLifeCycleImplemented()&&(0,A.wr)(this.appDefinition)}constructHubConfig(e){var t,i,n,r,o,a,s,l,d,c;return{apiVersion:4,hostVersionsInfo:this.getUpdatedHostVersionsInfo(),isNAAChannelRecommended:null!==(t=this.isNAAChannelRecommended)&&void 0!==t&&t,supports:{app:{notifySuccessResponse:{}},appInstallDialog:this.hubServices.appInstallDialogService?{}:void 0,appEntity:this.hubServices.appEntityService?{}:void 0,barCode:this.hubServices.barCodeService?{}:void 0,calendar:this.hubServices.calendarService?{}:void 0,call:this.hubServices.callService?{}:void 0,chat:this.hubServices.chatService?{}:void 0,clipboard:navigator&&navigator.clipboard?{}:void 0,conversations:this.hubServices.conversationsService?{}:void 0,copilot:(0,A.wr)(this.appDefinition)&&this.hubServices.copilotService?{customTelemetry:this.hubServices.copilotService.customTelemetryService?{}:void 0,eligibility:this.hubServices.copilotService.eligibilityService?{}:void 0}:void 0,dialog:this.hubServices.dialogService?{url:this.hubServices.dialogService.urlService?{bot:this.hubServices.dialogService.urlService.urlBotService?{}:void 0,parentCommunication:this.hubServices.dialogService.urlService.parentCommunicationService?{}:void 0}:void 0,card:this.hubServices.dialogService.cardService&&this.hostVersionsInfo&&this.hostVersionsInfo.adaptiveCardSchemaVersion&&!(0,y.Hk)(this.hostVersionsInfo.adaptiveCardSchemaVersion)?{bot:this.hubServices.dialogService.cardService.cardBotService?{}:void 0}:void 0,update:this.hubServices.dialogService.updateService?{}:void 0}:void 0,externalAppAuthentication:this.hubServices.externalAppChannelService&&this.hubServices.externalAppInfoService?{}:void 0,externalAppAuthenticationForCEA:this.hubServices.externalAppChannelForCEAService&&this.hubServices.externalAppInfoService?{}:void 0,externalAppCardActions:this.hubServices.externalAppCardActionsService&&this.hubServices.externalAppInfoService?{}:void 0,externalAppCardActionsForCEA:this.hubServices.externalAppCardActionsForCEAService&&this.hubServices.externalAppInfoService?{}:void 0,externalAppCommands:this.hubServices.externalAppCommandsService&&this.hubServices.externalAppInfoService?{}:void 0,files:this.hubServices.filesService?{}:void 0,geoLocation:this.hubServices.locationService?{map:this.hubServices.locationService.mapService?{}:void 0}:void 0,hostEntity:{tab:(null===(i=this.hubServices.hostEntityService)||void 0===i?void 0:i.tabService)?{}:void 0},interactive:this.hubServices.interactiveService?{}:void 0,location:this.hubServices.locationService&&this.hubServices.locationService.mapService?{}:void 0,logs:this.hubServices.logService?{}:void 0,mail:this.hubServices.mailService?{handoff:this.hubServices.mailService.handoffService?{}:void 0}:void 0,marketplace:this.hubServices.marketplaceService?{}:void 0,media:this.hubServices.mediaService?{}:void 0,meeting:this.hubServices.meetingService?{appShareButton:this.hubServices.meetingService.appShareButton?{}:void 0}:void 0,meetingRoom:this.hubServices.meetingRoomService?{}:void 0,messageChannels:this.hubServices.messageChannelsService?{telemetry:this.hubServices.messageChannelsService.telemetry,dataLayer:this.hubServices.messageChannelsService.dataLayer}:void 0,monetization:this.hubServices.monetizationService?{}:void 0,nestedAppAuth:this.hubServices.nestedAppAuthService?{}:void 0,notifications:this.hubServices.notificationService?{}:void 0,otherAppStateChange:this.hubServices.otherAppStateChangeService?{}:void 0,pages:{appButton:(null===(n=this.hubServices.pageService)||void 0===n?void 0:n.appButtonService)?{}:void 0,backStack:(null===(r=this.hubServices.pageService)||void 0===r?void 0:r.backStackService)?{}:void 0,config:(null===(o=this.hubServices.pageService)||void 0===o?void 0:o.configService)?{}:void 0,fullTrust:(null===(a=this.hubServices.pageService)||void 0===a?void 0:a.fullTrustService)?{}:void 0,tabs:(null===(s=this.hubServices.pageService)||void 0===s?void 0:s.tabsService)?{}:void 0,currentApp:{}},people:this.hubServices.peopleService?{}:void 0,permissions:this.hubServices.devicePermissionService?{}:void 0,profile:this.hubServices.profileService?{}:void 0,remoteCamera:this.hubServices.remoteCameraService?{}:void 0,search:this.hubServices.searchService?{}:void 0,sharing:this.hubServices.sharingService?{history:this.hubServices.sharingService.historyService?{}:void 0}:void 0,stageView:this.hubServices.stageViewService?{self:this.hubServices.stageViewService.selfService?{}:void 0}:void 0,store:this.hubServices.storeService?{}:void 0,teams:this.hubServices.teamsService?{fullTrust:(null===(l=this.hubServices.teamsService)||void 0===l?void 0:l.fullTrustService)?{joinedTeams:(null===(c=null===(d=this.hubServices.teamsService)||void 0===d?void 0:d.fullTrustService)||void 0===c?void 0:c.joinedTeamsService)?{}:void 0}:void 0}:void 0,teamsCore:this.isTeamsCoreSupported(e.name)?{}:void 0,thirdPartyCloudStorage:this.hubServices.thirdPartyCloudStorageService?{}:void 0,video:this.hubServices.videoExtensibilityService&&(this.hubServices.videoExtensibilityService.mediaStreamService||this.hubServices.videoExtensibilityService.sharedFrameService)?{mediaStream:this.hubServices.videoExtensibilityService.mediaStreamService?{}:void 0,sharedFrame:this.hubServices.videoExtensibilityService.sharedFrameService?{}:void 0}:void 0,webStorage:this.hubServices.webStorageService?{}:void 0}}}onInitializeCallTimedOutForImmediateApp(){var e,t,i;this.failAppInitializationScenario("SDK initialization timed out"),null===(e=this.extendedAppInitializationScenario)||void 0===e||e.fail("SDK initialization timed out"),this.appSdkHost.setAppInitInfo({state:u.Jz.Failed,reason:p.Af.AppInitTimeout,appSdkVersion:null===(t=this.telemetryService)||void 0===t?void 0:t.getAppSdkVersion()}),null===(i=this.hubServices.logger)||void 0===i||i.log(h.$.Error,"Error Bubble Reason",D+this.getOCDIWarning())}onInitializeCallTimedOutForLoadingScreenApp(){var e,t,i,n;this.appInitializationScenarioAlreadyStopped?(this.recordInitializationDoubleStopAttempt(x.initialAppInitializationTimerExpiration),this.appSdkHost.setAppInitInfo({state:u.Jz.Loaded,appSdkVersion:null===(e=this.telemetryService)||void 0===e?void 0:e.getAppSdkVersion()})):(this.failAppInitializationScenario(D),null===(t=this.extendedAppInitializationScenario)||void 0===t||t.fail(D),this.appSdkHost.setAppInitInfo({state:u.Jz.Failed,reason:p.Af.AppInitTimeout,appSdkVersion:null===(i=this.telemetryService)||void 0===i?void 0:i.getAppSdkVersion()})),null===(n=this.hubServices.logger)||void 0===n||n.log(h.$.Error,"Error Screen Reason",D+this.getOCDIWarning())}isTeamsHub(e){return e===v.UH.teams||e===v.UH.teamsModern}isLifeCycleImplemented(){return!!this.hubServices.lifecycleService}logTelemetryForAppSdkLoaded(){var e,t,i;if((0,C.Dz)(null===(e=this.appDefinition)||void 0===e?void 0:e.id)){const e=null===(t=this.telemetryService)||void 0===t?void 0:t.createScenario(g.tL);null===(i=e.addOrUpdateActivityDataField)||void 0===i||i.call(e,m.u7.WEB_CONTENT_SDK_ID,this.appSdkHost.getWebContentSdkId()),e.stop()}}}function F(e,t,i,n,r,o,a){return(0,d.eZ)().useNewAppInitializationExperience?new H(e,t,i,n,r,o,a):new O(e,t,i,n,r,o,a)}class H extends b.R{constructor(e,t,i,n,r,o,a){super(e,i),this.appSdkHost=e,this.hubServices=t,this.telemetryService=i,this.hostVersionsInfo=n,this.usingCachedApp=r,this.isNAAChannelRecommended=o,this.originsToBlock=a}initHandlers(){}}},26121:(e,t,i)=>{i.d(t,{B:()=>p});var n=i(17576),r=i(65964),o=i(79236),a=i(23404),s=i(46467),l=i(66310),d=i(51144),c=i(669);class p extends d.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.authenticationService=i,this.TAG="BaseAuthenticationMessageHandler"}initHandlers(){this.registerHandler(r.tz.authentication.getUser,this.handleGetUser,{errorCallback:this.onGetUserError,isRestrictedToMicrosoftOwnedOrFullTrustApps:!0}),this.registerHandler(r.tz.authentication.getAuthToken,this.handleGetAuthToken,{callbackFixedArgsLength:5,errorCallback:this.onGetAuthTokenError})}validateDependencies(){this.appSdkHost.getContext().app.host.clientType!==a.WK.desktop||this.authenticationService.externalAuthService||this.appSdkHost.getLogger().log(o.$.Warn,this.TAG,r.Px)}handleGetUser(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let e=yield this.authenticationService.getUser();if(e){let t=yield this.appSdkHost.getAppContext(),i=Object.assign(Object.assign({},e.profile),{dataResidency:(0,l.jZ)(t.user.dataResidency)});return(0,c.PR)([!0,i])}return Promise.reject("Failed to fetch the user profile")}))}onGetUserError(e,t){return null==t||t.fail(`GetUser failed ${(0,c.oE)(e)}`),(0,c.PR)([!1,e])}handleGetAuthToken(e,t,i,r,o,a){var l;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield this.appSdkHost.getAppContext();let d;try{d=yield(0,s.u6)(e.origin,t,this.appSdkHost.getHubInfo(),this.appDefinition,n)}catch(t){throw null===(l=null==a?void 0:a.addDetails)||void 0===l||l.call(a,{invalidResource:e.origin}),t}let p=yield this.authenticationService.acquireToken(d[0],i,r,o);return(0,c.PR)([!0,p.token])}))}onGetAuthTokenError(e,t){return null==t||t.fail(`GetAuthToken failed ${(0,c.oE)(e)}`),(0,c.PR)([!1,e])}}},51144:(e,t,i)=>{i.d(t,{R:()=>p});var n=i(17576),r=i(65964),o=i(69537),a=i(75973),s=i(79236),l=i(19141),d=i(17864),c=i(669);class p{constructor(e,t){this.appSdkHost=e,this.telemetryService=t,this.handlers={},this.appDefinition=this.appSdkHost.getAppDefinition(),this.isTelemetryHandledByExecutor=!1}registerHandler(e,t,i){var n;this.handlers[e]=(0,d.C)({callback:t,scenarioName:null!==(n=null==i?void 0:i.scenarioName)&&void 0!==n?n:a.Fb[e],errorCallback:null==i?void 0:i.errorCallback,callbackFixedArgsLength:null==i?void 0:i.callbackFixedArgsLength,isRestrictedToFirstPartyOrLobApps:null==i?void 0:i.isRestrictedToFirstPartyOrLobApps,isRestrictedToFullTrustApps:null==i?void 0:i.isRestrictedToFullTrustApps,isRestrictedToFullTrustOrLobApps:null==i?void 0:i.isRestrictedToFullTrustOrLobApps,isRestrictedToMicrosoftOwnedApps:null==i?void 0:i.isRestrictedToMicrosoftOwnedApps,isRestrictedToMicrosoftOwnedOrFullTrustApps:null==i?void 0:i.isRestrictedToMicrosoftOwnedOrFullTrustApps})}deleteMessageHandling(e){delete this.handlers[e]}canHandleMessage(e){return this.validateInitialization(e)&&void 0!==this.handlers[e]}isAnAuthUXScenario(e){return e===a.Fb[r.tz.authentication.authenticate]}canPassScenarioToHandler(e){return e===a.Fb[r.tz.authentication.authenticate]||e===a.Fb[r.tz.externalAppAuthentication.authenticateAndResendRequest]||e===a.Fb[r.tz.externalAppAuthentication.authenticateWithSSO]||e===a.Fb[r.tz.externalAppAuthentication.authenticateWithSSOAndResendRequest]||e===a.Fb[r.tz.externalAppAuthentication.authenticateWithOauth2]||e===a.Fb[r.tz.externalAppAuthenticationForCEA.authenticateAndResendRequest]||e===a.Fb[r.tz.externalAppAuthenticationForCEA.authenticateWithSSO]||e===a.Fb[r.tz.externalAppAuthenticationForCEA.authenticateWithOauth]||e===a.Fb[r.tz.externalAppAuthenticationForCEA.authenticateWithSSOAndResendRequest]||e===a.Fb[r.tz.externalAppCardActions.processActionOpenUrl]||e===a.Fb[r.tz.externalAppCardActions.processActionSubmit]||e===a.Fb[r.tz.externalAppCardActionsForCEA.processActionOpenUrl]||e===a.Fb[r.tz.externalAppCardActionsForCEA.processActionSubmit]||e===a.Fb[r.tz.externalAppCommands.processActionCommand]||e===a.Fb[r.tz.nestedAppAuth.execute]||e===a.Fb[r.tz.authentication.getAuthToken]}handleMessage(e,t,i,a,l){var p,u,h,g,v,m,S,f;return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!this.validateInitialization(t))return Promise.reject("SDK context is not initialized");if(!this.canHandleMessage(t))return Promise.reject(`Handler cannot handle message: ${t}`);const n=null!==(p=this.handlers[t].callbackFixedArgsLength)&&void 0!==p?p:i.length;i.push(...Array(Math.max(0,n-i.length)).fill(void 0)),this.trackMessageDelayForAppInitAPIs(t,a);const A=this.handlers[t];let C=this.createTelemetryScenario(t,A,i,e,a,l);try{if(A.isRestrictedToFullTrustApps&&!(null===(u=this.appSdkHost.getAppDefinition())||void 0===u?void 0:u.isFullTrust))throw(0,c.jC)(o.O4.INTERNAL_ERROR,r.u);if(A.isRestrictedToMicrosoftOwnedApps&&!(null===(h=this.appSdkHost.getAppDefinition())||void 0===h?void 0:h.isMicrosoftOwned))throw(0,c.jC)(o.O4.INTERNAL_ERROR,r.u);if(A.isRestrictedToFullTrustOrLobApps&&!(null===(g=this.appSdkHost.getAppDefinition())||void 0===g?void 0:g.isFullTrust)&&!(null===(v=this.appSdkHost.getAppDefinition())||void 0===v?void 0:v.isLOB))throw(0,c.jC)(o.O4.INTERNAL_ERROR,r.u);if(A.isRestrictedToFirstPartyOrLobApps&&!(0,d.m)(this.appSdkHost.getAppDefinition())&&!(null===(m=this.appSdkHost.getAppDefinition())||void 0===m?void 0:m.isLOB))throw(0,c.jC)(o.O4.INTERNAL_ERROR,r.u);if(A.isRestrictedToMicrosoftOwnedOrFullTrustApps&&!(null===(S=this.appSdkHost.getAppDefinition())||void 0===S?void 0:S.isFullTrust)&&!(null===(f=this.appSdkHost.getAppDefinition())||void 0===f?void 0:f.isMicrosoftOwned))throw(0,c.jC)(o.O4.INTERNAL_ERROR,r.u);if(!this.appSdkHost.checkIfCachedAndRequestAllowed(t))throw"Request not allowed when cached";this.validateDependencies(t);const e=yield A.callback.apply(this,i);return this.isAnAuthUXScenario(A.scenarioName)||null==C||C.stop(),e}catch(e){const t=(0,c.oE)(e);return this.appSdkHost.getLogger().log(s.$.Error,"handleMessage","Error in handling message",t),A.errorCallback?A.errorCallback(e,C):(null==C||C.fail(t),Promise.reject(e))}}))}createTelemetryScenario(e,t,i=[],n,r,o){var a;const s=t.scenarioName,d=null===(a=this.appDefinition)||void 0===a?void 0:a.id;if(this.isTelemetryHandledByExecutor||!s||(0,l.vJ)(e,d))return;const c=this.telemetryService.createScenario(s,d,null==r?void 0:r.value,n,null==r?void 0:r.type,o);return r&&c.markPhase("MessageDelay"),this.canPassScenarioToHandler(s)&&i.push(c),c}validateInitialization(e){return e===r.tz.initialize||this.appSdkHost.isInitialized()}trackMessageDelayForAppInitAPIs(e,t){}validateDependencies(e){}cleanup(){}}},3650:(e,t,i)=>{i.d(t,{B:()=>c});var n=i(17576),r=i(79236),o=i(23404),a=i(46467);const s=e=>{if(null==e||null===typeof e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e)return e;if(Array.isArray(e))return e.map((e=>s(e)));if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return"function"==typeof structuredClone?structuredClone(e):e.slice(0);if("object"==typeof e){const i={};for(var t of Object.getOwnPropertyNames(e))i[t]=s(e[t]);return i}throw Error("Provided type '"+typeof e+"' ("+Object.prototype.toString.call(e)+") can't be cloned using deepCopy.")};var l=i(28833),d=i(669);class c{constructor(e){this.appSdkHost=e,this.messageHandlers=[],this.TAG="BaseMessageProcessor",this.ValidCustomApiHubs=[o.UH.teams,o.UH.teamsModern,o.UH.orange,o.UH.edge]}process(e){var t,i;return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{if(e.isDeeplyNestedRequest)throw new Error("Access denied: Request from a nested iframe is not allowed");const{result:i,message:n}=yield this.callMessageHandlerHelper(e);if(i)return"appResponse"===i.kind&&this.processHandlerResultHelper(n,i,e),Promise.resolve(!0);if((null===(t=this.appSdkHost.getAppDefinition())||void 0===t?void 0:t.isMicrosoftOwned)&&this.ValidCustomApiHubs.includes(this.appSdkHost.getHubInfo().name)){const t=yield this.tryCustomProcessing(n);if(t.processed){const i=yield(0,d.PR)(t.data);return"appResponse"===i.kind&&this.processHandlerResultHelper(n,i,e),Promise.resolve(!0)}}throw Error("Unhandled message")}catch(t){this.appSdkHost.getLogger().log(r.$.Error,this.TAG,`Error in processing request: ${null===(i=e.data)||void 0===i?void 0:i.func}`,t)}return Promise.resolve(!1)}))}processForDeeplyNestedRequest(e){var t;return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{if(!e.isDeeplyNestedRequest)throw new Error("Access denied: Request from a main/top iframe is not allowed");if(!d.ez.has(e.data.func))throw new Error(`Access denied: message func "${e.data.func}" is not allowed for requests from a nested iframe.`);const{result:t,message:i}=yield this.callMessageHandlerHelper(e);if(t)return"appResponse"===t.kind&&this.processHandlerResultHelper(i,t,e,!0),Promise.resolve(!0);throw Error("Unhandled message")}catch(i){this.appSdkHost.getLogger().log(r.$.Error,this.TAG,`Error in processing deeply nested request: ${null===(t=e.data)||void 0===t?void 0:t.func}`,i)}return Promise.resolve(!1)}))}callMessageHandlerHelper(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const t=(0,a.dE)(e.origin,this.appSdkHost.getLogger(),this.appSdkHost.getAppDefinition(),this.appSdkHost.getContext());e.isTrustedOrigin=t,this.appSdkHost.getLogger().log(r.$.Info,this.TAG,`Function name: ${e.data.func}, Args: ${e.data.args}, Version_APIName: ${e.data.apiVersionTag}`);const i=(0,o.Yj)(e.data);let n=i.args,d=i.apiVersionTag;return n=i.args&&Array.isArray(i.args)?i.args.map((e=>(e=>"function"==typeof structuredClone?structuredClone(e):s(e))(e))):[],n.unshift(e),{result:yield this.callMessageHandler(d,i.func,n,(0,l.Bp)(i.monotonicTimestamp,i.timestamp),i.isProxiedFromChild),message:i}}))}callMessageHandler(e,t,i,n,r){for(const o of this.messageHandlers)if(o.canHandleMessage(t))return o.handleMessage(e,t,i,n,r);return Promise.resolve(void 0)}tryCustomProcessing(e){return Promise.resolve({processed:!1,data:void 0})}processHandlerResultHelper(e,t,i,n=!1){let r=[];void 0!==t.data&&(r=Array.isArray(t.data)?t.data:[t.data]),n?this.appSdkHost.postDeeplyNestedResponseToApp(e,{source:i.source,origin:i.origin,func:e.func},r):this.appSdkHost.postResponseToApp(e,r)}cleanup(){this.messageHandlers.forEach((e=>e.cleanup()))}}},669:(e,t,i)=>{i.d(t,{IB:()=>p,JA:()=>A,M5:()=>h,N8:()=>m,PR:()=>f,QY:()=>I,UR:()=>d,eZ:()=>u,ez:()=>l,f1:()=>C,f3:()=>v,hl:()=>S,jC:()=>g,kA:()=>c,mW:()=>b,oE:()=>E,og:()=>y,sC:()=>R,vh:()=>s});var n=i(17576),r=i(65964),o=i(69537),a=i(59983);const s="An internal error occurred",l=new Set([r.tz.nestedAppAuth.execute]),d={errorCode:o.O4.INTERNAL_ERROR,message:s},c={errorCode:o.he.INTERNAL_ERROR,message:s};function p(e,t,i,n,r,o){const a=function(e,t,i){return{errorCode:(null==e?void 0:e.errorCode)&&Object.values(t).includes(null==e?void 0:e.errorCode)?e.errorCode:i.errorCode,message:(S(e)?e.message:"string"==typeof e?e:i.message)||i.message}}(t,i,n);return null==o||o.fail(`${e} Api failed ${a.message}`),r(a)}const u=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return null==i||i.fail(`${e} Api failed ${E(t)}`),S(t)?f(t):f(d)})),h=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return null==i||i.fail(`${e} Api failed ${E(t)}`),f([!1,t])})),g=(e,t)=>({errorCode:e,message:t}),v=e=>({errorCode:o.he.INTERNAL_ERROR,message:S(e)?e.message||s:"string"==typeof e?e:JSON.stringify(e)}),m=(e,t,i,r=!1)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=yield t(e);if(S(n))return Promise.reject(n);{const e=i?i(n):n;return r&&Array.isArray(e)?f([null,...e]):f([null,e])}})),S=e=>void 0!==(null==e?void 0:e.errorCode),f=e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return null!=e?{kind:"appResponse",data:e}:{kind:"appResponse"}})),A=(e,...t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const i=yield e(...t);return f(i)})),C={kind:"logResponse"},I=(e,...t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return yield e(...t),C})),y=(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){let i;if(!e)throw g(o.O4.INTERNAL_ERROR,"PermissionService is not provided");try{i=yield e.storageService.getPermissionStatus(t)}catch(e){throw JSON.stringify(e)}if(i==a.W.NeverAsked)throw g(o.O4.INTERNAL_ERROR,"The app must specify "+t+" permission in its manifest and must be granted by the user. (the user has not been asked to grant permission).");if(i==a.W.Revoked)throw g(o.O4.PERMISSION_DENIED,"user has explicitly not consented for device permission");if(i!==a.W.Consented)throw g(o.O4.INTERNAL_ERROR,`Unrecognized device permission state: ${i}`)})),E=e=>{const t="An unknown error occurred that could not be converted into a string description.";return S(e)||e instanceof Error?e.message||t:"string"==typeof e?e:"object"==typeof e&&JSON.stringify(e)||t};function b(e,t){var i;return{data:e.data,isDeeplyNestedRequest:t,origin:e.origin,source:null!==(i=e.source)&&void 0!==i?i:void 0}}const R=e=>{var t;return e.uuid?e.uuid.toString():null===(t=e.id)||void 0===t?void 0:t.toString()}},65964:(e,t,i)=>{i.d(t,{Af:()=>a,DX:()=>w,Di:()=>C,GE:()=>p,MU:()=>T,OZ:()=>A,PZ:()=>b,Px:()=>y,Si:()=>m,Wt:()=>s,_P:()=>R,a$:()=>u,eO:()=>n,f:()=>D,jp:()=>f,kv:()=>o,lY:()=>c,mP:()=>v,pi:()=>d,pm:()=>h,r:()=>I,sh:()=>S,tp:()=>g,tz:()=>r,u:()=>E});const n=i(72672).rE,r={appInitialization:{appLoaded:"appInitialization.appLoaded",expectedFailure:"appInitialization.expectedFailure",failure:"appInitialization.failure",success:"appInitialization.success"},appInstallDialog:{openAppInstallDialog:"appInstallDialog.openAppInstallDialog"},authentication:{getAuthToken:"authentication.getAuthToken",getUser:"authentication.getUser",authenticate:"authentication.authenticate",notifySuccess:"authentication.authenticate.success",notifyFailure:"authentication.authenticate.failure"},appEntity:{selectAppEntity:"appEntity.selectAppEntity"},barCode:{scanBarCode:"media.scanBarCode"},calendar:{composeMeeting:"calendar.composeMeeting",openCalendarItem:"calendar.openCalendarItem"},call:{startCall:"call.startCall"},chat:{openChat:"chat.openChat"},clipboard:{writeToClipboard:"clipboard.writeToClipboard",readFromClipboard:"clipboard.readFromClipboard"},conversations:{openConversation:"conversations.openConversation",closeConversation:"conversations.closeConversation",getChatMembers:"getChatMembers"},copilot:{customTelemetry:{sendCustomTelemetryData:"copilot.customTelemetry.sendCustomTelemetryData"},eligibility:{getEligibilityInfo:"copilot.eligibility.getEligibilityInfo"}},dialogs:{open:"tasks.startTask",submit:"tasks.completeTask",update:{resize:"tasks.updateTask"}},externalAppCardActions:{processActionOpenUrl:"externalAppCardActions.processActionOpenUrl",processActionSubmit:"externalAppCardActions.processActionSubmit"},externalAppCardActionsForCEA:{processActionOpenUrl:"externalAppCardActionsForCEA.processActionOpenUrl",processActionSubmit:"externalAppCardActionsForCEA.processActionSubmit"},externalAppCommands:{processActionCommand:"externalAppCommands.processActionCommand"},externalAppAuthentication:{authenticateAndResendRequest:"externalAppAuthentication.authenticateAndResendRequest",authenticateWithSSO:"externalAppAuthentication.authenticateWithSSO",authenticateWithSSOAndResendRequest:"externalAppAuthentication.authenticateWithSSOAndResendRequest",authenticateWithOauth2:"externalAppAuthentication.authenticateWithOauth2",authenticateWithPowerPlatformConnectorPlugins:"externalAppAuthentication.authenticateWithPowerPlatformConnectorPlugins"},externalAppAuthenticationForCEA:{authenticateWithSSO:"externalAppAuthenticationForCEA.authenticateWithSSO",authenticateWithOauth:"externalAppAuthenticationForCEA.authenticateWithOauth",authenticateAndResendRequest:"externalAppAuthenticationForCEA.authenticateAndResendRequest",authenticateWithSSOAndResendRequest:"externalAppAuthenticationForCEA.authenticateWithSSOAndResendRequest"},files:{addCloudStorageFolder:"files.addCloudStorageFolder",copyMoveFiles:"files.copyMoveFiles",deleteCloudStorageFolder:"files.deleteCloudStorageFolder",getCloudStorageFolders:"files.getCloudStorageFolders",openFilePreview:"openFilePreview",getExternalProviders:"files.getExternalProviders",openCloudStorageFile:"files.openCloudStorageFile",getCloudStorageFolderContents:"files.getCloudStorageFolderContents"},getContext:"getContext",initialize:"initialize",hostEntity:{tab:{addAndConfigure:"hostEntity.tab.addAndConfigure",reconfigure:"hostEntity.tab.reconfigure",rename:"hostEntity.tab.rename",remove:"hostEntity.tab.remove",getAll:"hostEntity.tab.getAll"}},location:{getCurrentLocation:"location.getLocation",map:{showLocation:"location.showLocation"}},interactive:{getFluidTenantInfo:"interactive.getFluidTenantInfo",getFluidToken:"interactive.getFluidToken",getFluidContainerId:"interactive.getFluidContainerId",setFluidContainerId:"interactive.setFluidContainerId",getNtpTime:"interactive.getNtpTime",registerClientId:"interactive.registerClientId",getClientRoles:"interactive.getClientRoles",getClientInfo:"interactive.getClientInfo"},links:{openLink:"executeDeepLink"},logs:{handleAppLog:"log.receive"},mail:{composeMail:"mail.composeMail",openMailItem:"mail.openMailItem",handoff:{composeMail:"mail.handoff.composeMail"}},marketplace:{getCart:"marketplace.getCart",addOrUpdateCartItems:"marketplace.addOrUpdateCartItems",removeCartItems:"marketplace.removeCartItems",updateCartStatus:"marketplace.updateCartStatus"},media:{captureImage:"captureImage",getMedia:"getMedia",selectMedia:"selectMedia",viewImages:"viewImages"},meeting:{getAppContentStageSharingCapabilities:"meeting.getAppContentStageSharingCapabilities",getAppContentStageSharingState:"meeting.getAppContentStageSharingState",getAuthenticationTokenForAnonymousUser:"meeting.getAuthenticationTokenForAnonymousUser",getIncomingClientAudioState:"getIncomingClientAudioState",getLiveStreamState:"meeting.getLiveStreamState",meetingReactionReceived:"meeting.meetingReactionReceived",getMeetingDetails:"meeting.getMeetingDetails",appShareButton:{setOptions:"meeting.appShareButton.setOptions"},raiseHandStateChanged:"meeting.raiseHandStateChanged",requestStartLiveStreaming:"meeting.requestStartLiveStreaming",requestStopLiveStreaming:"meeting.requestStopLiveStreaming",audioDeviceSelectionChanged:"meeting.audioDeviceSelectionChanged",shareAppContentToStage:"meeting.shareAppContentToStage",speakingStateChanged:"meeting.speakingStateChanged",stopSharingAppContentToStage:"meeting.stopSharingAppContentToStage",toggleIncomingClientAudio:"toggleIncomingClientAudio",requestAppAudioHandling:"meeting.requestAppAudioHandling",updateMicState:"meeting.updateMicState",micStateChanged:"meeting.micStateChanged",joinMeeting:"meeting.joinMeeting"},meetingRoom:{getPairedMeetingRoomInfo:"meetingRoom.getPairedMeetingRoomInfo",sendCommandToPairedMeetingRoom:"meetingRoom.sendCommandToPairedMeetingRoom"},monetization:{openPurchaseExperience:"monetization.openPurchaseExperience"},nestedAppAuth:{execute:"nestedAppAuth.execute"},notifications:{showNotification:"notifications.showNotification"},otherAppStateChange:{unregisterInstall:"otherApp.unregisterInstall",notifyInstallCompleted:"otherApp.notifyInstallCompleted"},pages:{getConfig:"settings.getSettings",navigateCrossDomain:"navigateCrossDomain",navigateToApp:"pages.navigateToApp",returnFocus:"returnFocus",setCurrentFrame:"setFrameContext",shareDeepLink:"shareDeepLink",backStack:{navigateBack:"navigateBack"},currentApp:{navigateTo:"pages.currentApp.navigateTo",navigateToDefaultPage:"pages.currentApp.navigateToDefaultPage"},tabs:{getTabInstances:"getTabInstances",getMruTabInstances:"getMruTabInstances",navigateToTab:"navigateToTab"},config:{setConfig:"settings.setSettings",setValidityState:"settings.setValidityState",save:{success:"settings.save.success",failure:"settings.save.failure"},remove:{success:"settings.remove.success",failure:"settings.remove.failure"}},fullTrust:{enterFullscreen:"enterFullscreen",exitFullscreen:"exitFullscreen"}},people:{selectPeople:"people.selectPeople"},permissions:{storageService:{getPermissionStatus:"permissions.has"},requestUserConsentForPermission:"permissions.request"},profile:{showProfile:"profile.showProfile"},remoteCamera:{getCapableParticipants:"remoteCamera.getCapableParticipants",requestControl:"remoteCamera.requestControl",sendControlCommand:"remoteCamera.sendControlCommand",terminateSession:"remoteCamera.terminateSession"},readyToUnload:"readyToUnload",registerHandler:"registerHandler",search:{unregister:"search.unregister",closeSearch:"search.closeSearch"},sharing:{shareWebContent:"sharing.shareWebContent",history:{getContent:"sharing.history.getContent"}},stageView:{open:"stageView.open",self:{close:"stageView.self.close"}},store:{openFullStore:"store.openFullStore",openAppDetail:"store.openAppDetail",openInContextStore:"store.openInContextStore",openSpecificStore:"store.openSpecificStore"},teams:{getTeamChannels:"teams.getTeamChannels",refreshSiteUrl:"teams.refreshSiteUrl",fullTrust:{getConfigSetting:"getConfigSetting",joinedTeams:{getUserJoinedTeams:"getUserJoinedTeams"}}},messageChannels:{telemetry:{getTelemetryPort:"messageChannels.telemetry.getTelemetryPort"},dataLayer:{getDataLayerPort:"messageChannels.dataLayer.getDataLayerPort"}},thirdPartyCloudStorageService:{getDragAndDropFiles:"thirdPartyCloudStorage.getDragAndDropFiles"},video:{effectParameterChange:"video.effectParameterChange",mediaStream:{registerForVideoFrame:"video.mediaStream.registerForVideoFrame",audioInferenceDiscardStatusChange:"video.mediaStream.audioInferenceDiscardStatusChange"},notifyError:"video.notifyError",personalizedEffectsChanged:"video.personalizedEffectsChanged",registerForVideoEffect:"video.registerForVideoEffect",sharedFrame:{registerForVideoFrame:"video.registerForVideoFrame"},startVideoExtensibilityVideoStream:"video.startVideoExtensibilityVideoStream",videoEffectChanged:"video.videoEffectChanged",videoEffectReadiness:"video.videoEffectReadiness",videoExtensibilityIpcChangedEvent:"video.videoExtensibilityIpcChangedEvent",performance:{performanceDataGenerated:"video.performance.performanceDataGenerated",frameProcessingSlow:"video.performance.frameProcessingSlow",firstFrameProcessed:"video.performance.firstFrameProcessed",textureStreamAcquired:"video.performance.textureStreamAcquired"},setFrameProcessTimeLimit:"video.setFrameProcessTimeLimit"},webStorage:{isWebStorageClearedOnUserLogOut:"webStorage.isWebStorageClearedOnUserLogOut"}};var o,a,s,l;!function(e){e.ME="ME",e.CEA="CEA"}(o||(o={})),function(e){e.AuthFailed="AuthFailed",e.Timeout="Timeout",e.Other="Other",e.AppInitTimeout="AppInitTimeout",e.CachedAppLoadTimedOut="CachedAppLoadTimedOut",e.Validation="Validation",e.Validation_InvalidDomains="Validation_InvalidDomains"}(a||(a={})),function(e){e.AppExpiration="app expiration",e.AppNotifyFailure="app sent notify failure",e.AppUnloadTimeout="app unload timeout",e.FreeMemoryUnderMinimum="insufficient memory to retain the cached app",e.HostExplicitRemoval="host explicitly removed the app",e.HostMemoryLimitExceeded="host memory limit exceeded",e.AppDidNotRegisterForCaching="app did not register for caching",e.NumAppsExceeded="number of apps exceeded"}(s||(s={})),function(e){e.PermissionError="PermissionError",e.NotFound="NotFound",e.Throttling="Throttling",e.Offline="Offline",e.Other="Other"}(l||(l={}));const d={resourceDomainParameter:"{resourceDomain}",validResourcePattern:"^((https|api)://{resourceDomain}([:/].*)?)$"},c="^[-a-zA-Z0-9._~+/=]+$",p=/^(\*\.)*[^*]+$/i,u=new Set(["b5abf2ae-c16b-4310-8f8a-d3bcdb52f162","d870f6cd-4aa5-4d42-9626-ab690c041429"]),h=new Set(["f3a6e67f-850d-4dd9-960a-04c6638ded39","f3a6e67f-850d-4dd9-960a-04c6638ded36","b6b18421-3bba-40df-a983-05fbbc9e2d13","a9750531-44bc-4346-84a7-c4ceda140ef4"]),g=["com.example.microsoftteamstabs.test","com.example.m365testapp.test"],v=new Set([...u,...g]),m="Url is invalid",S="Invalid dialog URL",f="There is at least one improperly formatted domain in the provided app definition's validDomains field",A=4096,C=`Authorization code exceeds max length of ${A} characters`,I="Authorization code contains unexpected characters. Allowed characters are a-z, A-Z, 0-9, ., _, +, /, =, ~, and -",y="Desktop clients must provide implementation for externalAuthService on IAuthenticationService. External auth flows may not work as expected when externalAuthService is not provided.",E="App does not have the required permissions for this operation",b={bingUrl:"https://www.bing.com",contosoUrl:"https://www.contoso.com",contososuitesUrl:"https://www.contososuites.com",exampleUrl:"https://example.com",northwindtradersUrl:"https://www.northwindtraders.com/",teamsAdatumUrl:"https://teams.adatum.com/",teamsMicrosoftUrl:"https://teams.microsoft.com",fromValidDomainList:"https://www.relecloud.com",validAdatumUrl:"https://validurl.adatum.com",validAdatumUrl2:"https://validurl2.adatum.com"},R={requestedForAppID:"RequestedForAppID",isExternal:"IsExternal",actionOpenUrlType:"ActionOpenUrlType",oauthConfigId:"OauthConfigID"},T=["www.microsoft365.com","bing.com","edgeservices.bing.com","www.bing.com","www.staging-bing-int.com","teams.cloud.microsoft","outlook.cloud.microsoft","m365.cloud.microsoft","copilot.microsoft.com","windows.msn.com"],w="2.19",D="The detected TeamsJS Version is < 2.19. App may not be able to run on this domain. Please update TeamsJS."},22804:(e,t,i)=>{i.d(t,{M:()=>u});var n,r=i(17576),o=i(79236),a=i(59983),s=i(35574),l=i(25672),d=i(23145),c=i(99594);!function(e){let t,i;!function(e){e[e.RECORD_DOESNT_EXIST=5500]="RECORD_DOESNT_EXIST",e[e.INDEXEDDB_INTERNAL_ERROR=5600]="INDEXEDDB_INTERNAL_ERROR",e[e.INVALID_SEARCH_PARAMETERS=5700]="INVALID_SEARCH_PARAMETERS",e[e.BLOCKED=5800]="BLOCKED"}(t=e.ErrorCode||(e.ErrorCode={})),function(e){e.APPID_AND_USERID_INDEX="appID_and_userID",e.APPID_INDEX="appID",e.USERID_INDEX="userID"}(i=e.indexID||(e.indexID={}));const n="apps",o="appsPermissionsDB";function l(e,r){return new Promise(((a,s)=>{const l=indexedDB.open(o,1);let d;l.onblocked=()=>{d={errorCode:t.BLOCKED,message:"Please close all the existing tabs."},s(d)},l.onupgradeneeded=()=>{const e=l.result;if(!e.objectStoreNames.contains(n)){const t=e.createObjectStore(n,{keyPath:["appID","userID"],autoIncrement:!1});t.createIndex(i.APPID_AND_USERID_INDEX,["appID","userID"],{unique:!0}),t.createIndex(i.APPID_INDEX,"appID",{unique:!1}),t.createIndex(i.USERID_INDEX,"userID",{unique:!1})}},l.onerror=e=>{d={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},s(d)},l.onsuccess=()=>{const o=l.result,c=o.transaction(n,"readwrite",{durability:"relaxed"}).objectStore(n);let p=c.index(i.APPID_AND_USERID_INDEX).get([e,r]);p.onsuccess=()=>{a([c,p.result])},p.onerror=e=>{d={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},s(d)},o.close()}}))}function p(e){if(!0===(0,s.eZ)().useStrictAppIdValidationInStorage)return(0,d.A)(e);try{return(0,c.z)(e),!0}catch(e){return!1}}function u(i,n){return new Promise(((o,a)=>(0,r.__awaiter)(this,void 0,void 0,(function*(){let r;p(i)||(r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.invalidAppIdErrorString},a(r)),n||(r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:"UserID should not be null/empty."},a(r));const s=yield l(i,n);try{o(void 0!==s[1])}catch(e){r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},a(r)}}))))}function h(i,n){return new Promise(((o,s)=>(0,r.__awaiter)(this,void 0,void 0,(function*(){let r;p(i)||(r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.invalidAppIdErrorString},s(r)),n||(r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:"UserID should not be null/empty."},s(r));const[d,c]=yield l(i,n);let u={appID:i,userID:n,permissions:{geolocation:a.W.NeverAsked,media:a.W.NeverAsked,midi:a.W.NeverAsked,notifications:a.W.NeverAsked,openExternal:a.W.NeverAsked}};try{void 0===c&&(d.put(u).onsuccess=()=>{o()})}catch(e){r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},s(r)}}))))}e.invalidAppIdErrorString="AppID is not valid. Must be GUID format",e.doesDevicePermissionStorageExist=function(){return(0,r.__awaiter)(this,void 0,void 0,(function*(){return"databases"in indexedDB?(yield indexedDB.databases()).some((e=>e.name===o)):"Cannot Tell"}))},e.doesRecordExist=u,e.createRecord=h,e.updatePermission=function(i,n,o,a){return new Promise(((s,d)=>(0,r.__awaiter)(this,void 0,void 0,(function*(){let r;try{p(i)||(r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.invalidAppIdErrorString},d(r)),n||(r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:"UserID should not be null/empty."},d(r)),(yield u(i,n))||h(i,n);const[c,g]=yield l(i,n);if(void 0!==g.permissions[o]){g.permissions[o]=a;const e=c.put(g);e.onsuccess=()=>{s(e.result)},e.onerror=e=>{r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},d(r)}}}catch(e){r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},d(r)}}))))},e.deleteSingleRecord=function(n,o){return new Promise(((a,s)=>(0,r.__awaiter)(this,void 0,void 0,(function*(){let r;try{p(n)||(r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.invalidAppIdErrorString},s(r)),o||(r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:"UserID should not be null/empty."},s(r));const d=yield l(n,o),c=d[0].index(i.APPID_AND_USERID_INDEX).openKeyCursor(IDBKeyRange.only([n,o]));c.onsuccess=()=>{const e=c.result;e?(d[0].delete(e.primaryKey),a()):(r={errorCode:t.RECORD_DOESNT_EXIST,message:"Record doesn't exists."},s(r))},c.onerror=e=>{r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},s(r)}}catch(e){r={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},s(r)}}))))},e.searchRecord=function(n,o,a){return new Promise(((s,d)=>(0,r.__awaiter)(this,void 0,void 0,(function*(){let r,c;if(Object.values(i).includes(a))try{p(n)||(c={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.invalidAppIdErrorString},d(c)),o||(c={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:"UserID should not be null/empty."},d(c));const u=yield l(n,o);r=a===i.APPID_AND_USERID_INDEX?u[0].index(i.APPID_AND_USERID_INDEX).getAll([n,o]):a===i.APPID_INDEX?u[0].index(i.APPID_INDEX).getAll(n):u[0].index(i.USERID_INDEX).getAll(o),r.onsuccess=()=>{const e=r.result;e?s(e):(c={errorCode:t.RECORD_DOESNT_EXIST,message:"Record doesn't exists."},d(c))},r.onerror=e=>{c={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},d(c)}}catch(e){c={errorCode:t.INDEXEDDB_INTERNAL_ERROR,message:e.type},d(c)}else c={errorCode:t.INVALID_SEARCH_PARAMETERS,message:`searchByIndex parameter should be one of these ${[i.APPID_AND_USERID_INDEX,i.APPID_INDEX,i.USERID_INDEX]}`},d(c)}))))},e.deleteObjectStore=function(){return new Promise(((e,t)=>{const i=indexedDB.deleteDatabase(o);i.onsuccess=()=>{e()},i.onerror=e=>{t(e)}}))}}(n||(n={}));const p=[{permission:a.m.GeoLocation,status:a.W.NeverAsked},{permission:a.m.Media,status:a.W.NeverAsked},{permission:a.m.Midi,status:a.W.NeverAsked},{permission:a.m.Notifications,status:a.W.NeverAsked},{permission:a.m.OpenExternal,status:a.W.NeverAsked}];class u{constructor(e,t){this.appID=e,this.userID=t,this.getPermissions=()=>(0,r.__awaiter)(this,void 0,void 0,(function*(){var e;const t=null===(e=(0,s.eZ)().shouldLazilyWriteDefaultDevicePermissions)||void 0===e||e;if(t&&!1===(yield n.doesDevicePermissionStorageExist()))return(0,l.i)().log(o.$.Info,"DevicePermissionStorageService","Device permission storage does NOT exist; NOT creating it and instead using default values"),p;if(!(yield n.doesRecordExist(this.appID,this.userID))){if(t)return(0,l.i)().log(o.$.Info,"DevicePermissionStorageService","Device permission storage DOES exist but has no records; NOT creating new record and instead using default values"),p;yield n.createRecord(this.appID,this.userID)}const i=yield n.searchRecord(this.appID,this.userID,n.indexID.APPID_AND_USERID_INDEX);return Object.entries(i[0].permissions).map((([e,t])=>({permission:e,status:t})))})),this.getPermissionStatus=e=>(0,r.__awaiter)(this,void 0,void 0,(function*(){const t=(yield this.getPermissions()).find((t=>t.permission===e));return void 0!==t?t.status:a.W.NeverAsked})),this.storePermissionConsent=e=>(0,r.__awaiter)(this,void 0,void 0,(function*(){yield n.updatePermission(this.appID,this.userID,e.permission,e.status)}))}}},84498:(e,t,i)=>{i.d(t,{J:()=>n});class n{constructor(e){this.listeners={},this.element=e}addListener(e,t){this.element&&(this.removeListener(e),this.element.addEventListener(e,t),this.listeners[e]=t)}removeListener(e){this.element&&this.listeners[e]&&(this.element.removeEventListener(e,this.listeners[e]),delete this.listeners[e])}removeAllListeners(){for(const e of Object.keys(this.listeners))this.removeListener(e)}}},78072:(e,t,i)=>{i.d(t,{qm:()=>a,nc:()=>d,qR:()=>s,a9:()=>l});var n=i(87353),r=i(65964);const o="{authId}",a="authId",s="result",l="{result}",d=(()=>{const e={};return{startNewExternalAuthSession:(t,i,r)=>{const d=(e=>{const t=new URL(e).searchParams.get(a);return t&&t!==o?t:(0,n.A)()})(t);return t=t.replace("{oauthRedirectMethod}","deeplink").replace(o,d).replace("{hostRedirectUrl}",r?((e,t)=>{const i=new URL(e);i.searchParams.delete(a),i.searchParams.delete(s);const n=decodeURIComponent(i.searchParams.toString()),r=""===n.trim();i.search="";const o=`${n}${r?"":"&"}`;return encodeURIComponent(`${i.toString()}?${o}${a}=${t}&${s}=${l}`)})(r,d):""),e[d]={handler:i,url:t,timeoutId:window.setTimeout((()=>{i(!1,"OAuth session timeout"),delete e[d]}),12e4)},new URL(t)},completeAuth:(t,i)=>{if("string"==typeof t&&"string"==typeof i){const n=e[t];if(n){window.clearTimeout(n.timeoutId);const o=RegExp(r.lY);i.length>r.OZ?n.handler(!1,r.Di):o.test(i)?n.handler(!0,i):n.handler(!1,r.r),delete e[t]}}}}})()},45701:(e,t,i)=>{i.d(t,{Q:()=>I,I:()=>E});var n=i(17576),r=i(65964),o=i(84498),a=i(78072),s=i(79236),l=i(17282),d=i(26121),c=i(669);class p extends d.B{constructor(e,t,i){super(e,t,i),this.appAuthSdkHost=e,this.telemetryService=t,this.authenticationService=i}initHandlers(){super.initHandlers(),this.registerHandler(r.tz.authentication.notifySuccess,this.handleNotifySuccess),this.registerHandler(r.tz.authentication.notifyFailure,this.handleNotifyFailure)}handleNotifySuccess(e,t){return this.appAuthSdkHost.closeWindow(),this.appAuthSdkHost.stopAuthWindowMonitor(),(0,c.QY)(this.authenticationService.notifySuccess,t)}handleNotifyFailure(e,t){return this.appAuthSdkHost.closeWindow(),this.appAuthSdkHost.stopAuthWindowMonitor(),(0,c.QY)(this.authenticationService.notifyFailure,t,I.Other)}}var u=i(3650);class h extends u.B{constructor(e,t,i){super(e),this.appSdkHost=e,this.authService=t,this.telemetryService=i,this.messageHandlers.push(new p(e,i,t)),this.messageHandlers.push((0,l.n)(e,{},i)),this.messageHandlers.forEach((e=>e.initHandlers()))}}var g=i(23404),v=i(46467),m=i(46764),S=i(35574),f=i(28833),A=i(80378);const C="HostedWebContentAuthSdkService";var I;!function(e){e.AppDefinitionUnavailable="AppDefinitionUnavailable",e.BlockedByBrowser="BlockedByBrowser",e.CancelledByUser="CancelledByUser",e.InvalidAuthUrl="InvalidAuthUrl",e.InvalidFrameContext="InvalidFrameContext",e.Other="Other"}(I||(I={}));class y extends Error{constructor(e,t){super(e),this.failureReason=t,this.name="HostedWebContentAuthSdkServiceInternalError"}}class E extends A.X{constructor(e,t,i,o,a,l,d,p){super(e,a,o,l,d,void 0),this.hostWindow=e,this.openWindowInfo=t,this.appDefinition=i,this.authenticationService=o,this.context=a,this.logger=l,this.onExternalAuthenticationComplete=(e,t)=>{e?this.authenticationService.notifySuccess(t):(t!==r.Di&&t!==r.r||this.logger.log(s.$.Error,C,t),this.authenticationService.notifyFailure(t))},this.onAuthMessageReceived=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!this.authWindow||this.authWindow!==e.source)return;const t=e.origin;t!==this.origin&&this.checkUrlIsValid(t)&&(this.origin=e.origin),this.origin===t&&this.messageProcessor&&(yield this.messageProcessor.process((0,c.mW)(e,!1)))})),this.setupAuthMessageHandlers=()=>{this.authenticationService&&(this.messageProcessor=new h(this,this.authenticationService,this.telemetryService))};try{this.passContextForUrlValidation=(0,S.eZ)().authExtensionContextForUrlValidation,this.context.app.host.clientType!==g.WK.desktop||this.authenticationService.externalAuthService||this.logger.log(s.$.Warn,C,r.Px),this.context.page.frameContext!==g.E2.authentication&&this.notifyAsFailureAndThrowError("Invalid frame context for scenario",I.InvalidFrameContext),this.appDefinition||this.notifyAsFailureAndThrowError("App definition not available",I.AppDefinitionUnavailable),this.telemetryService.setAppDefinition(this.appDefinition),this.checkUrlIsValid(t.url)||this.notifyAsFailureAndThrowError("Auth url is not valid",I.InvalidAuthUrl),this.shouldUseExternalAuthenticationWorkflow(a.app.host.clientType,p)?this.launchExternalAuthenticationWorkflow(t.url):this.launchEmbeddedAuthenticationWorkflow(a,t)}catch(e){let t,i="",n=!1;if(e instanceof y?(i=e.message,t=e.failureReason,n=!1):e instanceof Error?(i=e.message,t=I.Other,n=!1):(i="Unknown error",t=I.Other,n=!0),this.authenticationService&&this.authenticationService.notifyFailure(i,t),l.log(s.$.Error,C,`Error in constructor: ${i}, failure reason: ${t}`),n)throw e}}launchEmbeddedAuthenticationWorkflow(e,t){const i=(0,m.v)(t);if(e.app.host.clientType===g.WK.desktop&&this.authenticationService.externalAuthService)try{this.authWindow=this.authenticationService.externalAuthService.openUrlInEmbeddedBrowser(new URL(t.url),i)}catch(e){null!==this.authWindow&&(this.logger.log(s.$.Error,C,`openUrlInEmbeddedBrowser threw an error but still returned a non-null window object? Forcing window object to null. Error = ${e}`),this.authWindow=null)}else this.authWindow=this.hostWindow.open(t.url,"appAuthWindow",i);if(!this.authWindow)throw new y("URL was unable to be opened in embedded browser",I.BlockedByBrowser);this.setupEmbeddedAuthWindow(t.url,e,this.hostWindow)}launchExternalAuthenticationWorkflow(e){const t=a.nc.startNewExternalAuthSession(e,this.onExternalAuthenticationComplete,this.authenticationService.externalAuthRedirectUrl);try{this.authenticationService.externalAuthService?this.authenticationService.externalAuthService.openUrlInExternalBrowser(t):this.hostWindow.open(t)}catch(e){throw new y("Failed to open the URL in external browser",I.Other)}}shouldUseExternalAuthenticationWorkflow(e,t){return e===g.WK.desktop&&!0===t}notifyAsFailureAndThrowError(e,t){throw this.authenticationService&&this.authenticationService.notifyFailure(e,t),new y(`Failure message: ${e}, failure reason: ${t}`)}setupEmbeddedAuthWindow(e,t,i){var n;this.origin=e,this.setUserClickTime(null!==(n=t.app.userClickTime)&&void 0!==n?n:Date.now()),t.app.userClickTimeV2&&this.setUserClickTimeV2(t.app.userClickTimeV2),this.setupAuthMessageHandlers(),this.globalWindowEventListener=new o.J(i),this.globalWindowEventListener.addListener("message",this.onAuthMessageReceived),this.startAuthWindowMonitor(),this.initializeAuthenticationContext(t)}checkUrlIsValid(e){return this.passContextForUrlValidation?(0,v.dE)(e,this.logger,this.appDefinition,this.context):(0,v.dE)(e,this.logger,this.appDefinition)}getHostWindow(){return this.authWindow||null}postResponseToApp(e,t){this.sendResponseMessage(e,t)}postDeeplyNestedResponseToApp(){throw new Error("Auth window does not support nested request communication")}isWindowOpen(){return!!this.authWindow&&!this.authWindow.closed}closeWindow(){this.unloadApp(this.appDefinition)}sendResponseMessage(e,t){var i;if(this.origin){const n={id:e.id,uuidAsString:null===(i=e.uuid)||void 0===i?void 0:i.toString(),args:t,origin:this.origin,monotonicTimestamp:(0,f.So)()};this.postMessage(n)}}sendRequestMessage(e,t){if(this.origin){const i={func:e,args:t,monotonicTimestamp:(0,f.So)()};this.postMessage(i)}}startAuthWindowMonitor(){this.stopAuthWindowMonitor(),this.authWindowMonitor=this.hostWindow.setInterval((()=>{this.authWindowInterval()}),100)}authWindowInterval(){this.isWindowOpen()?this.sendRequestMessage("ping"):(this.HandleError("CancelledByUser",I.CancelledByUser),this.closeWindow(),this.stopAuthWindowMonitor())}stopAuthWindowMonitor(){this.authWindowMonitor&&(this.hostWindow.clearInterval(this.authWindowMonitor),this.authWindowMonitor=void 0)}unloadApp(e){var t;this.unloadSDK(),null===(t=this.authWindow)||void 0===t||t.close()}unloadSDK(){this.globalWindowEventListener&&this.globalWindowEventListener.removeListener("message")}postMessage(e){var t;this.origin&&(null===(t=this.authWindow)||void 0===t||t.postMessage(e,this.origin))}HandleError(e,t){this.authenticationService&&this.authenticationService.notifyFailure(e,t)}}},57170:(e,t,i)=>{i.d(t,{U:()=>n});class n{constructor(){this.registrations=new Map}addEventListener(e,t){this.registrations.set(e,t)}dispatchEvent(e,t){this.registrations.has(e)&&this.registrations.get(e)(t)}clearListeners(){this.registrations.clear()}}},69537:(e,t,i)=>{var n,r,o,a,s,l,d,c,p,u,h,g,v;i.d(t,{CO:()=>c,Jz:()=>n,O4:()=>r,QY:()=>d,he:()=>o,jI:()=>u,jw:()=>p,ut:()=>h}),function(e){e.Unknown="unknown",e.Loading="loading",e.WaitingForAppLoad="WaitingForAppLoad",e.Loaded="loaded",e.Failed="failed",e.Unloading="unloading",e.Unloaded="unloaded",e.Cached="cached"}(n||(n={})),function(e){e[e.NOT_SUPPORTED_ON_PLATFORM=100]="NOT_SUPPORTED_ON_PLATFORM",e[e.INTERNAL_ERROR=500]="INTERNAL_ERROR",e[e.NOT_SUPPORTED_IN_CURRENT_CONTEXT=501]="NOT_SUPPORTED_IN_CURRENT_CONTEXT",e[e.PERMISSION_DENIED=1e3]="PERMISSION_DENIED",e[e.NETWORK_ERROR=2e3]="NETWORK_ERROR",e[e.NO_HW_SUPPORT=3e3]="NO_HW_SUPPORT",e[e.INVALID_ARGUMENTS=4e3]="INVALID_ARGUMENTS",e[e.UNAUTHORIZED_USER_OPERATION=5e3]="UNAUTHORIZED_USER_OPERATION",e[e.INSUFFICIENT_RESOURCES=6e3]="INSUFFICIENT_RESOURCES",e[e.THROTTLE=7e3]="THROTTLE",e[e.USER_ABORT=8e3]="USER_ABORT",e[e.OPERATION_TIMED_OUT=8001]="OPERATION_TIMED_OUT",e[e.OLD_PLATFORM=9e3]="OLD_PLATFORM",e[e.FILE_NOT_FOUND=404]="FILE_NOT_FOUND",e[e.SIZE_EXCEEDED=1e4]="SIZE_EXCEEDED"}(r||(r={})),function(e){e.INTERNAL_ERROR="INTERNAL_ERROR"}(o||(o={})),function(e){e[e.Standard=0]="Standard",e[e.Edu=1]="Edu",e[e.Class=2]="Class",e[e.Plc=3]="Plc",e[e.Staff=4]="Staff"}(a||(a={})),function(e){e.Regular="Regular",e.Private="Private",e.Shared="Shared"}(s||(s={})),function(e){e[e.Admin=0]="Admin",e[e.User=1]="User",e[e.Guest=2]="Guest"}(l||(l={})),function(e){e.Inline="inline",e.Desktop="desktop",e.Web="web"}(d||(d={})),function(e){e.M365Content="m365content"}(c||(c={})),function(e){e.DriveId="driveId",e.GroupId="groupId",e.SiteId="siteId",e.UserId="userId"}(p||(p={})),function(e){e.Public="public",e.EUDB="eudb",e.DOD="dod",e.DOJ="doj"}(u||(u={})),function(e){e.Public="public",e.EUDB="eudb",e.Other="other"}(h||(h={})),function(e){e[e.PreviousLandmark=0]="PreviousLandmark",e[e.NextLandmark=1]="NextLandmark",e[e.Read=2]="Read",e[e.Compose=3]="Compose"}(g||(g={})),function(e){e[e.PreviousLandmark=0]="PreviousLandmark",e[e.NextLandmark=1]="NextLandmark",e[e.GoToActivityFeed=2]="GoToActivityFeed"}(v||(v={}))},12720:(e,t,i)=>{var n,r;i.d(t,{g:()=>r,z:()=>n}),function(e){e.Large="large",e.Medium="medium",e.Small="small"}(n||(n={})),function(e){e.Card="card",e.Url="url"}(r||(r={}))},89847:(e,t,i)=>{var n,r;i.d(t,{Nh:()=>o,cZ:()=>n,nq:()=>r,x:()=>a}),function(e){e.DeepLinkDialog="DeepLinkDialog",e.DeepLinkOther="DeepLinkOther",e.DeepLinkStageView="DeepLinkStageView",e.GenericUrl="GenericUrl"}(n||(n={})),function(e){e.INTERNAL_ERROR="INTERNAL_ERROR",e.INVALID_LINK="INVALID_LINK",e.NOT_SUPPORTED="NOT_SUPPORTED"}(r||(r={}));const o="Deep links are only supported in Message Extensions",a="Action.Submit is only supported in Message Extensions"},55977:(e,t,i)=>{var n,r,o,a;i.d(t,{FH:()=>n,Xg:()=>s,cG:()=>o,ci:()=>r,m_:()=>a}),function(e){e.ActionExecuteInvokeRequest="ActionExecuteInvokeRequest",e.QueryMessageExtensionRequest="QueryMessageExtensionRequest"}(n||(n={})),function(e){e.ActionExecuteInvokeResponse="ActionExecuteInvokeResponse",e.QueryMessageExtensionResponse="QueryMessageExtensionResponse"}(r||(r={})),function(e){e.SSOToken="ssoToken",e.OAuthCode="oauthCode"}(o||(o={})),function(e){e.INTERNAL_ERROR="INTERNAL_ERROR"}(a||(a={}));const s="Action.Execute"},79236:(e,t,i)=>{var n;i.d(t,{$:()=>n}),function(e){e.Debug="Debug",e.Info="Info",e.Warn="Warn",e.Error="Error"}(n||(n={}))},59983:(e,t,i)=>{var n,r;i.d(t,{W:()=>r,m:()=>n}),function(e){e.GeoLocation="geolocation",e.Media="media",e.Midi="midi",e.Notifications="notifications",e.OpenExternal="openExternal"}(n||(n={})),function(e){e.Consented="consented",e.Revoked="revoked",e.NeverAsked="neverAsked"}(r||(r={}))},75973:(e,t,i)=>{i.d(t,{Fb:()=>o,kh:()=>a,tL:()=>r});var n=i(65964);const r="api.appInitialization.sdkLoaded",o={[n.tz.initialize]:"api.appInitialization.initialize",[n.tz.appInitialization.appLoaded]:"api.appInitialization.appLoaded",[n.tz.appInitialization.success]:"api.appInitialization.success",[n.tz.appInitialization.failure]:"api.appInitialization.failure",[n.tz.appInitialization.expectedFailure]:"api.appInitialization.expectedFailure",[n.tz.appEntity.selectAppEntity]:"api.appEntity.selectAppEntity",[n.tz.appInstallDialog.openAppInstallDialog]:"api.appInstallDialog.openAppInstallDialog",[n.tz.authentication.authenticate]:"api.authentication.authenticate",[n.tz.authentication.getAuthToken]:"api.getAuthToken",[n.tz.authentication.getUser]:"api.getUser",[n.tz.authentication.notifyFailure]:"api.authentication.notifyFailure",[n.tz.authentication.notifySuccess]:"api.authentication.notifySuccess",[n.tz.barCode.scanBarCode]:"api.barCode.scanBarCode",[n.tz.calendar.composeMeeting]:"api.calendar.composeMeeting",[n.tz.calendar.openCalendarItem]:"api.calendar.openCalendarItem",[n.tz.call.startCall]:"api.call.startCall",[n.tz.chat.openChat]:"api.chat.openChat",[n.tz.clipboard.readFromClipboard]:"api.clipboard.readFromClipboard",[n.tz.clipboard.writeToClipboard]:"api.clipboard.writeToClipboard",[n.tz.conversations.closeConversation]:"api.conversations.closeConversation",[n.tz.conversations.getChatMembers]:"api.conversations.getChatMembers",[n.tz.conversations.openConversation]:"api.conversations.openConversation",[n.tz.copilot.eligibility.getEligibilityInfo]:"api.copilot.eligibility.getEligibilityInfo",[n.tz.copilot.customTelemetry.sendCustomTelemetryData]:"api.copilot.customTelemetry.sendCustomTelemetryData",[n.tz.dialogs.open]:"api.dialogs.open",[n.tz.dialogs.submit]:"api.dialogs.submit",[n.tz.dialogs.update.resize]:"api.dialogs.update.resize",[n.tz.externalAppAuthentication.authenticateAndResendRequest]:"api.externalAppAuthentication.authenticateAndResendRequest",[n.tz.externalAppAuthentication.authenticateWithOauth2]:"api.externalAppAuthentication.authenticateWithOauth2",[n.tz.externalAppAuthentication.authenticateWithPowerPlatformConnectorPlugins]:"api.externalAppAuthentication.authenticateWithPowerPlatformConnectorPlugins",[n.tz.externalAppAuthentication.authenticateWithSSO]:"api.externalAppAuthentication.authenticateWithSSO",[n.tz.externalAppAuthentication.authenticateWithSSOAndResendRequest]:"api.externalAppAuthentication.authenticateWithSSOAndResendRequest",[n.tz.externalAppAuthenticationForCEA.authenticateAndResendRequest]:"api.externalAppAuthenticationForCEA.authenticateAndResendRequest",[n.tz.externalAppAuthenticationForCEA.authenticateWithSSOAndResendRequest]:"api.externalAppAuthenticationForCEA.authenticateWithSSOAndResendRequest",[n.tz.externalAppAuthenticationForCEA.authenticateWithOauth]:"api.externalAppAuthenticationForCEA.authenticateWithOauth",[n.tz.externalAppAuthenticationForCEA.authenticateWithSSO]:"api.externalAppAuthenticationForCEA.authenticateWithSSO",[n.tz.externalAppCardActions.processActionOpenUrl]:"api.externalAppCardActions.processActionOpenUrl",[n.tz.externalAppCardActions.processActionSubmit]:"api.externalAppCardActions.processActionSubmit",[n.tz.externalAppCardActionsForCEA.processActionOpenUrl]:"api.externalAppCardActionsForCEA.processActionOpenUrl",[n.tz.externalAppCardActionsForCEA.processActionSubmit]:"api.externalAppCardActionsForCEA.processActionSubmit",[n.tz.externalAppCommands.processActionCommand]:"api.externalAppCommands.processActionCommand",[n.tz.files.addCloudStorageFolder]:"api.files.addCloudStorageFolder",[n.tz.files.copyMoveFiles]:"api.files.copyMoveFiles",[n.tz.files.deleteCloudStorageFolder]:"api.files.deleteCloudStorageFolder",[n.tz.files.getCloudStorageFolderContents]:"api.files.getCloudStorageFolderContents",[n.tz.files.getCloudStorageFolders]:"api.files.getCloudStorageFolders",[n.tz.files.getExternalProviders]:"api.files.getExternalProviders",[n.tz.files.openFilePreview]:"api.files.openFilePreview",[n.tz.getContext]:"api.getContext",[n.tz.hostEntity.tab.addAndConfigure]:"api.hostEntity.tab.addAndConfigure",[n.tz.hostEntity.tab.reconfigure]:"api.hostEntity.tab.reconfigure",[n.tz.hostEntity.tab.rename]:"api.hostEntity.tab.rename",[n.tz.hostEntity.tab.remove]:"api.hostEntity.tab.remove",[n.tz.hostEntity.tab.getAll]:"api.hostEntity.tab.getAll",[n.tz.interactive.getClientInfo]:"api.interactive.getClientInfo",[n.tz.interactive.getClientRoles]:"api.interactive.getClientRoles",[n.tz.interactive.getFluidContainerId]:"api.interactive.getFluidContainerId",[n.tz.interactive.getFluidTenantInfo]:"api.interactive.getFluidTenantInfo",[n.tz.interactive.getFluidToken]:"api.interactive.getFluidToken",[n.tz.interactive.getNtpTime]:"api.interactive.getNtpTime",[n.tz.interactive.registerClientId]:"api.interactive.registerClientId",[n.tz.interactive.setFluidContainerId]:"api.interactive.setFluidContainerId",[n.tz.links.openLink]:"api.links.openLink",[n.tz.location.getCurrentLocation]:"api.location.getCurrentLocation",[n.tz.location.map.showLocation]:"api.location.map.showLocation",[n.tz.mail.composeMail]:"api.mail.composeMail",[n.tz.mail.openMailItem]:"api.mail.openMailItem",[n.tz.marketplace.addOrUpdateCartItems]:"api.marketplace.addOrUpdateCartItems",[n.tz.marketplace.getCart]:"api.marketplace.getCart",[n.tz.marketplace.removeCartItems]:"api.marketplace.removeCartItems",[n.tz.marketplace.updateCartStatus]:"api.marketplace.updateCartStatus",[n.tz.media.captureImage]:"api.media.captureImage",[n.tz.media.getMedia]:"api.media.getMedia",[n.tz.media.selectMedia]:"api.media.selectMedia",[n.tz.media.viewImages]:"api.media.viewImages",[n.tz.meeting.appShareButton.setOptions]:"api.meeting.appShareButton.setOptions",[n.tz.meeting.getAppContentStageSharingCapabilities]:"api.meeting.getAppContentStageSharingCapabilities",[n.tz.meeting.getAppContentStageSharingState]:"api.meeting.getAppContentStageSharingState",[n.tz.meeting.getAuthenticationTokenForAnonymousUser]:"api.meeting.getAuthenticationTokenForAnonymousUser",[n.tz.meeting.getIncomingClientAudioState]:"api.meeting.getIncomingClientAudioState",[n.tz.meeting.getLiveStreamState]:"api.meeting.getLiveStreamState",[n.tz.meeting.getMeetingDetails]:"api.meeting.getMeetingDetails",[n.tz.meeting.joinMeeting]:"api.meeting.joinMeeting",[n.tz.meeting.requestAppAudioHandling]:"api.meeting.requestAppAudioHandling",[n.tz.meeting.requestStartLiveStreaming]:"api.meeting.requestStartLiveStreaming",[n.tz.meeting.requestStopLiveStreaming]:"api.meeting.requestStopLiveStreaming",[n.tz.meeting.shareAppContentToStage]:"api.meeting.shareAppContentToStage",[n.tz.meeting.stopSharingAppContentToStage]:"api.meeting.stopSharingAppContentToStage",[n.tz.meeting.toggleIncomingClientAudio]:"api.meeting.toggleIncomingClientAudio",[n.tz.meeting.updateMicState]:"api.meeting.updateMicState",[n.tz.meetingRoom.getPairedMeetingRoomInfo]:"api.meetingRoom.getPairedMeetingRoomInfo",[n.tz.meetingRoom.sendCommandToPairedMeetingRoom]:"api.meetingRoom.sendCommandToPairedMeetingRoom",[n.tz.monetization.openPurchaseExperience]:"api.monetization.openPurchaseExperience",[n.tz.nestedAppAuth.execute]:"api.nestedAppAuth.execute",[n.tz.notifications.showNotification]:"api.notifications.showNotification",[n.tz.pages.backStack.navigateBack]:"api.pages.backStack.navigateBack",[n.tz.pages.config.remove.failure]:"api.pages.config.remove.failure",[n.tz.pages.config.remove.success]:"api.pages.config.remove.success",[n.tz.pages.config.save.failure]:"api.pages.config.save.failure",[n.tz.pages.config.save.success]:"api.pages.config.save.success",[n.tz.pages.config.setConfig]:"api.pages.config.setConfig",[n.tz.pages.config.setValidityState]:"api.pages.config.setValidityState",[n.tz.pages.currentApp.navigateTo]:"api.pages.currentApp.navigateTo",[n.tz.pages.currentApp.navigateToDefaultPage]:"api.pages.currentApp.navigateToDefaultPage",[n.tz.pages.fullTrust.enterFullscreen]:"api.pages.fullTrust.enterFullscreen",[n.tz.pages.fullTrust.exitFullscreen]:"api.pages.fullTrust.exitFullscreen",[n.tz.pages.getConfig]:"api.pages.getConfig",[n.tz.pages.navigateCrossDomain]:"api.pages.navigateCrossDomain",[n.tz.pages.navigateToApp]:"api.pages.navigateToApp",[n.tz.pages.returnFocus]:"api.pages.returnFocus",[n.tz.pages.setCurrentFrame]:"api.pages.setCurrentFrame",[n.tz.pages.shareDeepLink]:"api.pages.shareDeepLink",[n.tz.pages.tabs.getMruTabInstances]:"api.pages.tabs.getMruTabInstances",[n.tz.pages.tabs.getTabInstances]:"api.pages.tabs.getTabInstances",[n.tz.pages.tabs.navigateToTab]:"api.pages.tabs.navigateToTab",[n.tz.people.selectPeople]:"api.people.selectPeople",[n.tz.permissions.requestUserConsentForPermission]:"api.permissions.requestUserConsentForPermission",[n.tz.permissions.storageService.getPermissionStatus]:"api.permissions.storageService.getPermissionStatus",[n.tz.profile.showProfile]:"api.profile.showProfile",[n.tz.registerHandler]:"api.registerHandler",[n.tz.remoteCamera.getCapableParticipants]:"api.remoteCamera.getCapableParticipants",[n.tz.remoteCamera.requestControl]:"api.remoteCamera.requestControl",[n.tz.remoteCamera.sendControlCommand]:"api.remoteCamera.sendControlCommand",[n.tz.remoteCamera.terminateSession]:"api.remoteCamera.terminateSession",[n.tz.search.closeSearch]:"api.search.closeSearch",[n.tz.search.unregister]:"api.search.unregister",[n.tz.stageView.open]:"api.stageView.open",[n.tz.stageView.self.close]:"api.stageView.self.close",[n.tz.store.openFullStore]:"api.store.openFullStore",[n.tz.store.openAppDetail]:"api.store.openAppDetail",[n.tz.store.openInContextStore]:"api.store.openInContextStore",[n.tz.store.openSpecificStore]:"api.store.openSpecificStore",[n.tz.teams.fullTrust.getConfigSetting]:"api.teams.fullTrust.getConfigSetting",[n.tz.teams.fullTrust.joinedTeams.getUserJoinedTeams]:"api.teams.fullTrust.joinedTeams.getUserJoinedTeams",[n.tz.teams.getTeamChannels]:"api.teams.getTeamChannels",[n.tz.teams.refreshSiteUrl]:"api.teams.refreshSiteUrl",[n.tz.webStorage.isWebStorageClearedOnUserLogOut]:"api.webStorage.isWebStorageClearedOnUserLogOut"},a=new Map([[n.tz.initialize,"initialize"],[n.tz.appInitialization.appLoaded,"appLoaded"],[n.tz.appInitialization.success,"success"],[n.tz.appInitialization.failure,"failure"],[n.tz.appInitialization.expectedFailure,"expectedFailure"]])},23404:(e,t,i)=>{i.d(t,{BD:()=>o,E2:()=>l,UH:()=>n,WK:()=>s,Yj:()=>u,hn:()=>a,j5:()=>d});var n,r,o,a,s,l,d,c=i(17576),p=i(18763);!function(e){e.bing="Bing",e.cmc="CMC",e.cmcMobile="CMCMobile",e.edge="Edge",e.edgeSidebar="EdgeSidebar",e.office="Office",e.orange="Orange",e.outlook="Outlook",e.outlookWin32="OutlookWin32",e.teams="Teams",e.teamsModern="TeamsModern",e.windowsCopilot="WindowsCopilot"}(n||(n={})),function(e){e.windows="windows",e.macOs="macos"}(r||(r={})),function(e){e.default="default",e.dark="dark",e.highContrast="contrast"}(o||(o={})),function(e){e.fileOpenPreference="fileOpenPreference",e.theme="theme"}(a||(a={})),function(e){e.web="web",e.desktop="desktop"}(s||(s={})),function(e){e.settings="settings",e.content="content",e.authentication="authentication",e.remove="remove",e.task="task",e.sidePanel="sidePanel",e.meetingStage="meetingStage"}(l||(l={})),function(e){e.TextPlain="text/plain",e.TextHtml="text/html",e.ImagePNG="image/png",e.ImageJPEG="image/jpeg"}(d||(d={}));const u=e=>{const{uuidAsString:t}=e,i=(0,c.__rest)(e,["uuidAsString"]);return Object.assign(Object.assign({},i),{uuid:new p.k(t)})}},57532:(e,t,i)=>{i.d(t,{u7:()=>R});var n=i(42882),r=i(64262),o=i(42662),a=i(91421),s=i(42349),l=i(63907),d=i(99577),c=i(42465),p=i(30143),u=i(65964),h=i(69537),g=i(75973),v=i(79236),m=i(23404),S=i(46467),f=i(19141),A=i(35574),C=i(17864),I=i(25672),y=i(66310),E=i(90850),b=i(28833);class R{constructor(e,t,i){var c,p;this.hubInfo=e,this.customTelemetryService=i,this.letterRegex=/[a-zA-Z]/,this.consumerTid="9188040d-6c67-4c5b-b112-36a304b66dad",this.telemetrySource="AppHostSdk",this.namespace="Office.AppHostingSdk",this.eventFieldPrefix="AppHost",this.ariaTenantToken="7ada8d16f9234e2093f080920f21dd7d-41cee27e-93c2-4a6b-a7aa-2001e852d387-7123",this.nexusTenantToken=n.di,this.anonymousDataFields=[...r.A.Office.System.User.getFields("User",{isAnonymous:!0})];let h=[(0,o.m9)(`${this.eventFieldPrefix}.HostName`,this.hubInfo.name),(0,o.m9)(`${this.eventFieldPrefix}.HostVersion`,this.hubInfo.version),(0,o.m9)(`${this.eventFieldPrefix}.HostSdkVersion`,u.eO),(0,o.m9)(`${this.eventFieldPrefix}.HostSessionId`,this.hubInfo.sessionId),(0,o.m9)(`${this.eventFieldPrefix}.TelemetrySource`,this.telemetrySource),(0,o.m9)(`${this.eventFieldPrefix}.Platform`,t.app.host.clientType===m.WK.web?"Web":"Desktop"),(0,o.m9)(`${this.eventFieldPrefix}.HostRingId`,null!==(c=null==t?void 0:t.app.host.ringId)&&void 0!==c?c:"")];this.telemetryLogger=new a.M,this.telemetryLogger.setTenantToken(this.namespace,this.ariaTenantToken,this.nexusTenantToken);const g=D(t.user.dataResidency);if(g){this.oneDsSink=new l.r(h,{endpointUrl:g});const e=new d.d("HubSDKServiceEventThrottler",this.oneDsSink);e.setNamedEventThrottle(`${this.namespace}.${this.sanitizeScenarioName("api.getContext")}`,6),e.setNamedEventThrottle(`${this.namespace}.${this.sanitizeScenarioName("api.registerHandler")}`,5),e.setNamedEventThrottle(`${this.namespace}.${this.sanitizeScenarioName("api.getAuthToken")}`,4),this.oneDsSink.addPreprocessor(e),this.telemetryLogger.telemetrySinks=[this.oneDsSink]}let v=s.qw.getFields({name:"OfficeAppHostingSdk"});null===(p=this.oneDsSink)||void 0===p||p.addPersistentDataFields(v),this.setAppContext(t),this.isTest=(()=>function(){return void 0!==window.Cypress}()||function(){var e;return"undefined"!=typeof process&&void 0!==(null===(e=null===process||void 0===process?void 0:process.env)||void 0===e?void 0:e.JEST_WORKER_ID)}())(),this.enableExtendedInitializationTracking=(null==i?void 0:i.enableExtendedInitializationTracking)||!1}createScenario(e,t,i,n,r="monotonic",o){var a,s;const l=i?{type:r,value:i}:(0,b.qV)();t=null!=t?t:null===(a=this.appDefinition)||void 0===a?void 0:a.id;const d=this.isTest?void 0:this.telemetryLogger.createActivity(this.createTelemetryEvent(e,l.value,t,n)),c=this.shouldCustomTelemetryScenarioReceiveAppInitTelemetry(e)?null===(s=this.customTelemetryService)||void 0===s?void 0:s.createScenario(e,t,l.value,n,l.type):void 0,p=this.shouldLogToAria(e,t);return"appInitialization"==e||"appInitializationExtended"==e?(this.addAppInitializationDataFields(),new w(this,p,l,c,d,(0,C.m)(this.appDefinition),e)):(this.addHubSdkTelemetryScenarioDataFields(l.value,null!=o&&o),new T(this,p,l,c,d))}shouldCustomTelemetryScenarioReceiveAppInitTelemetry(e){var t,i;return e!==g.tL&&(!f.Up.has(e)||!(0,f.Dz)(null===(t=this.appDefinition)||void 0===t?void 0:t.id)||null!==(i=(0,A.eZ)().shouldCustomTelemetryScenarioReceiveAppInitTelemetry)&&void 0!==i&&i)}addAppInitializationDataFields(){var e,t,i,n,r,a,s,l,d,c,p,u,h,g,v,f;let C=(0,o.m9)(`${this.eventFieldPrefix}.ActionId`,null!==(i=null===(t=null===(e=this.appContext)||void 0===e?void 0:e.actionInfo)||void 0===t?void 0:t.actionId)&&void 0!==i?i:""),I=(0,o.m9)("ManifestVersion",null!==(r=null===(n=this.appDefinition)||void 0===n?void 0:n.manifestVersion)&&void 0!==r?r:""),E=(0,o.LK)("ShowLoadingIndicator",null!==(s=null===(a=this.appDefinition)||void 0===a?void 0:a.showLoadingIndicator)&&void 0!==s&&s),b=(0,o.LK)(R.CACHEDAPP_IND_FIELD_NAME,null!==(l=this.usingCachedApp)&&void 0!==l&&l),T=(0,o.LK)(R.BACKGROUND_LOAD_IND_FIELD_NAME,null!==(p=null===(c=null===(d=this.appContext)||void 0===d?void 0:d.page)||void 0===c?void 0:c.isBackgroundLoad)&&void 0!==p&&p);const w=(0,y.U2)(this.appContext)&&this.appDefinition?function(e){if(e.frameContext===m.E2.sidePanel||e.frameContext===m.E2.meetingStage||e.frameContext===m.E2.content)return e.meetingId?"Meeting":e.chatId?"Chat":e.channelId?"Channel":"Personal"}((0,S.ut)(this.appContext,this.appDefinition)):void 0,D=(0,o.m9)("InteractionContext",w||"");let k=(0,o.Ug)("UserClickTime",null!==(h=null===(u=this.appContext)||void 0===u?void 0:u.app.userClickTime)&&void 0!==h?h:0),x=(0,o.Ug)("UserClickTimeV2",null!==(v=null===(g=this.appContext)||void 0===g?void 0:g.app.userClickTimeV2)&&void 0!==v?v:0),O=(0,o.m9)("FeatureFlags",JSON.stringify((0,A.eZ)()));null===(f=this.oneDsSink)||void 0===f||f.addPersistentDataFields([C,I,E,b,T,D,k,x,O])}addHubSdkTelemetryScenarioDataFields(e,t){var i;let n=(0,o.Ug)("AppSdkRequestCreationTimeStamp",e),r=(0,o.LK)("IsProxiedFromChild",t);null===(i=this.oneDsSink)||void 0===i||i.addPersistentDataFields([n,r])}static getApiVersionTagForTelemetry(e,t){if(null!=t){if(null==e&&(0,p.satisfies)(t,R.TEAMS_JS_LIBRARY_V1))return"v1";if(null==e&&(0,p.satisfies)(t,`>${R.TEAMS_JS_LIBRARY_V2_LOWEST_VERSION}`)&&(0,p.satisfies)(R.TEAMS_JS_LIBRARY_VERSION_WITH_APIVERSIONTAG,`>${t}`))return"unknown";if(e&&(0,p.satisfies)(t,`>=${R.TEAMS_JS_LIBRARY_VERSION_WITH_APIVERSIONTAG}`))return e}return null==e?"undefined_tag":e}setAppSdkVersion(e){this.appSdkVersion=e}getAppSdkVersion(){return this.appSdkVersion}setAppContext(e){var t,i,n,r,a,l,d;let c=this.appContext;if(this.appContext=e,this.oneDsSink){if((0,y.U2)(e)&&(!(0,y.U2)(c)||e.user.id!==c.user.id)){let o,l=!e.user.id;if(l)o=this.anonymousDataFields;else{let d=(null===(i=null===(t=this.appContext.user)||void 0===t?void 0:t.tenant)||void 0===i?void 0:i.id)!==this.consumerTid;o=s.KJ.getFields({primaryIdentityHash:null===(n=e.user)||void 0===n?void 0:n.id,primaryIdentitySpace:d?"UserObjectId":"MSAPuid",tenantId:null===(a=null===(r=this.appContext.user)||void 0===r?void 0:r.tenant)||void 0===a?void 0:a.id,tenantGroup:d?"Commercial":"Consumer",isAnonymous:l})}this.oneDsSink.addPersistentDataFields(o)}if(this.appContext.app.sessionId!==(null==c?void 0:c.app.sessionId)){let e=s.Nn.getFields({id:null!==(l=this.appContext.app.sessionId)&&void 0!==l?l:""});this.oneDsSink.addPersistentDataFields(e)}if(this.appContext.app.locale!==(null==c?void 0:c.app.locale)){let e=(0,o.m9)("Culture.UiLanguage",null!==(d=this.appContext.app.locale)&&void 0!==d?d:"");this.oneDsSink.addPersistentDataFields([e])}}}setAppDefinition(e){this.appDefinition=e}isSessionIdSet(){var e;return!!(null===(e=this.appContext)||void 0===e?void 0:e.app.sessionId)}setUsingCachedApp(e){this.usingCachedApp=e}createTelemetryEvent(e,t,i,n){var r,a,s,l,d,c,p,u,h;const g=[(0,o.m9)("HostedAppId",null!=i?i:""),(0,o.m9)("HostedAppEntityId",null!==(s=null===(a=null===(r=this.appContext)||void 0===r?void 0:r.page)||void 0===a?void 0:a.id)&&void 0!==s?s:""),(0,o.m9)(R.APPSDK_VERSION_FIELD_NAME,null!==(l=this.appSdkVersion)&&void 0!==l?l:""),(0,o.m9)(R.APPSDK_API_VERSION_TAG_FIELD_NAME,R.getApiVersionTagForTelemetry(n,this.appSdkVersion)),(0,o.m9)("HostedAppFrameContext",null!==(p=null===(c=null===(d=this.appContext)||void 0===d?void 0:d.page)||void 0===c?void 0:c.frameContext)&&void 0!==p?p:""),(0,o.m9)("HostedAppSessionId",null!==(h=null===(u=this.appContext)||void 0===u?void 0:u.app.sessionId)&&void 0!==h?h:"")];return{eventName:`${this.namespace}.${this.sanitizeScenarioName(e)}`,eventFlags:{dataCategories:2,diagnosticLevel:110},dataFields:g,timestamp:t}}sanitizeScenarioName(e){let t="",i=!0;for(let n=0;n<e.length;n++){let r=e.charAt(n);"."===r&&0!==n&&"."!==t.charAt(t.length-1)?(t+=r,i=!0):this.letterRegex.test(r)?i?(i=!1,t+=r.toUpperCase()):t+=r:i=!0}return t}isAppStoreAppId(e){return!(0,A.eZ)().disableExtendedTelemetryForMetaOSStoreApps&&!!e&&u.pm.has(e)}shouldLogToAria(e,t){return!e.startsWith("eventDispatch")&&("appInitializationExtended"!==e||this.isAppStoreAppId(t))}}R.TEAMS_JS_LIBRARY_V1="1.x",R.TEAMS_JS_LIBRARY_V2_LOWEST_VERSION="2.0.0-beta.0",R.TEAMS_JS_LIBRARY_VERSION_WITH_APIVERSIONTAG="2.21.0",R.APPSDK_VERSION_FIELD_NAME="HostedAppSdkVersion",R.APPSDK_API_VERSION_TAG_FIELD_NAME="HostedAppSdkApiVersionTag",R.CACHEDAPP_IND_FIELD_NAME="UsingCachedApp",R.APP_TERMINATE_REASON="HostedAppTerminateReason",R.BACKGROUND_LOAD_IND_FIELD_NAME="IsBackgroundLoad",R.WEB_CONTENT_SDK_ID="WebContentSdkId",R.COMM_BRIDGE_ID="CommunicationBridgeId",R.COMM_BRIDGE_LISTENERS_ADDED="CommunicationBridgeListenersAdded",R.IFRAME_SRC="IFrameInfoSrc",R.IFRAME_ORIGIN="IFrameOrigin",R.APP_DEFINITION="AppDefinition",R.USER_CLICK_TIME="UserClickTime",R.USER_CLICK_TIME_V2="UserClickTimeV2",R.APP_STATE_UPDATED="AppStateUpdated";class T{constructor(e,t,i,n,r,o){this.logger=e,this.shouldLogToAria=t,this.initialTimestamp=i,this.customScenario=n,this.activity=r,this.name=o,this.lastMark=(0,A.eZ)().useGlobalMonotonicTimersForTelemetry?i:(0,b.TE)(i)}addOrUpdateActivityDataField(e,t){var i,n,r,a,s,l,d;let c=null===(i=this.activity)||void 0===i?void 0:i.dataFields.find((t=>t.name==e));c?c.value=t:"string"==typeof t?null===(r=null===(n=this.activity)||void 0===n?void 0:n.dataFields)||void 0===r||r.push((0,o.m9)(e,t)):"boolean"==typeof t?null===(s=null===(a=this.activity)||void 0===a?void 0:a.dataFields)||void 0===s||s.push((0,o.LK)(e,t)):"number"==typeof t&&(null===(d=null===(l=this.activity)||void 0===l?void 0:l.dataFields)||void 0===d||d.push((0,o.Ug)(e,t)))}oldMarkPhase(e,t){var i,n,r;const a=(0,b.P7)(),s=a-this.lastMark.value;t||(this.lastMark.value=a),null===(n=null===(i=this.activity)||void 0===i?void 0:i.dataFields)||void 0===n||n.push((0,o.Ug)(`Activity.Phase.${e}`,s)),null===(r=this.customScenario)||void 0===r||r.markPhase(e)}markPhase(e,t=!1){var i,n,r;if(!(0,A.eZ)().useGlobalMonotonicTimersForTelemetry)return this.oldMarkPhase(e,t);const a=(0,b.qV)(this.lastMark.type);if(this.lastMark.type!==a.type)return void(0,I.i)().log(v.$.Warn,"telemetry","The last mark was set to be a monotonic timer without checking for support for the performance API.");const s=(0,b.Hg)(a.value-this.lastMark.value);t||(this.lastMark=a),null===(n=null===(i=this.activity)||void 0===i?void 0:i.dataFields)||void 0===n||n.push((0,o.Ug)(`Activity.Phase.${e}`,s)),null===(r=this.customScenario)||void 0===r||r.markPhase(e)}trackMessageDelay(e,t,i){var n,r;null===(r=null===(n=this.customScenario)||void 0===n?void 0:n.trackMessageDelay)||void 0===r||r.call(n,e,t,i)}stop(){var e,t;void 0===(null===(e=this.activity)||void 0===e?void 0:e.success)&&(this.endActivity(!0),null===(t=this.customScenario)||void 0===t||t.stop())}fail(e){var t,i,n,r;void 0===(null===(t=this.activity)||void 0===t?void 0:t.success)&&(null===(n=null===(i=this.activity)||void 0===i?void 0:i.dataFields)||void 0===n||n.push((0,o.m9)("ErrorMessage",(0,y.VQ)(e))),this.endActivity(!1),null===(r=this.customScenario)||void 0===r||r.fail(e))}endActivity(e){var t,i;if("appInitialization"==this.name){const e=JSON.stringify((0,E.Xz)());null===(i=null===(t=this.activity)||void 0===t?void 0:t.dataFields)||void 0===i||i.push((0,o.m9)("AppLoadingBreakdown",null!=e?e:""))}this.shouldLogToAria&&this.activity&&this.logger.isSessionIdSet()&&(this.activity.success=e,this.activity.endNow())}addDetails(e){var t,i;null===(i=null===(t=this.customScenario)||void 0===t?void 0:t.addDetails)||void 0===i||i.call(t,e)}}class w extends T{constructor(e,t,i,n,r,o,a){super(e,t,i,n,r,a),this.logger=e,this.shouldLogToAria=t,this.initialTimestamp=i,this.customScenario=n,this.activity=r,this.isFirstParty=o,this.name=a}fail(e,t){var i,n,r;null===(n=null===(i=this.activity)||void 0===i?void 0:i.dataFields)||void 0===n||n.push((0,o.m9)("ErrorMessage",(0,y.VQ)(e))),this.endActivity(!1),null===(r=this.customScenario)||void 0===r||r.fail(this.isFirstParty&&t?e.concat(":",t):e)}markWarnMessage(e){var t,i;null===(i=null===(t=this.activity)||void 0===t?void 0:t.dataFields)||void 0===i||i.push((0,o.m9)("WarnMessage",(0,y.VQ)(e)))}}const D=e=>{switch(e){case h.jI.EUDB:return c.d.EUDB;case h.jI.DOD:return c.d.USGOV_DOD;case h.jI.DOJ:return c.d.USGOV_DOJ;case h.jI.Public:return c.d.PUBLIC;default:return}}},19141:(e,t,i)=>{i.d(t,{Dz:()=>a,Up:()=>l,vJ:()=>s});var n=i(65964),r=i(75973),o=i(35574);function a(e){return void 0!==e&&n.mP.has(e)&&!(0,o.eZ)().disableDebuggingTelemetryToAria}function s(e,t){return r.kh.has(e)&&!a(t)}const l=new Map([["api.appInitialization.initialize",n.tz.initialize],["api.appInitialization.appLoaded",n.tz.appInitialization.appLoaded],["api.appInitialization.success",n.tz.appInitialization.success],["api.appInitialization.failure",n.tz.appInitialization.failure],["api.appInitialization.expectedFailure",n.tz.appInitialization.expectedFailure]])},18549:(e,t,i)=>{i.d(t,{l:()=>r});var n=i(99594);class r{constructor(e){this.appIdAsString=e,(0,n.z)(e)}toString(){return this.appIdAsString}get id(){return this.appIdAsString}}},99594:(e,t,i)=>{i.d(t,{z:()=>o});var n=i(69537),r=i(669);function o(e,t){if(function(e){return/<script[^>]*>[\s\S]*?<\/script[^>]*>/gi.test(e)}(e)||!function(e){return e.length<256&&e.length>4}(e)||!function(e){for(let t=0;t<e.length;t++){const i=e.charCodeAt(t);if(i<32||i>126)return!1}return!0}(e))throw null!=t?t:(0,r.jC)(n.O4.INVALID_ARGUMENTS,"App ID is not valid.")}},46764:(e,t,i)=>{function n(e){let t="";return e.width&&e.height&&(t=`width=${e.width},height=${e.height}`,void 0!==e.left&&void 0!==e.top&&(t=`${t},left=${e.left},top=${e.top}`)),t}i.d(t,{v:()=>n})},31459:(e,t,i)=>{i.d(t,{$:()=>r,F:()=>o});var n=i(19411);const r=e=>a(e),o=e=>a(e,!0),a=(e,t=!1)=>{var i,n;if(!e)return s();const r=t?c(null===(i=e.userClassification)||void 0===i?void 0:i.eduType,null===(n=e.userClassification)||void 0===n?void 0:n.persona):c(e.eduType,e.persona);return{cohort:d(e.cohort),ageGroup:l(e.ageGroup),isCopilotEnabledRegion:!!e.isCopilotEnabledRegion||!!e.isCodexEnabledRegion,isCopilotEligible:!!e.isCopilotEligible,isOptedOutByAdmin:!!e.isOptedOutByAdmin,userClassification:r,featureSet:p(e.featureSet)}},s=()=>({ageGroup:null,cohort:null,isCopilotEligible:!1,isCopilotEnabledRegion:!1,isOptedOutByAdmin:!1,userClassification:null,featureSet:{uxFeatures:[],serverFeatures:[]}}),l=e=>{switch(e){case"None":default:return null;case"Adult":return n.ob.Adult;case"MinorNoParentalConsentRequired":return n.ob.MinorNoParentalConsentRequired;case"MinorWithOutParentalConsent":return n.ob.MinorWithoutParentalConsent;case"MinorWithParentalConsent":return n.ob.MinorWithParentalConsent;case"NotAdult":return n.ob.NonAdult}},d=e=>{switch(e){case"BCAIS":return n.yO.BCAIS;case"BCWAF":return n.yO.BCWAF;case"BCWBF":return n.yO.BCWBF;case"None":return n.yO.None;default:return null}},c=(e,t)=>{if("None"===t)return{persona:n.FN.Other};if("Faculty"===t||"Student"===t){const i="Faculty"===t?n.FN.Faculty:n.FN.Student;switch(e){case"Hed":return{persona:i,eduType:n.fw.HigherEducation};case"K12":return{persona:i,eduType:n.fw.K12};case"Others":return{persona:i,eduType:n.fw.Other};default:return null}}return null},p=e=>({uxFeatures:(null==e?void 0:e.uxFeatures)||[],serverFeatures:(null==e?void 0:e.serverFeatures)||[]})},46467:(e,t,i)=>{i.d(t,{g:()=>b,NJ:()=>g,Po:()=>E,T3:()=>k,I:()=>v,u6:()=>f,tZ:()=>I,cZ:()=>y,ZJ:()=>C,wr:()=>S,hq:()=>m,F6:()=>F,dE:()=>u,fc:()=>O,Xl:()=>P,ut:()=>U,dA:()=>h});var n=i(23145),r=i(65964),o=i(69537),a=i(79236),s=i(23404);class l{constructor(){this.items=new Map,this.add=e=>{if(e){const t=e.toLowerCase();if(!this.items.has(t))return this.items.set(t,e),!0}return!1},this.values=()=>Array.from(this.items.values())}}var d=i(35574);const c=e=>e&&new URL(e).host,p=/([\[\]\^\$\|\(\)\\\.\+\*\?\{\}\=\!\<\>\-])/gi,u=(e,t,i,n)=>{try{return void 0!==i&&F(new URL(e),v(i,n),t)}catch(e){return t.log(a.$.Error,"isValidOriginForApp","Invalid origin",null),!1}},h=(e,t,i,n)=>{const o=U(i,n),s=_(e,i,o);if(void 0!==n&&F(new URL(s),v(n,i),t))return s;throw t.log(a.$.Error,"tryFormatAndGetValidUrl",r.Si,null),r.Si},g=e=>{let t=[];for(const i of e)i.match(r.GE)||t.push(i);return t},v=(e,t)=>{var i,n,r;const o=new l;return e.validDomains&&e.validDomains.forEach((e=>o.add(D(e,t)))),null===(i=e.pages.configurable)||void 0===i||i.forEach((e=>o.add(c(w(e.configurationUrl,t))))),null===(n=e.pages.static)||void 0===n||n.forEach((e=>{e.contentUrl&&o.add(c(w(e.contentUrl,t)))})),(null===(r=null==e?void 0:e.connector)||void 0===r?void 0:r.configurationUrl)&&o.add(c(e.connector.configurationUrl)),Array.from(o.values())},m=e=>!!e&&r.pm.has(e.toLowerCase()),S=e=>(e=>!!e&&r.a$.has(e.toLowerCase()))(null==e?void 0:e.id),f=(e,t,i,n,o,a=!1,l=!1)=>{var c,p,u;const h=l&&n?A(n):void 0;if((i.name===s.UH.teams||i.name===s.UH.teamsModern)&&t&&t.length>0&&(!n||n.isFullTrust||(e=>e&&-1!==r.tp.indexOf(e.toLowerCase()))(n.id))){if(n){const i=(0,d.eZ)().restrictedFullTrustOverrides;if(i){let r;if(i.forEach((e=>{e.appId===n.id&&(r=e)})),r)return l?T(e,t,o,r,h):T(e,t,o,r)}}return l&&h&&R(t[0],h),Promise.resolve(t)}if(null===(c=null==n?void 0:n.webApplicationInfo)||void 0===c?void 0:c.resource){let i;return i=1===(null==t?void 0:t.length)&&("api://{teamSiteDomain}"===t[0]&&"https://{teamSiteDomain}"===(null===(p=null==n?void 0:n.webApplicationInfo)||void 0===p?void 0:p.resource)||"api://{mySiteDomain}"===t[0]&&"https://{mySiteDomain}"===(null===(u=null==n?void 0:n.webApplicationInfo)||void 0===u?void 0:u.resource))?w(t[0],o):k(n,o),i&&(x(i,e)||a)?(l&&h&&R(i,h),Promise.resolve([i])):Promise.reject("App resource defined in manifest and iframe origin do not match")}return Promise.reject("App webApplicationInfo or resource not defined in manifest")},A=e=>E(e)||b(e),C=e=>!!(null==e?void 0:e.composeExtension),I=e=>{var t;return"BotBased"===(null===(t=e.composeExtension)||void 0===t?void 0:t.type)},y=e=>{var t;return null===(t=null==e?void 0:e.copilotAgents)||void 0===t?void 0:t.customEngineAgents.length},E=e=>{if(I(e)){const t=e.composeExtension.botId;if(!t)throw"botID cannot be undefined in BotBased composeExtension";return t}},b=e=>{if(y(e)){const t=e.copilotAgents.customEngineAgents.filter((e=>"bot"===e.type));if(!t.length)throw"The type bot is missing from the customEngineAgents";if(t.length>1)throw"There cannot be multiple bot types in the customEngineAgents";const i=t[0].id;if(!i)throw"bot id cannot be undefined in CEA";return i.toString()}},R=(e,t)=>{let i;if((0,d.eZ)().useUrlClassForValidDomains)i=(e.startsWith("https://")||e.startsWith("api://"))&&(0,n.A)(t)&&e.includes(`/botid-${t}`);else{const n="^((https|api):/(/.+)?/botid-{botId})".replace("{botId}",t);i=new RegExp(n,"i").test(e)}if(!i)throw"Resource is not valid"},T=(e,t,i,n,r)=>{let o=!0;return n?t.forEach((t=>{var r;if(o){const a=w(t,i);let s=!1;null===(r=n.resources)||void 0===r||r.forEach((n=>{if(!s&&n){const r=w(n.resource,i);if(a===r)if(n.requireOriginMatch){try{const i=new URL(e),n=new URL(t);i.hostname===n.hostname&&(s=!0)}catch(e){}e===r&&(s=!0)}else s=!0}})),s||(o=!1)}})):o=!1,o?(r&&R(t[0],r),Promise.resolve(t)):Promise.reject("App resource defined in manifest and iframe origin do not match")},w=(e,t)=>{var i,n,r,o,a,s,l,d,c,p,u,h;if(!t)return e;const g=function(e){return void 0!==e.page}(t)?t:void 0,v={teamSiteDomain:(null===(i=null==g?void 0:g.sharePointSite)||void 0===i?void 0:i.teamSiteDomain)||"",teamSitePath:(null===(n=null==g?void 0:g.sharePointSite)||void 0===n?void 0:n.teamSitePath)||"",teamSiteUrl:(null===(r=null==g?void 0:g.sharePointSite)||void 0===r?void 0:r.teamSiteUrl)||"",mySiteDomain:(null===(o=null==g?void 0:g.sharePointSite)||void 0===o?void 0:o.mySiteDomain)||"",mySitePath:(null===(a=null==g?void 0:g.sharePointSite)||void 0===a?void 0:a.mySitePath)||"",channelRelativeUrl:(null===(s=null==g?void 0:g.channel)||void 0===s?void 0:s.relativeUrl)||"",sharePointSite:{teamSiteDomain:(null===(l=null==g?void 0:g.sharePointSite)||void 0===l?void 0:l.teamSiteDomain)||"",teamSitePath:(null===(d=null==g?void 0:g.sharePointSite)||void 0===d?void 0:d.teamSitePath)||"",teamSiteUrl:(null===(c=null==g?void 0:g.sharePointSite)||void 0===c?void 0:c.teamSiteUrl)||"",mySiteDomain:(null===(p=null==g?void 0:g.sharePointSite)||void 0===p?void 0:p.mySiteDomain)||"",mySitePath:(null===(u=null==g?void 0:g.sharePointSite)||void 0===u?void 0:u.mySitePath)||""},channel:{relativeUrl:(null===(h=null==g?void 0:g.channel)||void 0===h?void 0:h.relativeUrl)||""}};return z(e,v)},D=(e,t)=>{var i,n,r,o;if(!t)return e;const a={teamSiteDomain:(null===(i=t.sharePointSite)||void 0===i?void 0:i.teamSiteDomain)||"",mySiteDomain:(null===(n=t.sharePointSite)||void 0===n?void 0:n.mySiteDomain)||"",sharePointSite:{teamSiteDomain:(null===(r=t.sharePointSite)||void 0===r?void 0:r.teamSiteDomain)||"",mySiteDomain:(null===(o=t.sharePointSite)||void 0===o?void 0:o.mySiteDomain)||""}};return z(e,a)},k=(e,t)=>{var i,n;return(null===(i=e.webApplicationInfo)||void 0===i?void 0:i.resource)&&w(null===(n=e.webApplicationInfo)||void 0===n?void 0:n.resource,t)},x=(e,t)=>{if(!e.startsWith("https:")&&!e.startsWith("api:"))return!1;if(!(e=e.replace("api://","https://"))||!t)return!1;if(e===t)return!0;if((0,d.eZ)().useStrictValidDomainRuleDetection)try{const i=new URL(t),n=new URL(e);return!(i.origin!==n.origin||!i.origin||!n.origin)}catch(e){return!1}else{if(!(0,d.eZ)().useUrlClassForValidDomains){const i=(0,d.eZ)().escapeRegExSpecialCharactersInValidDomains?(e=>e&&new URL(e).host.replace(p,"\\$1"))(t):c(t),n=r.pi.validResourcePattern.replace(r.pi.resourceDomainParameter,i);return new RegExp(n,"i").test(e)}try{const i=new URL(t),n=new URL(e);return!(i.hostname!==n.hostname||!i.origin||!n.origin)}catch(e){return!1}}},O=e=>{try{const t=new URL(e);return"https:"===t.protocol||"api:"===t.protocol}catch(e){return!1}},F=(e,t,i)=>{const n=P(e),r=new l;let o=[...t];const s=g([...t]);s.length>0&&(i.log(a.$.Debug,"isUrlInDomainList",`Invalid domain detected with ${s}}`),(0,d.eZ)().wildcardValidDomainRuleDetection&&(o=o.filter((e=>!s.includes(e)))));for(const e of o){if(!r.add(e))continue;const t=H(e),i=new RegExp(`^https://${t}((/|\\?).*)?$`,"i");if(n.match(i))return!0}return!1},H=e=>{if(!0===(0,d.eZ)().wildcardValidDomainRuleDetection&&g([e]).length>0)throw new Error("The wildcardValidDomainRuleDetection flag is enabled and an improper wildcard domain segment was detected: "+e);return e.replaceAll(".","[.]").replaceAll("*","[^/^.]+")},P=e=>e.href,_=(e,t,i)=>{let n=z(e,M(t));return n=z(n,i),n},z=(e,t,i=[])=>{const n=e.indexOf("?");let r="",o="";return n>0?(r=e.substring(0,n),o=e.substring(n)):r=e,r&&(r=L(r,t,i,(e=>encodeURI(e)))),o&&(o=L(o,t,i,(e=>encodeURIComponent(e)))),r+o},L=(e,t,i=[],n)=>{if(void 0!==t)if("object"==typeof t)for(const r in t)e=L(e,t[r],i.concat(r),n);else if((0,d.eZ)().useUrlClassForValidDomains)e=e.replaceAll(`{${i.join(".")}}`,n(t));else{const r=i.join("."),o=new RegExp(`{${r.replace(".","\\.")}}`,"g");e=e.replace(o,n(t))}return e},M=e=>{var t,i,n,r,a;return{actionInfo:{actionId:(null===(t=e.actionInfo)||void 0===t?void 0:t.actionId)||"",actionObjects:(null===(i=e.actionInfo)||void 0===i?void 0:i.actionObjects)||[]},user:Object.assign(Object.assign({id:"",licenseType:""},e.user),{tenant:Object.assign({id:"",sku:""},null===(n=e.user)||void 0===n?void 0:n.tenant)}),app:Object.assign({iconPositionVertical:0,parentMessageId:"",userFileOpenPreference:o.QY.Inline,userClickTime:0,userClickTimeV2:0},e.app),page:Object.assign({isFullScreen:!1,subPageId:"",isMultiWindow:!1,sourceOrigin:""},e.page),meeting:{id:(null===(r=e.meeting)||void 0===r?void 0:r.id)||""},chat:{id:(null===(a=e.chat)||void 0===a?void 0:a.id)||""},channel:e.channel,sharePointSite:e.sharePointSite,sharepoint:e.sharepoint,team:e.team}};function U(e,t){var i,n,r;return{actionInfo:e.actionInfo,locale:e.app.locale,appSessionId:e.app.sessionId||"",appLaunchId:e.app.launchId||"",appId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",theme:e.app.theme,appIconPosition:e.app.iconPositionVertical||0,osLocaleInfo:e.app.osLocaleInfo,parentMessageId:e.app.parentMessageId||"",userClickTime:e.app.userClickTime||0,userClickTimeV2:e.app.userClickTimeV2||0,userFileOpenPreference:e.app.userFileOpenPreference||o.QY.Inline,manifestVersion:(null==t?void 0:t.manifestVersion)||"",hostName:e.app.host.name,hostClientType:e.app.host.clientType,sessionId:e.app.host.sessionId||"",ringId:e.app.host.ringId,entityId:e.page.id||"",frameContext:e.page.frameContext,subEntityId:e.page.subPageId||"",isFullScreen:e.page.isFullScreen||!1,isMultiWindow:e.page.isMultiWindow||!1,isBackgroundLoad:e.page.isBackgroundLoad,sourceOrigin:e.page.sourceOrigin||"",userObjectId:void 0!==e.user?e.user.id:void 0,isCallingAllowed:void 0!==e.user?e.user.isCallingAllowed:void 0,isPSTNCallingAllowed:void 0!==e.user?e.user.isPSTNCallingAllowed:void 0,userLicenseType:void 0!==e.user?e.user.licenseType:"",loginHint:void 0!==e.user?e.user.loginHint:void 0,userPrincipalName:void 0!==e.user?e.user.userPrincipalName:void 0,upn:void 0!==e.user?e.user.userPrincipalName:void 0,userDisplayName:void 0!==e.user?e.user.displayName:void 0,tid:void 0!==e.user&&void 0!==e.user.tenant?e.user.tenant.id:void 0,tenantSKU:(null===(r=null===(n=null==e?void 0:e.user)||void 0===n?void 0:n.tenant)||void 0===r?void 0:r.sku)||"",channelId:void 0!==e.channel?e.channel.id:void 0,channelName:void 0!==e.channel?e.channel.displayName:void 0,channelRelativeUrl:void 0!==e.channel?e.channel.relativeUrl:void 0,channelType:void 0!==e.channel?e.channel.membershipType:void 0,defaultOneNoteSectionId:void 0!==e.channel?e.channel.defaultOneNoteSectionId:void 0,hostTeamGroupId:void 0!==e.channel?e.channel.ownerGroupId:void 0,hostTeamTenantId:void 0!==e.channel?e.channel.ownerTenantId:void 0,chatId:void 0!==e.chat?e.chat.id:"",meetingId:void 0!==e.meeting?e.meeting.id:"",sharepoint:e.sharepoint,teamId:void 0!==e.team?e.team.internalId:void 0,teamName:void 0!==e.team?e.team.displayName:void 0,teamType:void 0!==e.team?e.team.type:void 0,groupId:void 0!==e.team?e.team.groupId:void 0,teamTemplateId:void 0!==e.team?e.team.templateId:void 0,isTeamArchived:void 0!==e.team?e.team.isArchived:void 0,userTeamRole:void 0!==e.team?e.team.userRole:void 0,teamSiteId:void 0!==e.sharePointSite?e.sharePointSite.teamSiteId:void 0,teamSiteUrl:void 0!==e.sharePointSite?e.sharePointSite.teamSiteUrl:void 0,teamSiteDomain:void 0!==e.sharePointSite?e.sharePointSite.teamSiteDomain:void 0,teamSitePath:void 0!==e.sharePointSite?e.sharePointSite.teamSitePath:void 0,mySiteDomain:void 0!==e.sharePointSite?e.sharePointSite.mySiteDomain:void 0,mySitePath:void 0!==e.sharePointSite?e.sharePointSite.mySitePath:void 0,dialogParameters:e.dialogParameters}}},35574:(e,t,i)=>{i.d(t,{Eh:()=>o,eZ:()=>r});let n={wildcardValidDomainRuleDetection:!0,extendedAppLoadTimeoutInMillis:void 0,authExtensionContextForUrlValidation:!0,escapeRegExSpecialCharactersInValidDomains:!0,useUrlClassForValidDomains:!0,useStrictValidDomainRuleDetection:!0,resetTimerWhenInitCalledAndWaitForNotifySuccess:!1,createAndSendSignalsToSubstrate:!0,useGlobalMonotonicTimersForTelemetry:!1,shouldLazilyWriteDefaultDevicePermissions:!1,disableFirstPartyAppsAsMicrosoftOwned:!1,shouldCustomTelemetryScenarioReceiveAppInitTelemetry:!1,disableDebuggingTelemetryToAria:!1,disableExtendedTelemetryForMetaOSStoreApps:!1,useStrictAppIdValidationInStorage:!1,recreateCommBridgeListenersBeforeLoadingApp:!1,overrideForEachInitStateChangeTimeoutsInMs:void 0,useNewAppInitializationExperience:!1};function r(){return n}function o(e){return function(e){n=e}(Object.assign(Object.assign({},n),e)),n}},17864:(e,t,i)=>{i.d(t,{C:()=>r,m:()=>o});var n=i(35574);function r(e){return(0,n.eZ)().disableFirstPartyAppsAsMicrosoftOwned?e:Object.assign(Object.assign({},e),{isRestrictedToFirstPartyOrLobApps:e.isRestrictedToFullTrustOrLobApps||e.isRestrictedToFirstPartyOrLobApps,isRestrictedToMicrosoftOwnedOrFullTrustApps:e.isRestrictedToMicrosoftOwnedOrFullTrustApps||e.isRestrictedToFullTrustApps,isRestrictedToFullTrustApps:!1,isRestrictedToFullTrustOrLobApps:!1})}function o(e){return(0,n.eZ)().disableFirstPartyAppsAsMicrosoftOwned?!!(null==e?void 0:e.isFullTrust):!!(null==e?void 0:e.isMicrosoftOwned)||!!(null==e?void 0:e.isFullTrust)}},25672:(e,t,i)=>{i.d(t,{i:()=>o});class n{constructor(){this.logSubscribers=new Set}subscribeToLogs(e){if(this.logSubscribers.has(e))throw new Error("This logger has already been subscribed; duplicate subscriptions are not allowed.");this.logSubscribers.add(e)}unsubscribeFromLogs(e){return this.logSubscribers.delete(e)}unsubscribeAll(){return this.logSubscribers.clear()}log(e,t,i,n){this.logSubscribers.forEach((r=>{r.log(e,t,i,n)}))}}class r{constructor(){}static getInstance(){return r.instance||(r.instance=new n),r.instance}}function o(){return r.getInstance()}},66310:(e,t,i)=>{i.d(t,{AU:()=>u,Di:()=>h,Hk:()=>A,L9:()=>d,OL:()=>g,Tq:()=>y,U2:()=>m,VQ:()=>I,Xs:()=>v,YF:()=>p,Zn:()=>f,aw:()=>l,jZ:()=>C,sB:()=>s,x7:()=>c,xy:()=>E});var n=i(65964),r=i(69537);const o=new RegExp("[a-zA-Z0-9_\\-\\.]+(@|%40|%2540)[a-zA-Z0-9_\\-\\.]+\\.[a-zA-Z]{2,5}","g"),a="email_removed",s=`${n.PZ.teamsMicrosoftUrl}`,l=new URL(`${s}/l/`),d=(e,t)=>{var i,n;const r=null===(n=null===(i=e.pages)||void 0===i?void 0:i.static)||void 0===n?void 0:n.find((e=>e.entityId===t));return null==r?void 0:r.name},c=e=>"userSettingsChange"===e,p=(e,t)=>c(e)?{userSettingsChange:{userSettingTypes:t}}:{[`${e}`]:!0},u=e=>{let t;try{t=new URL(e).hostname}catch(e){return!1}return n.MU.some((e=>t===e||t.endsWith("."+e)))},h=(e,t)=>{var i,n;const r=e.split(".").map(Number),o=t.split(".").map(Number),a=Math.max(r.length,o.length);for(let e=0;e<a;e++){const t=null!==(i=r[e])&&void 0!==i?i:0,a=null!==(n=o[e])&&void 0!==n?n:0;if(t<a)return!0;if(t>a)return!1}return!1},g=(e,t)=>e.state===r.Jz.Failed&&t,v=(e,t)=>{const i=e.state===r.Jz.Loaded&&u(window.location.href)&&h(e.appSdkVersion||"0",n.DX);return!t&&(e.state===r.Jz.Failed||i)},m=e=>!!e&&void 0!==e.user.id,S={majorVersion:1,minorVersion:5};function f(){return`${S.majorVersion}.${S.minorVersion}`}function A(e){return e.majorVersion<S.majorVersion||e.majorVersion==S.majorVersion&&e.minorVersion<S.minorVersion}const C=e=>{let t;return t=e===r.jI.Public?r.ut.Public:e===r.jI.EUDB?r.ut.EUDB:r.ut.Other,t};function I(e){return e?function(e){return e&&(e=e.replace(o,a)),e}(e):""}function y(e,t){if(t&&t.size>0){let i=[];t.forEach(((e,t)=>{t&&e&&i.push(`${t}=${e}`)})),e+="?"+i.join("&")}return e}function E(e){const t=e.trim(),i=t.indexOf(" ");if(-1!==i){const e=t.substring(i+1).split(",").filter(Boolean).map((e=>e.trim())),n=3,r={error:void 0,claims:void 0};if(e.forEach((e=>{const t=e.split('"');if(t.length===n)switch(t[0].toLocaleLowerCase()){case"error=":r.error=t[1];break;case"claims=":r.claims=t[1]}})),"insufficient_claims"===r.error)return r.claims}}},90850:(e,t,i)=>{i.d(t,{Ct:()=>n,Xz:()=>h,Z1:()=>r,e5:()=>u,wF:()=>d});var n,r,o=i(17576),a=i(65964),s=i(28833);!function(e){e.Start="start",e.End="end"}(n||(n={})),function(e){e.MetaOsAppContainerInitiation="metaOsAppContainerInitiation_ms",e.GetPermissions="getPermissions_ms",e.IframeSetAndLoadOrigin="iframeSetAndLoadOrigin_ms",e.OverallAppLoadTimeBeforeInitialize="overallAppLoadTimeBeforeInitialize_ms",e.InitializeMessageDelay="initializeMessageDelay_ms",e.InitializeMessageProcessTime="initializeMessageProcessTime_ms",e.AppLoadedMessageDelay="appLoadedMessageDelay_ms",e.AppLoadedMessageProcessTime="appLoadedMessageProcessTime_ms",e.SuccessMessageDelay="successMessageDelay_ms",e.SuccessMessageProcessTime="successMessageProcessTime_ms",e.FailureMessageDelay="failureMessageDelay_ms",e.FailureMessageProcessTime="failureMessageProcessTime_ms",e.ExpectedFailureMessageDelay="expectedFailureMessageDelay_ms",e.ExpectedFailureMessageProcessTime="expectedFailureMessageProcessTime_ms"}(r||(r={}));const l={[r.MetaOsAppContainerInitiation]:0,[r.GetPermissions]:0,[r.IframeSetAndLoadOrigin]:0,[r.OverallAppLoadTimeBeforeInitialize]:0,[r.InitializeMessageDelay]:0,[r.InitializeMessageProcessTime]:0,[r.AppLoadedMessageDelay]:0,[r.AppLoadedMessageProcessTime]:0,[r.SuccessMessageDelay]:0,[r.SuccessMessageProcessTime]:0,[r.FailureMessageDelay]:0,[r.FailureMessageProcessTime]:0,[r.ExpectedFailureMessageDelay]:0,[r.ExpectedFailureMessageProcessTime]:0};function d(e,t){const i=function(e){return(0,s.qV)(e.type).value-e.value}(t);switch(e){case a.tz.initialize:l.initializeMessageDelay_ms=i;break;case a.tz.appInitialization.appLoaded:l.appLoadedMessageDelay_ms=i;break;case a.tz.appInitialization.success:l.successMessageDelay_ms=i}return i}const c={};let p=!1;function u(e,t){if(!p&&function(e){return Object.values(r).includes(e)}(t)&&"object"==typeof window&&"object"==typeof window.performance&&"now"in window.performance){const i=performance.now();if(e!==n.Start||c.hasOwnProperty(t)){if(e===n.End){const e=c[t];if(void 0!==e){const n=parseFloat((i-e).toFixed(2));l[t]=Math.max(l[t],n)}delete c[t]}}else c[t]=i}}function h(){const e=Object.assign({},l);return function(){(0,o.__awaiter)(this,void 0,void 0,(function*(){p=!0;for(const e in l)l.hasOwnProperty(e)&&(l[e]=0);for(const e in c)c.hasOwnProperty(e)&&delete c[e];yield new Promise((e=>setTimeout(e,0))),p=!1}))}(),e}},28833:(e,t,i)=>{i.d(t,{Bp:()=>d,Hg:()=>l,P7:()=>p,So:()=>s,TE:()=>c,qV:()=>o});var n=i(35574);const r=function(){return performance&&"object"==typeof performance&&["now","timeOrigin"].map((e=>e in performance)).every((e=>e))}();function o(e="monotonic"){return(0,n.eZ)().useGlobalMonotonicTimersForTelemetry&&a(e)||a("date")}function a(e){switch(e){case"date":return{type:"date",value:Date.now()};case"monotonic":if(!r)return;return{type:"monotonic",value:performance.now()+performance.timeOrigin};default:throw new Error(`Unsupported timestamp type: ${e}`)}}function s(){var e;return null===(e=a("monotonic"))||void 0===e?void 0:e.value}function l(e){return Math.floor(1e3*e)}function d(e,t){return r&&e&&(0,n.eZ)().useGlobalMonotonicTimersForTelemetry?{type:"monotonic",value:e}:t?{type:"date",value:t}:void 0}function c(e){return{type:e.type,value:p()-1e3*(Date.now()-e.value)}}function p(){return r?1e3*Math.floor(performance.now()):1e3*Date.now()}},18763:(e,t,i)=>{i.d(t,{k:()=>o});var n=i(87353),r=i(23145);class o{constructor(e){this.uuid=(0,n.A)(),this.uuid=e||(0,n.A)(),(0,r.A)(this.uuid)}toString(){return this.uuid}}},80378:(e,t,i)=>{i.d(t,{X:()=>a});var n=i(57532),r=i(18763),o=i(28833);class a{constructor(e,t,i,o,a,s){this.hostWindow=e,this.context=t,this.authenticationService=i,this.logger=o,this.customTelemetryService=a,this.onAppInitStateChanged=s,this.initialized=!1,this.webContentSdkId=(new r.k).toString(),this.initializeAuthenticationContext=e=>{var t;this.context=e,this.contextPromise=null===(t=this.authenticationService)||void 0===t?void 0:t.getUser().then((e=>{var t,i,n,r,o,a,s,l,d;const c=Object.assign(Object.assign({},null===(t=this.context)||void 0===t?void 0:t.user),{id:(null===(i=null==e?void 0:e.profile)||void 0===i?void 0:i.oid)||"",displayName:(null===(n=null==e?void 0:e.profile)||void 0===n?void 0:n.displayName)||"",loginHint:(null===(r=null==e?void 0:e.profile)||void 0===r?void 0:r.loginHint)||"",userPrincipalName:(null===(o=null==e?void 0:e.profile)||void 0===o?void 0:o.upn)||"",tenant:{id:(null===(a=null==e?void 0:e.profile)||void 0===a?void 0:a.tid)||"",sku:null===(d=null===(l=null===(s=this.context)||void 0===s?void 0:s.user)||void 0===l?void 0:l.tenant)||void 0===d?void 0:d.sku}}),p=Object.assign(Object.assign({},this.context.app),{userClickTime:this.getUserClickTime()}),u=Object.assign(Object.assign({},this.context),{app:p,user:c});return this.telemetryService.setAppContext(u),u}))},this.getContext=()=>this.context,this.getAppContext=()=>this.contextPromise?this.contextPromise.then((e=>e)).catch((()=>this.context)):Promise.resolve(this.context),this.getAppDefinition=()=>this.appDefinition,this.checkIfCachedAndRequestAllowed=e=>!0,this.setAppInitInfo=e=>{this.onAppInitStateChanged&&this.onAppInitStateChanged(e)},this.getLogger=()=>this.logger,this.telemetryService=new n.u7(this.getHubInfo(),t,this.customTelemetryService),this.context.app.userClickTime&&(this.userClickTime=this.context.app.userClickTime),this.context.app.userClickTimeV2&&(this.userClickTimeV2=this.context.app.userClickTimeV2)}getTelemetryService(){return this.telemetryService}getWebContentSdkId(){return this.webContentSdkId}isInitialized(){return this.initialized}setInitialized(e){this.initialized=e}getHubInfo(){return{name:this.context.app.host.name,version:this.context.app.host.version,clientType:this.context.app.host.clientType,sessionId:this.context.app.host.sessionId}}createTelemetryScenarioForAppTermination(e,t){var i,r;const o=this.telemetryService.createScenario("appTermination",e.id);null===(i=o.addOrUpdateActivityDataField)||void 0===i||i.call(o,n.u7.APP_TERMINATE_REASON,t),null===(r=o.addOrUpdateActivityDataField)||void 0===r||r.call(o,n.u7.WEB_CONTENT_SDK_ID,this.webContentSdkId),o.stop()}createTelemetryScenarioForUnloadSdk(e){var t,i,r;const o=this.telemetryService.createScenario("sdkUnload",null===(t=this.appDefinition)||void 0===t?void 0:t.id);null===(i=o.addOrUpdateActivityDataField)||void 0===i||i.call(o,n.u7.WEB_CONTENT_SDK_ID,this.webContentSdkId),null===(r=o.addOrUpdateActivityDataField)||void 0===r||r.call(o,n.u7.COMM_BRIDGE_ID,(null==e?void 0:e.toString())||"unknown"),o.stop()}createTelemetryScenarioForWebContentSdkCreated(e,t){var i,r,o;const a=this.telemetryService.createScenario("webContentSdkCreated");null===(i=a.addOrUpdateActivityDataField)||void 0===i||i.call(a,n.u7.WEB_CONTENT_SDK_ID,this.webContentSdkId),null===(r=a.addOrUpdateActivityDataField)||void 0===r||r.call(a,n.u7.COMM_BRIDGE_ID,(null==t?void 0:t.toString())||"unknown"),null===(o=a.addOrUpdateActivityDataField)||void 0===o||o.call(a,n.u7.COMM_BRIDGE_LISTENERS_ADDED,e),a.stop()}createTelemetryScenarioForSetFrameAndLoadOrigin(e,t,i,r,o,a){var s,l,d,c,p,u,h,g;const v=null===(s=this.telemetryService)||void 0===s?void 0:s.createScenario("setFrameAndLoadOrigin");null===(l=v.addOrUpdateActivityDataField)||void 0===l||l.call(v,n.u7.WEB_CONTENT_SDK_ID,this.webContentSdkId),null===(d=v.addOrUpdateActivityDataField)||void 0===d||d.call(v,n.u7.COMM_BRIDGE_ID,(null==a?void 0:a.toString())||"unknown"),null===(c=v.addOrUpdateActivityDataField)||void 0===c||c.call(v,n.u7.COMM_BRIDGE_LISTENERS_ADDED,e),null===(p=v.addOrUpdateActivityDataField)||void 0===p||p.call(v,n.u7.APP_DEFINITION,JSON.stringify(t)),null===(u=v.addOrUpdateActivityDataField)||void 0===u||u.call(v,n.u7.CACHEDAPP_IND_FIELD_NAME,!!r),null===(h=v.addOrUpdateActivityDataField)||void 0===h||h.call(v,n.u7.USER_CLICK_TIME,i),o&&(null===(g=v.addOrUpdateActivityDataField)||void 0===g||g.call(v,n.u7.USER_CLICK_TIME_V2,o)),v.stop()}getHostWindow(){return this.hostWindow}getFrameContext(){return this.context.page.frameContext}getUserClickTime(){return this.userClickTime}setUserClickTime(e){this.userClickTime=e}getUserClickTimeV2(){return this.userClickTimeV2}setUserClickTimeV2(e){this.userClickTimeV2=e}startAppInitializationScenario(){var e,t,i;const r=(0,o.Bp)(this.getUserClickTimeV2(),this.getUserClickTime());this.appInitializationScenario=null===(e=this.telemetryService)||void 0===e?void 0:e.createScenario("appInitialization",void 0,r.value,void 0,r.type),null===(i=(t=this.appInitializationScenario).addOrUpdateActivityDataField)||void 0===i||i.call(t,n.u7.WEB_CONTENT_SDK_ID,this.webContentSdkId)}getAppInitializationScenario(){return this.appInitializationScenario}}},19411:(e,t,i)=>{var n,r,o,a;i.d(t,{FN:()=>n,fw:()=>a,ob:()=>o,yO:()=>r}),function(e){e.Faculty="faculty",e.Student="student",e.Other="other"}(n||(n={})),function(e){e.BCAIS="bcais",e.BCWAF="bcwaf",e.BCWBF="bcwbf",e.None="none"}(r||(r={})),function(e){e.Adult="adult",e.MinorNoParentalConsentRequired="minorNoParentalConsentRequired",e.MinorWithoutParentalConsent="minorWithoutParentalConsent",e.MinorWithParentalConsent="minorWithParentalConsent",e.NonAdult="nonAdult"}(o||(o={})),function(e){e.HigherEducation="higherEducation",e.K12="k12",e.Other="other"}(a||(a={}))},85630:(e,t,i)=>{i.d(t,{SW:()=>Qi});var n=i(17576),r=i(86326),o=i(84498),a=i(79236),s=i(669),l=i(57532),d=i(18763),c=i(46467);class p{constructor(e){this.logger=e,this.id=new d.k,this.MAX_DEPTH_OF_CHILD_IFRAME=6,this.getOrigin=()=>this.origin,this.getFrame=()=>this.frame}setOrigin(e){this.origin=e}onSdkInitialized(e){this.hostEventListener&&this.dispose(),this.hostEventListener=new o.J(e),this.hostEventListener.addListener("message",this.onMessageReceived.bind(this))}onSetFrameAndLoadOrigin(e,t,i,n,r){this.frame=e,this.setOrigin(t),this.appDefinition=i,this.appContext=n,this.handleMessageCallbackIframe=r}postMessage(e,t){const i=this.getOrigin();i&&e.contentWindow?e.contentWindow.postMessage(t,i):this.logger.log(a.$.Error,"IframeCommunicationBridge","Error sending message to iframe")}postMessageWithTransferables(e,t,i){const n=this.getOrigin();n&&e.contentWindow?e.contentWindow.postMessage(t,n,i):this.logger.log(a.$.Error,"IframeCommunicationBridge","Error sending message to iframe with transferables")}postMessageToNestedIframe(e,t){const{func:i="null",source:n,origin:r}=null!=t?t:{};s.ez.has(i)&&(n&&r&&!n.closed?n.postMessage(e,r):this.logger.log(a.$.Error,"IframeCommunicationBridge","Error sending message to nested iframe"))}isEmbeddedRequest(e,t=0){var i;return e===(null===(i=this.frame)||void 0===i?void 0:i.contentWindow)||!(t>this.MAX_DEPTH_OF_CHILD_IFRAME||!(null==e?void 0:e.parent))&&this.isEmbeddedRequest(e.parent,t+1)}onMessageReceived(e){var t;if(!this.frame||this.frame.contentWindow!==e.source)return void(this.handleMessageCallbackIframe&&(null===(t=e.data)||void 0===t?void 0:t.func)&&s.ez.has(e.data.func)&&this.isEmbeddedRequest(e.source)&&this.handleMessageCallbackIframe((0,s.mW)(e,!0)));const i=e.origin;i&&i!==this.getOrigin()&&(0,c.dE)(i,this.logger,this.appDefinition,this.appContext)&&this.setOrigin(i),this.getOrigin()===i&&this.handleMessageCallbackIframe&&this.handleMessageCallbackIframe((0,s.mW)(e,!1))}dispose(){var e;null===(e=this.hostEventListener)||void 0===e||e.removeAllListeners(),this.hostEventListener=void 0}}function u(e,t,i){var n;if(!e)return;const r=e.createScenario("commBridgeDisposed",i);null===(n=null==r?void 0:r.addOrUpdateActivityDataField)||void 0===n||n.call(r,l.u7.COMM_BRIDGE_ID,(null==t?void 0:t.toString())||"unknown"),null==r||r.stop()}const h=()=>({border:0,flex:1}),g=()=>({display:"none"}),v="allow-forms allow-popups allow-popups-to-escape-sandbox allow-pointer-lock allow-scripts allow-same-origin allow-modals allow-downloads allow-top-navigation-to-custom-protocols allow-storage-access-by-user-activation",m=({sdkHost:e,contentUrl:t,frameContext:i,appDefinition:o,title:a,isLoading:s,userClickTime:l,userClickTimeV2:d,allowList:c})=>{const p=r.useRef(null);return r.useEffect((()=>((()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){yield e.setFrameAndLoadOrigin(p.current,t,o,l,void 0,d)}))})(),()=>{e.unloadApp(o,"host_cleanup")})),[o,t,i,p,e,l,d]),r.createElement("iframe",{key:`iframe-${t}`,id:`iframe:${o.id}`,"data-tid":"app-host-iframe",ref:p,style:Object.assign({},s?g():h()),sandbox:v,title:a,allow:c})},S=(e,t,i,n=window)=>{const o=(0,r.useCallback)((()=>{if(i.current&&t.current){const r=t.current.style;if(e)return void(r.display=e?"none":"flex");const o=i.current.getBoundingClientRect(),a=n.scrollX||n.pageXOffset,s=n.scrollY||n.pageYOffset;r.position="absolute",r.left=`${o.left+a}px`,r.top=`${o.top+s}px`,r.width=`${i.current.offsetWidth}px`,r.height=`${i.current.offsetHeight}px`,r.display="flex"}}),[e,t,i,t.current,n]);(0,r.useEffect)((()=>{o();const e=function(e){let t=null;return function(...i){t||(t=setTimeout((()=>((i,n)=>{t=null,e.apply(this,n)})(0,i)),100))}}(o);return n.addEventListener("resize",e),()=>{n.removeEventListener("resize",e)}}),[o,n])};var f=i(69537),A=i(23404);const C=({sdkHost:e,contentUrl:t,appDefinition:i,title:o,isLoading:a,userClickTime:s,userClickTimeV2:l,allowList:d,cacheManagementService:c,communicationBridge:p,setIsUnLoading:u})=>{const g=r.useRef(!1),m=r.useRef(null),C=r.useRef(null),I=r.useRef(!1),[y,E]=r.useState(!1),b=((e,t,i,o,a,s,l,d,c,p)=>r.useCallback((()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){e.current=document.createElement("iframe"),p(!0),e.current.setAttribute("id",(e=>`cacheable-iframe:${e}`)(t.id)),e.current.setAttribute("data-tid","app-host-iframe"),e.current.setAttribute("title",null!=i?i:""),e.current.setAttribute("sandbox",v),e.current.setAttribute("style","border:0"),e.current.setAttribute("key",`iframe-${a}`),document.body.appendChild(e.current),c.addAppToCache({appId:t.id,contentUrl:a,displayName:i,frameContext:A.E2.content},d,e.current),yield o.setFrameAndLoadOrigin(e.current,a.toString(),t,s,!1,l)}))),[e,p,t,i,a,c,d,o,s,l]))(m,i,o,e,t,s,l,p,c,E),R=r.useCallback((e=>{const t=c.getCachedApp(e);return t&&t.currentAppState.state!==f.Jz.Cached?(u(!0),t.unloadingTimeoutDeferred||(t.unloadingTimeoutDeferred=function(){const e={};return e.promise=new Promise(((t,i)=>{e.resolve=t,e.reject=i})),e}()),t.unloadingTimeoutDeferred.promise):Promise.resolve(!0)}),[c,u]);return r.useEffect((()=>{g.current=!1}),[i,t]),r.useEffect((()=>()=>{m.current&&(m.current.style.display="none")}),[i,t,m]),r.useEffect((()=>(I.current=!0,(()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(g.current)return;g.current=!0;const r=(e=>({appId:e,frameContext:A.E2.content}))(i.id);let o=c.getCachedApp(r);const a=o=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(!o)return;u(!1);const n=c.getCachedApp(r);n?e.setFrameAndLoadOrigin(n.frameInfo,t,i,s,!0,l):b()}));if(o&&c.isAppRegisteredForCaching(o)){if(m.current=o.frameInfo,E(!0),!I.current)return;const e=yield R(r);yield a(e)}else{const e=yield R(r);yield a(e)}}))})(),()=>{e.unloadApp(i,"host_cleanup"),I.current=!1,g.current=!1,m.current=null,E(!1)})),[c,i,e,t,s,l,I,R,u,b]),r.useEffect((()=>{m.current&&d&&m.current.setAttribute("allow",d)}),[i,d,m,y]),S(a,m,C),r.createElement((()=>r.createElement("div",{ref:C,style:h(),id:"cachable-div-container"})),null)},I=({isolationProvider:e,hostProps:t,errorUI:i,appHostSdk:n})=>{const o=r.useRef(null);return r.useEffect((()=>()=>{n.unloadApp(t.appDefinition,"component_unmount")}),[n,t.appDefinition,t.contentUrl]),r.createElement("div",{id:"isolation-provider-container",ref:o,style:{flex:1,display:"flex",flexDirection:"column"}},i(),e.renderHost(t))};var y=i(65964),E=i(17282),b=i(51144);const R={dependentHubServiceSelector:e=>e.appEntityService,messageHandlerFactory:(e,t,i)=>new T(e,i,t)};class T extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.appEntityService=i}initHandlers(){this.registerHandler(y.tz.appEntity.selectAppEntity,((e,t,i,r)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.appEntityService.selectAppEntity(t,i,r);return(0,s.PR)([null,e])}))),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.appEntity.selectAppEntity,e,t),isRestrictedToFullTrustApps:!0})}}var w=i(66310);const D={dependentHubServiceSelector:e=>e.appInstallDialogService,messageHandlerFactory:(e,t,i)=>new k(e,i,t)};class k extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.appInstallDialogService=i}initHandlers(){this.registerHandler(y.tz.appInstallDialog.openAppInstallDialog,((e,t)=>(0,s.QY)(this.appInstallDialogService.openAppInstallDialog,t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.appInstallDialog.openAppInstallDialog,e,t)})}}class x{constructor(e){this.appInstallDialogService=e}tryGetDataFromLink(e){if(!this.appInstallDialogService)return null;if(e.origin!=w.sB)return null;const t=e.pathname.match(x.APP_INSTALL_DIALOG_URL_REGEX);return t?{appId:t[1]}:null}executeData(e){return this.appInstallDialogService.openAppInstallDialog(e)}}x.APP_INSTALL_DIALOG_URL_REGEX=/^\/l\/app\/([^\/]+)\/?$/;var O=i(87353),F=i(78072),H=i(45701),P=i(28833),_=i(26121);const z={dependentHubServiceSelector:e=>e.authenticationService,messageHandlerFactory:(e,t,i)=>new L(e,t,i)};class L extends _.B{constructor(e,t,i,n){super(e,i,t),this.appSdkHost=e,this.authenticationService=t,this.telemetryService=i,this.TAG="AuthenticationMessageHandler",this.hostedWebContentAuthSdkServiceFactory=null!=n?n:(e,t,i,n,r,o,a,s)=>new H.I(e,t,i,n,r,o,a,s)}initHandlers(){super.initHandlers(),this.registerHandler(y.tz.authentication.authenticate,this.handleAuthenticate,{callbackFixedArgsLength:5,errorCallback:this.onAuthenticateError}),this.authenticationService.addEventListener("onExternalAuthDeeplink",(e=>F.nc.completeAuth(e.data.authId,e.data.result)))}handleAuthenticate(e,t,i,r,o,l){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(null==l||l.addOrUpdateActivityDataField(y._P.isExternal,o&&o?"true":"false"),this.appDefinition){const d=(0,A.Yj)(e.data),c=(0,s.sC)(d),p={getUser:()=>this.authenticationService.getUser(),acquireToken:(e,t,i,n)=>this.authenticationService.acquireToken(e,t,i,n),notifySuccess:e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){null==l||l.stop(),this.appSdkHost.postResponseToApp(d,[!0,e]),this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`notifySuccess func: ${c}`)})),notifyFailure:e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){null==l||l.fail(e),this.appSdkHost.postResponseToApp(d,[!1,e]),this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`notifyFailure func: ${c}`)})),externalAuthRedirectUrl:this.authenticationService.externalAuthRedirectUrl,addEventListener:()=>{},clearListeners:()=>{},externalAuthService:this.authenticationService.externalAuthService},u=Object.assign(Object.assign({},this.appSdkHost.getContext()),{app:Object.assign(Object.assign({},this.appSdkHost.getContext().app),{sessionId:(0,O.A)(),userClickTime:Date.now(),userClickTimeV2:(0,P.So)()}),page:Object.assign(Object.assign({},this.appSdkHost.getContext().page),{frameContext:A.E2.authentication})});this.hostedWebContentAuthSdkServiceFactory(this.appSdkHost.getHostWindow(),{url:t,width:i,height:r},this.appDefinition,p,u,this.appSdkHost.getLogger(),void 0,o)}return s.f1}))}onAuthenticateError(e,t){return null==t||t.fail(`Authenticate failed ${(0,s.oE)(e)}`),(0,s.PR)([!1,e])}}var M=i(59983);const U={dependentHubServiceSelector:e=>e.barCodeService&&e.devicePermissionService?{barCodeService:e.barCodeService,permissionsService:e.devicePermissionService}:void 0,messageHandlerFactory:(e,t,i)=>new N(e,i,t.permissionsService,t.barCodeService)};class N extends b.R{constructor(e,t,i,n){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.permissionsService=i,this.barCodeService=n}initHandlers(){this.registerHandler(y.tz.barCode.scanBarCode,((e,t)=>this.checkPermissionsAndCallScanBarCode(t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.barCode.scanBarCode,e,t)})}checkPermissionsAndCallScanBarCode(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield(0,s.og)(this.permissionsService,M.m.Media),(0,s.N8)(e,this.barCodeService.scanBarCode)}))}}var W=i(3650);const B={dependentHubServiceSelector:e=>e.calendarService,messageHandlerFactory:(e,t,i)=>new V(e,i,t)};class V extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.calendarService=i}initHandlers(){this.registerHandler(y.tz.calendar.openCalendarItem,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.calendarService.openCalendarItem(t),(0,s.PR)([!0])}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.calendar.openCalendarItem,e,t)}),this.registerHandler(y.tz.calendar.composeMeeting,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.calendarService.composeMeeting(t),(0,s.PR)([!0])}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.calendar.composeMeeting,e,t)})}validateDependencies(){if(!this.calendarService)throw"No calendarService provided"}}class q{constructor(e){this.calendarService=e}tryGetDataFromLink(e){var t;return this.calendarService?e.origin!=w.sB||"/l/meeting/new"!=e.pathname?null:{attendees:null===(t=e.searchParams.get("attendees"))||void 0===t?void 0:t.split(","),startTime:e.searchParams.get("startTime")||void 0,endTime:e.searchParams.get("endTime")||void 0,subject:e.searchParams.get("subject")||void 0,content:e.searchParams.get("content")||void 0}:null}executeData(e){return this.calendarService.composeMeeting(e)}}var j;!function(e){e.Unknown="unknown",e.Audio="audio",e.Video="video",e.VideoBasedScreenSharing="videoBasedScreenSharing",e.Data="data"}(j||(j={}));const $={dependentHubServiceSelector:e=>e.callService,messageHandlerFactory:(e,t,i)=>new G(e,i,t)};class G extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.callService=i}initHandlers(){this.registerHandler(y.tz.call.startCall,((e,t)=>(0,s.JA)(this.callService.startCall,t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.call.startCall,e,t)})}}class Z{constructor(e){this.callService=e}tryGetDataFromLink(e){var t;if(!this.callService)return null;if(e.origin!=w.sB||"/l/call/0/0"!=e.pathname)return null;const i=null===(t=e.searchParams.get("users"))||void 0===t?void 0:t.split(","),n="true"==e.searchParams.get("withVideo"),r=e.searchParams.get("source")||void 0;return i?{targets:i,requestedModalities:n?[j.Audio,j.Video]:[j.Audio],source:r}:null}executeData(e){return this.callService.startCall(e).then((()=>{}))}}const J={dependentHubServiceSelector:e=>e.chatService,messageHandlerFactory:(e,t,i)=>new X(e,i,t)};class X extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.chatService=i}initHandlers(){this.registerHandler(y.tz.chat.openChat,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.chatService.openChat(t),(0,s.PR)(!0)}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.chat.openChat,e,t)})}}class K{constructor(e){this.chatService=e}tryGetDataFromLink(e){var t;if(!this.chatService)return null;if(e.origin!=w.sB||"/l/chat/0/0"!=e.pathname)return null;const i=null===(t=e.searchParams.get("users"))||void 0===t?void 0:t.split(",");return i?{members:i,topic:e.searchParams.get("topicName")||void 0,message:e.searchParams.get("message")||void 0}:null}executeData(e){return this.chatService.openChat(e)}}var Y=i(81429);const Q={messageHandlerFactory:(e,t)=>new ee(e,t)};class ee extends b.R{constructor(e,t){super(e,t),this.appSdkHost=e,this.telemetryService=t}initHandlers(){this.registerHandler(y.tz.clipboard.writeToClipboard,this.writeDataToClipboard,{errorCallback:(e,t)=>(0,s.eZ)(y.tz.clipboard.writeToClipboard,e,t)}),this.registerHandler(y.tz.clipboard.readFromClipboard,this.readDataFromClipboard,{errorCallback:(e,t)=>(0,s.eZ)(y.tz.clipboard.readFromClipboard,e,t)})}validateDependencies(){if(!navigator||!navigator.clipboard)throw"Current browser does not support clipboard API."}acquireTemporaryFocus(){this.initiallyFocusedElement=document.activeElement,this.tempTextArea=document.createElement("textarea"),this.tempTextArea.readOnly=!0,this.tempTextArea.tabIndex=-1,this.tempTextArea.style.opacity="0",this.tempTextArea.style.position="fixed",this.tempTextArea.style.right="-9999px",this.tempTextArea.style.bottom="-9999px",document.body.appendChild(this.tempTextArea),this.tempTextArea.focus()}releaseTemporaryFocus(){this.initiallyFocusedElement&&this.initiallyFocusedElement.focus&&this.initiallyFocusedElement.focus(),this.tempTextArea&&document.body.removeChild(this.tempTextArea)}writeDataToClipboard(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!t.content||!t.mimeType)throw(0,s.jC)(f.O4.INVALID_ARGUMENTS,"Clipboard content or mime type cannot be empty.");if(!Object.values(A.j5).includes(t.mimeType))throw(0,s.jC)(f.O4.INVALID_ARGUMENTS,`Mime type ${t.mimeType} is not supported. Supported mime types are ${Object.values(A.j5)}`);try{let e=yield this.base64ToBlob(t.mimeType,t.content);this.acquireTemporaryFocus(),t.mimeType.startsWith("image/")&&(e=yield this.convertImageBlobToPngBlob(e)),yield navigator.clipboard.write([new ClipboardItem({[e.type]:e})])}catch(e){throw(0,s.jC)(f.O4.INTERNAL_ERROR,`Failed to copy to clipboard. ${e}`)}finally{this.releaseTemporaryFocus()}return(0,s.PR)([null])}))}readDataFromClipboard(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{let e;if(this.acquireTemporaryFocus(),"denied"===(yield navigator.permissions.query({name:"clipboard-read"})).state)throw(0,s.jC)(f.O4.PERMISSION_DENIED,"Not allowed to read clipboard.");const t=yield navigator.clipboard.read();if(e=yield t[0].getType(t[0].types[0]),(yield this.appSdkHost.getAppContext()).app.host.clientType===A.WK.desktop){const t={content:yield this.getBase64StringFromBlob(e),mimeType:e.type};return(0,s.PR)([null,JSON.stringify(t)])}return(0,s.PR)([null,e])}catch(e){throw(0,s.hl)(e)?e:(0,s.jC)(f.O4.INTERNAL_ERROR,e)}finally{this.releaseTemporaryFocus()}}))}getBase64StringFromBlob(e){return new Promise(((t,i)=>{0===e.size&&i(new Error("Blob cannot be empty."));const n=new FileReader;n.onloadend=()=>{n.result?t(n.result.toString().split(",")[1]):i(new Error("Failed to read the blob"))},n.onerror=()=>{i(n.error)},n.readAsDataURL(e)}))}createImageElement(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{const n=document.createElement("img");n.crossOrigin="anonymous",n.src=e,n.onload=e=>{const i=e.target;i.focus(),t(i)},n.onabort=i,n.onerror=i}))}))}getBlobFromImageElement(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{const n=document.createElement("canvas"),r=n.getContext("2d");if(r){const{width:o,height:a}=e;n.width=o,n.height=a,r.drawImage(e,0,0,o,a),n.toBlob((e=>{e?t(e):i("Cannot get blob from image element")}),"image/png",1)}}))}))}convertImageBlobToPngBlob(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const t=URL.createObjectURL(e),i=yield this.createImageElement(t);return yield this.getBlobFromImageElement(i)}))}base64ToBlob(e,t){return new Promise(((i,n)=>{if(e||n("MimeType cannot be null or empty."),t||n("Base64 string cannot be null or empty."),e.startsWith("image/")){const n=atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);i(new Blob([r],{type:e}))}else{const n=Y.hp.from(t,"base64").toString();i(new Blob([n],{type:e}))}}))}}const te={dependentHubServiceSelector:e=>e.conversationsService,messageHandlerFactory:(e,t,i)=>new ie(e,i,t)};class ie extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.conversationsService=i}initHandlers(){this.registerHandler(y.tz.conversations.openConversation,((e,t)=>(this.conversationsService.clearListeners(),this.conversationsService.addEventListener("startConversation",(e=>this.appSdkHost.sendRequestMessage("startConversation",e.data?[e.data.subEntityId,e.data.conversationId,e.data.channelId,e.data.entityId]:[]))),this.conversationsService.addEventListener("closeConversation",(e=>this.appSdkHost.sendRequestMessage("closeConversation",e.data?[e.data.subEntityId,e.data.conversationId,e.data.channelId,e.data.entityId]:[]))),(0,s.JA)(this.conversationsService.openConversation,t))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.links.openLink,e,t)}),this.registerHandler(y.tz.conversations.closeConversation,(e=>(this.conversationsService.clearListeners(),(0,s.QY)(this.conversationsService.closeConversation))),{}),this.registerHandler(y.tz.conversations.getChatMembers,(e=>(0,s.JA)(this.conversationsService.getChatMembers)),{isRestrictedToFullTrustApps:!0})}}class ne extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.copilotEligibilityService=i,this.getEligibility=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.copilotEligibilityService.getEligibilityInformation();return(0,s.PR)(e)}))}initHandlers(){this.registerHandler(y.tz.copilot.eligibility.getEligibilityInfo,this.getEligibility,{errorCallback:(e,t)=>(0,s.eZ)(y.tz.copilot.eligibility.getEligibilityInfo,e,t)})}canHandleMessage(e){return super.canHandleMessage(e)&&(0,c.wr)(this.appDefinition)}validateDependencies(e){if(!this.copilotEligibilityService)throw new Error("No copilotEligibilityService provided")}}var re=i(23145);class oe extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.copilotCustomTelemetryService=i}initHandlers(){this.registerHandler(y.tz.copilot.customTelemetry.sendCustomTelemetryData,this.sendCustomTelemetryData,{errorCallback:(e,t)=>(0,s.eZ)(y.tz.copilot.customTelemetry.sendCustomTelemetryData,e,t)})}canHandleMessage(e){return super.canHandleMessage(e)&&(0,c.wr)(this.appDefinition)}validateDependencies(e){if(!this.copilotCustomTelemetryService)throw new Error("No copilotCustomTelemetryService provided")}sendCustomTelemetryData(e,t,i){var r;return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!t||!1===(0,re.A)(t))throw(0,s.jC)(f.O4.INVALID_ARGUMENTS,"UUID is not valid.");const e=new d.k(t);return yield null===(r=this.copilotCustomTelemetryService)||void 0===r?void 0:r.recordAppLoadingTelemetry(e,i),(0,s.PR)()}))}}var ae=i(12720);const se="User cancelled/closed the task module.";class le extends b.R{constructor(e,t,i,n){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.dialogService=i,this.hostVersionsInfo=n}initHandlers(){if(this.appSdkHost.getFrameContext()===A.E2.task&&!this.dialogService)throw new Error("DialogService needs to be provided for FrameContexts.task");this.registerHandler(y.tz.dialogs.submit,((e,t,i)=>(0,s.QY)(this.dialogService.urlService.submit,t,i))),this.appSdkHost.getFrameContext()===A.E2.task&&this.dialogService.urlService.parentCommunicationService.addEventListener("onMessageForChild",(e=>{var t;const i=null===(t=this.telemetryService)||void 0===t?void 0:t.createScenario("eventDispatch.onMessageForChild",void 0,void 0,"unknown");null==i||i.stop(),Array.isArray(e.data)||(e.data=[e.data]),this.appSdkHost.sendRequestMessage("messageForChild",e.data?e.data:[])})),this.registerHandler(y.tz.dialogs.open,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){if(t.card&&t.url)return(0,s.PR)(["Values for both card and url were specified. One or the other, but not both, are allowed."]);let e;if(t.card)return e=Object.assign(Object.assign({},t),{card:t.card,type:ae.g.Card}),"completionBotId"in e?this.callDialogWithBotAndAdaptiveCard(e):this.callDialogWithCardService(e);if(t.url){const i=yield this.appSdkHost.getAppContext(),n=this.appSdkHost.getLogger();try{if(!(0,c.dA)(t.url,n,i,this.appDefinition))throw y.sh}catch(e){return n.log(a.$.Error,"DialogsMessageHandler",y.sh,null),(0,s.PR)([y.sh])}return e=Object.assign(Object.assign({},t),{url:t.url,type:ae.g.Url}),"completionBotId"in e?this.callDialogWithUrlAndBotService(e):this.callDialogWithJustUrlService(e)}return(0,s.PR)(["You must specify a value for either card or url."])})))),this.registerHandler("messageForParent",((e,t)=>(0,s.QY)(this.dialogService.urlService.parentCommunicationService.messageForParent,t))),this.registerHandler("messageForChild",((e,t)=>(0,s.QY)(this.dialogService.urlService.parentCommunicationService.messageForChild,t)))}validateDependencies(){if(!this.dialogService)throw"No dialogService provided";if(this.dialogService.cardService&&(!this.hostVersionsInfo||!this.hostVersionsInfo.adaptiveCardSchemaVersion||(0,w.Hk)(this.hostVersionsInfo.adaptiveCardSchemaVersion)))throw`dialogService.cardService requires that the host specifies an adaptive card version of at least ${(0,w.Zn)()}`}callDialogWithBotAndAdaptiveCard(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{if(this.dialogService.cardService.cardBotService){const t=yield this.dialogService.cardService.cardBotService.open(e);return(0,s.PR)([null,t])}return(0,s.PR)(["Bot Adaptive Card based Dialogs are not supported"])}catch(e){return(0,s.PR)([se])}}))}callDialogWithCardService(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{if(this.dialogService.cardService){const t=yield this.dialogService.cardService.open(e);return(0,s.PR)([null,t])}return(0,s.PR)(["Adaptive Card based Dialogs are not supported"])}catch(e){return(0,s.PR)([se])}}))}callDialogWithUrlAndBotService(e){return this.dialogService.urlService.urlBotService?this.addRemoveEventListenerAndCreateSDKResponse(this.dialogService.urlService.urlBotService.open,e):(0,s.PR)(["Dialogs with completionBotId are not supported"])}callDialogWithJustUrlService(e){return this.addRemoveEventListenerAndCreateSDKResponse(this.dialogService.urlService.open,e)}addRemoveEventListenerAndCreateSDKResponse(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{this.dialogService.urlService.parentCommunicationService.clearListeners(),this.dialogService.urlService.parentCommunicationService.addEventListener("onMessageForParent",(e=>{var t;const i=null===(t=this.telemetryService)||void 0===t?void 0:t.createScenario("eventDispatch.onMessageForParent",void 0,void 0,"unknown");null==i||i.stop(),Array.isArray(e.data)||(e.data=[e.data]),this.appSdkHost.sendRequestMessage("messageForParent",e.data?e.data:[])}));var i=yield e(t);return(0,s.PR)([null,i])}catch(e){return(0,s.PR)([se])}finally{this.dialogService.urlService.parentCommunicationService.clearListeners()}}))}}class de extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.dialogUpdateService=i}initHandlers(){this.registerHandler(y.tz.dialogs.update.resize,((e,t)=>(0,s.QY)(this.dialogUpdateService.resize,t)))}validateDependencies(){if(!this.dialogUpdateService)throw"No dialogUpdateService provided"}}var ce=i(55977),pe=i(99594);function ue(e,t=0){return!(t>1e3)&&(void 0===e||"boolean"==typeof e||"number"==typeof e||"bigint"==typeof e||"string"==typeof e||null===e||(Array.isArray(e)?e.every((e=>ue(e,t+1))):!("object"!=typeof e||"[object Object]"!==Object.prototype.toString.call(e)||Object.getPrototypeOf(e)!==Object.prototype&&null!==Object.getPrototypeOf(e))&&Object.keys(e).every((i=>ue(e[i],t+1)))))}var he=i(75973),ge=i(89847);class ve{constructor(e,t){this.telemetryService=e,this.logger=t}createTelemetryScenario(e){return this.telemetryService.createScenario(e)}executeCapabilityFunction(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=this.createTelemetryScenario(he.Fb[e.sdkMessageName]);try{const n=yield e.execute(t,i);return i.stop(),n}catch(t){this.logger.log(a.$.Error,`Error executing ${e.sdkMessageName}`,t),e.errorHandler&&(t=yield e.errorHandler(t,i));const n=function(e){return!!(function(e){return(null==e?void 0:e.errorCode)in f.he}(e)||function(e){return(null==e?void 0:e.errorCode)in ge.nq}(e)||function(e){return(null==e?void 0:e.errorCode)in f.O4}(e)||function(e){return(null==e?void 0:e.errorCode)in ce.m_}(e))}(t)?(0,s.oE)(t):s.UR.message;return i.fail(`${e.sdkMessageName} Api failed ${n}`),Promise.reject(t)}}))}}class me extends ve{constructor(e,t,i,r,o,l,d){super(o,l),this.appSdkHost=e,this.authenticationService=t,this.externalAppInfoService=i,this.externalAppChannelService=r,this.telemetryService=o,this.logger=l,this.TAG="ExternalAppAuthenticationBaseExecutor",this.externalAppAuthenticationOAuthExecutorHelper=(e,t,i,r)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=i.appId.toString();this.updateTelemetryScenario(r,i,n),this.validateAuthHandlerInput(n,"conversationId"in i?i.conversationId:void 0,"originalRequestInfo"in i?i.originalRequestInfo:void 0);const o=yield this.fetchAndValidateAppDefinition(e,n),a=yield this.createAppSdkContext();return this.executeOAuthFlow(t,i,r,o,a)})),this.externalAppAuthenticationSSOExecutorHelper=(e,t,i,r)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=t.appId.toString();r.addOrUpdateActivityDataField(y._P.requestedForAppID,n),this.validateAuthHandlerInput(n,"conversationId"in t?t.conversationId:void 0,"originalRequestInfo"in t?t.originalRequestInfo:void 0);const o=yield this.getSSOToken(e,n,i,origin,t.claims,t.silent);return r.markPhase("InvokeToExternalAppAuthTokenAcquired"),{type:ce.cG.SSOToken,token:o}})),this.getSSOToken=(e,t,i,r,o,l)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield this.getAppDefinition(t);this.validateAppDefinition(n,e,i);const d=yield this.appSdkHost.getContext(),p=yield(0,c.u6)(r,void 0,this.appSdkHost.getHubInfo(),n,d,!0,i);if(!p||0===p.length)throw(0,s.f3)("Validated resources must contain at least one item.");const u=yield this.authenticationService.acquireToken(p[0],o,l);return this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`AcquireToken returned successfully, authToken is ${null!==u?"not ":""} null`),u})),this.getAppDefinition=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var t,i;if(!(yield null===(t=this.externalAppInfoService)||void 0===t?void 0:t.isAppAllowed(e)))throw(0,s.f3)(`App with ID: ${e} has been blocked`);const n=yield null===(i=this.externalAppInfoService)||void 0===i?void 0:i.getAppDefinition(e);if(!n)throw(0,s.f3)(`Unable to retrieve AppDefinition for ${e}`);return n})),this.validateAppDefinition=(e,t,i)=>{"ME"===t?this.validateAppDefinitionForME(e,i):"CEA"===t&&this.validateAppDefinitionForCEA(e)},this.validateAppDefinitionForCEA=e=>{if(!(0,c.cZ)(e))throw(0,s.f3)("customEngineAgents field is not defined in external AppDefinition");try{(0,c.g)(e)}catch(e){throw(0,s.f3)(e)}},this.validateAppDefinitionForME=(e,t)=>{if(!(0,c.ZJ)(e))throw(0,s.f3)("composeExtension field is not defined in external AppDefinition");if(t){if(!(0,c.tZ)(e))throw(0,s.f3)("AppDefinition composeExtension.type field must be bot-based");try{(0,c.Po)(e)}catch(e){throw(0,s.f3)(e)}}},this.validateAuthHandlerInput=(e,t,i)=>{(0,pe.z)(e,(0,s.f3)("App ID is not valid.")),t&&(0,pe.z)(t,(0,s.f3)("Conversation ID is not valid.")),(null==i?void 0:i.requestType)===ce.FH.QueryMessageExtensionRequest?this.validateQueryMessageExtensionRequest(i):(null==i?void 0:i.requestType)===ce.FH.ActionExecuteInvokeRequest&&this.validateActionExecuteInvokeRequest(i)},this.validateInvokeResponse=e=>{e.responseType===ce.ci.QueryMessageExtensionResponse&&(this.validateSuggestedActionsForResultOrMessage(e),this.validateQueryMessageExtensionCard(e),this.validateSuggestedActionsForConfigOrAuth(e),this.validateTextForMessageType(e)),e.responseType===ce.ci.ActionExecuteInvokeResponse&&this.validateValue(e)},this.validateValue=e=>{if(!ue(e.value))throw(0,s.f3)("ActionExecuteInvokeResponse.value should be a primitive or plain object")},this.validateQueryMessageExtensionCard=e=>{const{composeExtension:t}=e,i=null==t?void 0:t.attachments;i&&i.forEach((e=>{var t;if(!ue(e.content))throw(0,s.f3)("QueryMessageExtensionCard.content should be a primitive or plain object");if(!ue(null===(t=e.preview)||void 0===t?void 0:t.content))throw(0,s.f3)("QueryMessageExtensionCard.preview.content should be a primitive or plain object")}))},this.validateSuggestedActionsForResultOrMessage=e=>{const{composeExtension:t}=e;if(("result"===(null==t?void 0:t.type)||"message"===(null==t?void 0:t.type))&&(null==t?void 0:t.suggestedActions))throw(0,s.f3)("ComposeExtensionResponse.SuggestedActions should be undefined when the composeExtension.type is 'result' or 'message'")},this.validateSuggestedActionsForConfigOrAuth=e=>{const{composeExtension:t}=e;if(("config"===(null==t?void 0:t.type)||"auth"===(null==t?void 0:t.type))&&!(null==t?void 0:t.suggestedActions))throw(0,s.f3)("ComposeExtensionResponse.SuggestedActions should be defined when the composeExtension.type is 'config' or 'auth'")},this.validateTextForMessageType=e=>{const{composeExtension:t}=e;if("message"===(null==t?void 0:t.type)&&!(null==t?void 0:t.text))throw(0,s.f3)("ComposeExtensionResponse.text should be defined when the composeExtension.type is 'message'")},this.hostedWebContentAuthSdkServiceFactory=null!=d?d:(e,t,i,n,r,o,a,s)=>new H.I(e,t,i,n,r,o,a,s)}updateTelemetryScenario(e,t,i){e.addOrUpdateActivityDataField(y._P.isExternal,t.isExternal?"true":"false"),e.addOrUpdateActivityDataField(y._P.requestedForAppID,i)}fetchAndValidateAppDefinition(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.getAppDefinition(t);return this.validateAppDefinition(i,e,!0),i}))}createAppSdkContext(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.appSdkHost.getContext();return{app:{locale:e.app.locale,theme:e.app.theme,launchId:(0,O.A)(),sessionId:(0,O.A)(),host:e.app.host,userClickTime:Date.now(),userClickTimeV2:(0,P.So)()},page:{id:(0,O.A)(),frameContext:A.E2.authentication},user:{dataResidency:e.user.dataResidency}}}))}executeOAuthFlow(e,t,i,n,r){return new Promise(((o,a)=>{const s=this.createWindowAuthenticationService(t,i,e,{onSuccess:e=>o(e),onFailure:e=>a(e)});this.startOAuthHostedService(t,n,s,r)}))}createWindowAuthenticationService(e,t,i,r){return{getUser:()=>this.authenticationService.getUser(),acquireToken:(e,t,i)=>this.authenticationService.acquireToken(e,t,i),notifySuccess:o=>(0,n.__awaiter)(this,void 0,void 0,(function*(){yield i(o,e.appId,t,r,"originalRequestInfo"in e?e.originalRequestInfo:void 0,"conversationId"in e?e.conversationId:void 0)})),notifyFailure:e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){r.onFailure(e)})),externalAuthRedirectUrl:this.authenticationService.externalAuthRedirectUrl,externalAuthService:this.authenticationService.externalAuthService,addEventListener:()=>{},clearListeners:()=>{}}}startOAuthHostedService(e,t,i,n){const r="string"==typeof e.url?e.url:e.url.href;this.hostedWebContentAuthSdkServiceFactory(this.appSdkHost.getHostWindow(),{url:r,width:e.width,height:e.height},t,i,n,this.appSdkHost.getLogger(),void 0,e.isExternal)}validateQueryMessageExtensionRequest(e){this.validateQueryMECommandId(e),this.validateQueryMEParametersSize(e),this.validateQueryMEParametersContent(e)}validateQueryMECommandId(e){if(e.commandId.length>64)throw(0,s.f3)("originalRequestInfo.commandId has exceeded the character limit of 64")}validateQueryMEParametersSize(e){if(e.parameters.length>5)throw(0,s.f3)("originalRequestInfo.parameters have exceeded the size limit of 5")}validateQueryMEParametersContent(e){for(const t of e.parameters)this.validateParameterName(t.name),this.validateParameterValue(t.value)}validateParameterName(e){if(e.length>64)throw(0,s.f3)("originalRequestInfo.parameters.Name exceeds the maximum size of 64 characters")}validateParameterValue(e){if(e.length>512)throw(0,s.f3)("originalRequestInfo.parameters.Value exceeds the maximum size of 512 characters")}validateActionExecuteInvokeRequest(e){if(e.type!==ce.Xg)throw(0,s.f3)(`originalRequestInfo.type can only be ${ce.Xg}`)}}const Se=y.kv.CEA;class fe extends me{constructor(e,t,i,r,o,s,l){super(e,t,i,r,o,s,l),this.appSdkHost=e,this.authenticationService=t,this.externalAppInfoService=i,this.IExternalAppChannelForCEAService=r,this.telemetryService=o,this.logger=s,this.TAG="ExternalAppAuthenticationForCEAExecutor",this.notifySuccessHelper=(e,t,i,r,o,s)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const n={type:ce.cG.OAuthCode,secret_code:e};this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"notifySuccess func"),i.markPhase("InvokeToExternalAppAuthTokenAcquired");try{if(o){const e=yield this.IExternalAppChannelForCEAService.sendAuthResultWithOriginalRequestToBot(t,s,o,n);this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"IExternalAppChannelForCEAService.sendAuthResultWithOriginalRequestToBot: sent authResult to bot"),this.validateInvokeResponse(e),r.onSuccess(e)}else yield this.IExternalAppChannelForCEAService.sendAuthResultToBot(t,s,n),this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"IExternalAppChannelForCEAService.sendAuthResultToBot: sent authResult to bot"),r.onSuccess()}catch(e){r.onFailure(e)}})),this.authenticateAndResendRequestExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.externalAppAuthenticationOAuthExecutorHelper(Se,this.notifySuccessHelper,e,t)})),sdkMessageName:y.tz.externalAppAuthenticationForCEA.authenticateAndResendRequest},this.authenticateWithOauthExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.externalAppAuthenticationOAuthExecutorHelper(Se,this.notifySuccessHelper,e,t)})),sdkMessageName:y.tz.externalAppAuthenticationForCEA.authenticateWithOauth},this.authenticateWithSSOExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.externalAppAuthenticationSSOExecutorHelper(Se,e,!0,t);yield this.IExternalAppChannelForCEAService.sendAuthResultToBot(e.appId,e.conversationId,i),this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"IExternalAppChannelForCEAService.sendAuthResultToBot: sent authResult to bot")})),sdkMessageName:y.tz.externalAppAuthenticationForCEA.authenticateWithSSO},this.authenticateWithSSOAndResendRequestExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.externalAppAuthenticationSSOExecutorHelper(Se,e,!0,t),n=yield this.IExternalAppChannelForCEAService.sendAuthResultWithOriginalRequestToBot(e.appId,e.conversationId,e.originalRequestInfo,i);return this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"IExternalAppChannelForCEAService.sendAuthResultWithOriginalRequestToBot: sent authResult to bot"),this.validateInvokeResponse(n),n})),sdkMessageName:y.tz.externalAppAuthenticationForCEA.authenticateWithSSOAndResendRequest}}authenticateAndResendRequest(e,t,i,n,r,o,a){return this.executeCapabilityFunction(this.authenticateAndResendRequestExecutor,{appId:e,conversationId:t,originalRequestInfo:i,url:n,width:o,height:a,isExternal:r})}authenticateWithSSOInternal(e,t,i,n,r){return this.executeCapabilityFunction(this.authenticateWithSSOExecutor,{appId:e,conversationId:t,origin:i,claims:n,silent:r})}authenticateWithSSO(e,t,i,n){var r;return this.authenticateWithSSOInternal(e,t,(null===(r=this.appSdkHost.getHostWindow())||void 0===r?void 0:r.location.href)||"",i,n)}authenticateWithOauth(e,t,i,n,r,o){return this.executeCapabilityFunction(this.authenticateWithOauthExecutor,{appId:e,conversationId:t,url:i,width:r,height:o,isExternal:n})}authenticateWithSSOAndResendRequestInternal(e,t,i,n,r,o){return this.executeCapabilityFunction(this.authenticateWithSSOAndResendRequestExecutor,{appId:e,conversationId:t,originalRequestInfo:i,origin:n,claims:r,silent:o})}authenticateWithSSOAndResendRequest(e,t,i,n,r){var o;return this.authenticateWithSSOAndResendRequestInternal(e,t,i,(null===(o=this.appSdkHost.getHostWindow())||void 0===o?void 0:o.location.href)||"",n,r)}}var Ae=i(18549);const Ce={dependentHubServiceSelector:e=>e.authenticationService&&e.externalAppInfoService&&e.externalAppChannelForCEAService?{authenticationService:e.authenticationService,externalAppInfoService:e.externalAppInfoService,externalAppChannelForCEAService:e.externalAppChannelForCEAService}:void 0,messageHandlerFactory:(e,t,i)=>new Ie(e,new fe(e,t.authenticationService,t.externalAppInfoService,t.externalAppChannelForCEAService,i,e.getLogger()),i)};class Ie extends b.R{constructor(e,t,i){super(e,i),this.appSdkHost=e,this.externalAppAuthenticationForCEAExecutor=t,this.TAG="ExternalAppAuthenticationForCEAMessageHandler",this.isTelemetryHandledByExecutor=!0}initHandlers(){this.registerHandler(y.tz.externalAppAuthenticationForCEA.authenticateAndResendRequest,this.handleAuthenticateAndResendRequest,{errorCallback:e=>this.onAuthenticateError(e)}),this.registerHandler(y.tz.externalAppAuthenticationForCEA.authenticateWithSSO,this.handleCEAAuthenticateWithSSO,{errorCallback:e=>this.onAuthenticateError(e)}),this.registerHandler(y.tz.externalAppAuthenticationForCEA.authenticateWithOauth,this.handleCEAAuthenticateWithOauth,{errorCallback:e=>this.onAuthenticateError(e)}),this.registerHandler(y.tz.externalAppAuthenticationForCEA.authenticateWithSSOAndResendRequest,this.handleAuthenticateWithSSOAndResendRequest,{errorCallback:e=>this.onAuthenticateError(e)})}canHandleMessage(e){return super.canHandleMessage(e)&&(0,c.wr)(this.appDefinition)}handleAuthenticateAndResendRequest(e,t,i,r,o,a,l,d){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=(0,A.Yj)(e.data);try{const e=yield this.externalAppAuthenticationForCEAExecutor.authenticateAndResendRequest(new Ae.l(t),i,r,new URL(o),null!=d&&d,a,l);this.postResponseToAppAndLog("notifySuccess func",n,[e])}catch(e){this.postResponseToAppAndLog("AuthenticateAndResendRequest",n,[(0,s.f3)(e)])}return s.f1}))}handleCEAAuthenticateWithSSO(e,t,i,r,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.externalAppAuthenticationForCEAExecutor.authenticateWithSSOInternal(new Ae.l(t),i,e.origin,r,o),(0,s.PR)()}))}handleCEAAuthenticateWithOauth(e,t,i,r,o,a,l){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.externalAppAuthenticationForCEAExecutor.authenticateWithOauth(new Ae.l(t),i,new URL(r),null!=l&&l,o,a),(0,s.PR)()}))}handleAuthenticateWithSSOAndResendRequest(e,t,i,r,o,a){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield this.externalAppAuthenticationForCEAExecutor.authenticateWithSSOAndResendRequestInternal(new Ae.l(t),i,r,e.origin,o,a);return(0,s.PR)([n])}))}postResponseToAppAndLog(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){this.appSdkHost.postResponseToApp(t,i);const n=(0,s.sC)(t);this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`${e}: ${n}`)}))}onAuthenticateError(e){const t=(0,s.f3)(e);return(0,s.PR)([t])}}var ye=i(46764);class Ee{constructor(e,t){this.origin=e;const i="https://";if((0,c.NJ)([this.origin.substring(8)]).length>0)throw new Error(`Please make sure the origin: ${this.origin} is valid. For example: "https://*.*.example.com" is valid, but 'https://foo.*.example.com' is not valid.`);const n=this.origin.startsWith(i)?this.origin.replaceAll("*","x"):i+this.origin.replaceAll("*","x");try{const e=new URL(n);this.origin.startsWith(i)||null==t||t.markWarnMessage(`WARN: Please make sure the origin: ${e.hostname} has a valid https protocol.`)}catch(e){throw new Error(`Please make sure the origin: ${this.origin} is a valid URL. Error: ${e}`)}}getOrigin(){return this.origin}}class be{constructor(e,t){this.blockedOrigins=[...e||[]],this.appInitScenario=t}isOriginBlockedImpl(e,t=[],i=!1){for(const n of t){try{new Ee(n,this.appInitScenario)}catch(e){return{isOriginValid:!1,message:e.message}}for(const t of this.blockedOrigins){if(!i&&e&&n===t[0].getOrigin()&&t[1]&&!Array.from(t[1]).find((t=>t.toString()===e.toString())))return{isOriginValid:!1,message:`Current app is not allowed to load the origin: ${n}.`};if(i&&n===t[0].getOrigin())return{isOriginValid:!1,message:`Current app is not allowed to load the origin: ${n}.`}}}return{isOriginValid:!0}}isOriginBlocked(e,t=[]){return this.isOriginBlockedImpl(e,t,!1)}isOriginBlockedExternal(e=[]){return this.isOriginBlockedImpl("",e,!0)}}function Re(e){return e.uuid?e:(0,A.Yj)(e)}class Te{constructor(e,t,i,n){this.hostWindow=e,this.openWindowInfo=t,this.notificationService=i,this.context=n}isWindowOpen(){return!!this.authWindow&&!this.authWindow.closed}closeWindow(){var e;null===(e=this.authWindow)||void 0===e||e.close()}sendRequestMessage(e,t){if(this.origin){const i={func:e,args:t,monotonicTimestamp:(0,P.So)()};this.postMessage(i)}}launchAuthWindow(){var e,t;try{if(void 0===this.onAuthMessageReceived)throw Error("onAuthMessageReceived is undefined");const e=(0,ye.v)(this.openWindowInfo);this.authWindow=this.context.app.host.clientType===A.WK.desktop&&this.notificationService.externalAuthService?this.notificationService.externalAuthService.openUrlInEmbeddedBrowser(new URL(this.openWindowInfo.url),e):this.hostWindow.open(this.openWindowInfo.url,"appAuthWindow",e),this.authWindow?this.setupExternalAuthWindow(this.openWindowInfo.url,this.hostWindow):this.notificationService.notifyFailure("Auth window reference undefined")}catch(i){if(null!==this.authWindow)null===(e=this.notificationService)||void 0===e||e.notifyFailure(`openUrlInEmbeddedBrowser threw an error but still returned a non-null window object? Forcing window object to null. Error = ${i}`),this.authWindow=null;else{let e=i instanceof Error?`${i.message}`:"Error launching AuthWindow";null===(t=this.notificationService)||void 0===t||t.notifyFailure(e)}}}postResponseToApp(e,t){this.sendResponseMessage(e,t)}stopAuthWindowMonitor(){this.authWindowMonitor&&(this.hostWindow.clearInterval(this.authWindowMonitor),this.authWindowMonitor=void 0)}setupExternalAuthWindow(e,t){this.origin=e,this.globalWindowEventListener=new o.J(t),this.globalWindowEventListener.addListener("message",this.onAuthMessageReceived),this.startAuthWindowMonitor()}sendResponseMessage(e,t){var i;if(this.origin){const n=Re(e),r={id:n.id,uuidAsString:null===(i=n.uuid)||void 0===i?void 0:i.toString(),args:t,origin:this.origin,monotonicTimestamp:(0,P.So)()};this.postMessage(r)}}startAuthWindowMonitor(){this.stopAuthWindowMonitor(),this.authWindowMonitor=this.hostWindow.setInterval((()=>{this.authWindowInterval()}),2e3)}authWindowInterval(){this.isWindowOpen()?this.sendRequestMessage("ping"):(this.notificationService.notifyFailure("CancelledByUser",H.Q.CancelledByUser),this.closeWindow(),this.stopAuthWindowMonitor())}postMessage(e){var t;this.origin&&(null===(t=this.authWindow)||void 0===t||t.postMessage(e,this.origin))}isValidOriginBlocked(e){return new be([]).isOriginBlockedExternal(e.args&&e.args.length>2&&null!=e.args[2]?[e.args[2]]:[])}}class we extends Te{constructor(e,t,i,r,o,s){super(e,t,i,r),this.hostWindow=e,this.openWindowInfo=t,this.notificationService=i,this.context=r,this.logger=o,this.redirectOrigin=s,this.onAuthMessageReceived=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var t,i;if(!this.authWindow||this.authWindow!==e.source)return void this.logger.log(a.$.Error,"HostedWebContentExternalOauthService","Auth window is not valid");const n=e.origin;n!==this.origin&&n.toLocaleLowerCase()===this.redirectOrigin.toLocaleLowerCase()&&(this.origin=e.origin);const r=(0,A.Yj)(e.data);if(this.origin===n&&this.notificationService)if(r.func===y.tz.initialize){const e=this.isValidOriginBlocked(r);if(e.isOriginValid)return this.postResponseToApp(r,[A.E2.authentication,A.WK]);this.notificationService.notifyFailure(e.message),this.stopAuthWindowMonitor(),this.closeWindow()}else if("authentication.authenticate.success"===r.func)this.notificationService.notifySuccess((null===(t=r.args)||void 0===t?void 0:t[0])?String(r.args[0]):""),this.stopAuthWindowMonitor(),this.closeWindow();else if("authentication.authenticate.failure"===r.func){const e=(null===(i=r.args)||void 0===i?void 0:i[0])?String(r.args[0]):"Token storage failed";this.notificationService.notifyFailure(e),this.stopAuthWindowMonitor(),this.closeWindow()}}))}}const De="HostedWebContentPPCAuthService";class ke extends Te{constructor(e,t,i,r,o,s){super(e,t,i,r),this.hostWindow=e,this.openWindowInfo=t,this.notificationService=i,this.context=r,this.logger=o,this.validDomains=s,this.onAuthMessageReceived=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var t;if(this.authWindow&&this.authWindow===e.source)try{const i=e.origin;i!==this.origin&&(0,c.F6)(new URL(i),this.validDomains,this.logger)&&(this.origin=e.origin);const n=e.data;if(this.origin===i&&this.notificationService)if(n.func===y.tz.initialize){const e=this.isValidOriginBlocked(n);if(e.isOriginValid)return this.postResponseToApp(n,[A.E2.authentication,A.WK]);this.notificationService.notifyFailure(e.message),this.stopAuthWindowMonitor(),this.closeWindow()}else if("authentication.authenticate.success"===n.func)this.notificationService.notifySuccess(""),this.stopAuthWindowMonitor(),this.closeWindow();else if("authentication.authenticate.failure"===n.func){const e=(null===(t=n.args)||void 0===t?void 0:t[0])?String(n.args[0]):"Token storage failed";this.notificationService.notifyFailure(e),this.stopAuthWindowMonitor(),this.closeWindow()}}catch(e){this.logger.log(a.$.Error,De,"Error in onAuthMessageReceived",e),this.notificationService.notifyFailure(e.message)}else this.logger.log(a.$.Error,De,"Auth window is not valid")}))}}class xe{constructor(e){this.endpointUrl=e}static build(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){xe.mos3TokenGenerationService=e;let i=yield xe.acquireToken(!0),n=yield xe.getEndpointUrl(i);return xe.jestDelay=t,new xe(n)}))}getSignInUrlInfo(e,t){var i;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield xe.acquireToken(!0);let r=null!==(i=this.endpointUrl)&&void 0!==i?i:xe.DEFAULT_ENDPOINT;r=`${r}/catalog/v1/users/titles/${e}/signInInfo`;const o=(0,w.Tq)(r,t);return yield this.getRequestWithRetry(n,o)}))}activateOauth2Token(e,t,i){var r;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield xe.acquireToken(!0);let o=null!==(r=this.endpointUrl)&&void 0!==r?r:xe.DEFAULT_ENDPOINT;o=`${o}/catalog/v1/users/titles/${e}/signInCode`;const a={authConfigId:t,authCode:i};yield this.postRequestWithRetry(n,o,a)}))}static requestMOS3ForEndpointURL(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=yield fetch(t,{headers:{Authorization:"Bearer "+e}});if(i.ok)return i.json();throw Error(`Request failed with status code: ${i.status}`)}))}getRequestWithRetry(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=yield fetch(t,{headers:{Authorization:"Bearer "+e}});if(i.ok)return i.json();if(401===i.status){const e=yield this.handle401Error(i);return this.getRequestWithRetry(e,t)}throw Error(`Request failed with status code: ${i.status}`)}))}postRequestWithRetry(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify(i)});if(n.ok)return n;if(401===n.status){const e=yield this.handle401Error(n);return this.postRequestWithRetry(e,t,i)}throw Error(`Request failed with status code: ${n.status}`)}))}handle401Error(e){var t,i;return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n,r=!0;const o=null!==(i=null===(t=e.headers)||void 0===t?void 0:t.get("www-authenticate"))&&void 0!==i?i:void 0;return o&&(n=(0,w.xy)(o),r=!1),yield xe.acquireToken(r,n?[n]:void 0,o)}))}}xe.DEFAULT_ENDPOINT="https://titles.prod.mos.microsoft.com",xe.getEndpointUrl=e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){let t=xe.DEFAULT_ENDPOINT+"/config/v1/environment";const i=yield xe.requestMOS3ForEndpointURL(e,t);if((0,c.fc)(i.titlesServiceUrl))return i.titlesServiceUrl;throw Error("Invalid endpoint URL")})),xe.acquireToken=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=yield xe.mos3TokenGenerationService.acquireToken(xe.DEFAULT_ENDPOINT,t,i,e);if(n&&n.token)return n.token;throw Error("Empty token response.")}));const Oe=y.kv.ME;class Fe extends me{constructor(e,t,i,r,o,l,d,c,p,u){super(e,t,i,r,l,d,c),this.appSdkHost=e,this.authenticationService=t,this.externalAppInfoService=i,this.externalAppChannelService=r,this.signInUrlInfoServiceProvider=o,this.telemetryService=l,this.logger=d,this.TAG="ExternalAppAuthenticationExecutor",this.notifySuccessHelper=(e,t,i,r,o)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const n={type:ce.cG.OAuthCode,secret_code:e};this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"notifySuccess func"),i.markPhase("InvokeToExternalAppAuthTokenAcquired");try{const e=yield this.externalAppChannelService.sendRequestWithAuth(t,o,n);this.validateInvokeResponse(e),r.onSuccess(e)}catch(e){r.onFailure(e)}})),this.authenticateAndResendRequestExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.externalAppAuthenticationOAuthExecutorHelper(Oe,this.notifySuccessHelper,e,t)})),sdkMessageName:y.tz.externalAppAuthentication.authenticateAndResendRequest},this.authenticateWithSSOExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){yield this.externalAppAuthenticationSSOExecutorHelper(Oe,e,!1,t)})),sdkMessageName:y.tz.externalAppAuthentication.authenticateWithSSO},this.authenticateWithSSOAndResendRequestExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.externalAppAuthenticationSSOExecutorHelper(Oe,e,!0,t),n=yield this.externalAppChannelService.sendRequestWithAuth(e.appId,e.originalRequestInfo,i);return this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"externalAppChannelService.sendRequestWithAuth: sent authResult to bot"),this.validateInvokeResponse(n),n})),sdkMessageName:y.tz.externalAppAuthentication.authenticateWithSSOAndResendRequest},this.authenticateWithOauth2Executor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var i,r;t.addOrUpdateActivityDataField(y._P.requestedForAppID,e.titleId),t.addOrUpdateActivityDataField(y._P.oauthConfigId,e.oauthConfigId),(0,pe.z)(e.titleId,(0,s.f3)("titleId is not valid."));const o=null===(i=e.oauthConfigId)||void 0===i?void 0:i.trim();if(!o)throw(0,s.f3)("No oAuthConfigId is provided. Request cannot be completed");const l=new Map;l.set("authConfigId",o);const d=yield this.getSignInUrlInfoResponse(e.titleId,l);if(!d)throw(0,s.f3)("No response is provided by the service. Request cannot be completed");const c=null!==(r=d.signInUrl)&&void 0!==r?r:"",p=decodeURIComponent(c);if(!this.isValidOauthUrl(p))throw(0,s.f3)("Invalid signIn URL. Request cannot be completed");const u=new URL(this.getUrlParameters(new URL(p),"redirect_uri")).origin;return new Promise(((i,r)=>{const s={onSuccess:()=>i(),onFailure:e=>r(e)},l={getUser:()=>Promise.reject(void 0),acquireToken:()=>Promise.reject(void 0),notifySuccess:i=>(0,n.__awaiter)(this,void 0,void 0,(function*(){yield this.activateOauth2TokenAfterSuccessIsReceived(e.titleId,o,i,t,s)})),notifyFailure:e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const t="Internal error occurred while acquiring or storing token";this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`Oauth notifyFailure func: ${null!=e?e:t}`),r(null!=e?e:t)})),externalAuthRedirectUrl:void 0,addEventListener:()=>{},clearListeners:()=>{},externalAuthService:this.authenticationService.externalAuthService},d={app:{locale:this.appSdkHost.getContext().app.locale,theme:this.appSdkHost.getContext().app.theme,launchId:(0,O.A)(),sessionId:(0,O.A)(),host:this.appSdkHost.getContext().app.host,userClickTime:Date.now(),userClickTimeV2:(0,P.So)()},page:{id:(0,O.A)(),frameContext:A.E2.authentication},user:{dataResidency:this.appSdkHost.getContext().user.dataResidency}};this.hostedWebContentExternalOauthServiceFactory(this.appSdkHost.getHostWindow(),{url:p,width:e.width,height:e.height},l,d,this.appSdkHost.getLogger(),u).launchAuthWindow()}))})),sdkMessageName:y.tz.externalAppAuthentication.authenticateWithOauth2},this.authenticateWithPPCExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var i,r;t.addOrUpdateActivityDataField(y._P.requestedForAppID,e.titleId),(0,pe.z)(e.titleId,(0,s.f3)("titleId is not valid."));const o=yield this.getSignInUrlInfoResponse(e.titleId);if(!o)throw(0,s.f3)("No response is provided by the service. Request cannot be completed");const l=null!==(r=null!==(i=e.signInUrl)&&void 0!==i?i:o.signInUrl)&&void 0!==r?r:"",d=null==o?void 0:o.validDomains;if(void 0===d||0===d.length)throw(0,s.f3)("No valid domains are provided by the service. Request cannot be completed");const c=d.map((e=>e.toLocaleLowerCase())),p=decodeURIComponent(l);if(!this.isValidPPCUrl(p,c))throw(0,s.f3)("Invalid authentication url. Request cannot be completed");return new Promise(((t,i)=>{const r={getUser:()=>Promise.reject(void 0),acquireToken:()=>Promise.reject(void 0),notifySuccess:()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"notifySuccess func"),t()})),notifyFailure:e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const t="Internal error occurred while acquiring or storing token";this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`Oauth notifyFailure func: ${null!=e?e:t}`),i(null!=e?e:t)})),externalAuthRedirectUrl:void 0,externalAuthService:this.authenticationService.externalAuthService,addEventListener:()=>{},clearListeners:()=>{}},o={app:{locale:this.appSdkHost.getContext().app.locale,theme:this.appSdkHost.getContext().app.theme,launchId:(0,O.A)(),sessionId:(0,O.A)(),host:this.appSdkHost.getContext().app.host,userClickTime:Date.now(),userClickTimeV2:(0,P.So)()},page:{id:(0,O.A)(),frameContext:A.E2.authentication},user:{dataResidency:this.appSdkHost.getContext().user.dataResidency}};this.hostedWebContentPPCAuthServiceFactory(this.appSdkHost.getHostWindow(),{url:p,width:e.width,height:e.height},r,o,this.appSdkHost.getLogger(),c).launchAuthWindow()}))})),sdkMessageName:y.tz.externalAppAuthentication.authenticateWithPowerPlatformConnectorPlugins},this.getSignInUrlInfoResponse=(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.oauth2Service||(yield this.constructOauth2Service()),this.oauth2Service?yield this.oauth2Service.getSignInUrlInfo(e,t):{}})),this.callActivateOauth2Token=(e,t,i)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){if(this.oauth2Service||(yield this.constructOauth2Service()),!this.oauth2Service)throw(0,s.f3)("No service is provided to activate Oauth2 token");yield this.oauth2Service.activateOauth2Token(e,t,i)})),this.activateOauth2TokenAfterSuccessIsReceived=(e,t,i,r,o)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"activateOauth2TokenAfterSuccessIsReceived func"),r.markPhase("InvokeToActivateOauth2Token");try{if(!i)throw(0,s.f3)("No auth code is provided. Activate Oauth Token failed.");yield this.callActivateOauth2Token(e,t,i),this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"activateOauth2TokenAfterSuccessIsReceived func success"),o.onSuccess()}catch(e){this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,"activateOauth2TokenAfterSuccessIsReceived func failed"),o.onFailure(e)}})),this.hostedWebContentExternalOauthServiceFactory=null!=p?p:(e,t,i,n,r,o)=>new we(e,t,i,n,r,o),this.hostedWebContentPPCAuthServiceFactory=null!=u?u:(e,t,i,n,r,o)=>new ke(e,t,i,n,r,o)}authenticateAndResendRequest(e,t,i,n,r,o){return this.executeCapabilityFunction(this.authenticateAndResendRequestExecutor,{appId:e,originalRequestInfo:t,url:"string"==typeof i?i:i.href,width:r,height:o,isExternal:n})}authenticateWithSSOInternal(e,t,i,n){return this.executeCapabilityFunction(this.authenticateWithSSOExecutor,{appId:e,origin:t,claims:i,silent:n})}authenticateWithSSO(e,t,i){var n;return this.authenticateWithSSOInternal(e,(null===(n=this.appSdkHost.getHostWindow())||void 0===n?void 0:n.location.href)||"",t,i)}authenticateWithSSOAndResendRequestInternal(e,t,i,n,r){return this.executeCapabilityFunction(this.authenticateWithSSOAndResendRequestExecutor,{appId:e,originalRequestInfo:t,origin:i,claims:n,silent:r})}authenticateWithSSOAndResendRequest(e,t,i,n){var r;return this.authenticateWithSSOAndResendRequestInternal(e,t,(null===(r=this.appSdkHost.getHostWindow())||void 0===r?void 0:r.location.href)||"",i,n)}authenticateWithOauth2(e,t,i,r,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.executeCapabilityFunction(this.authenticateWithOauth2Executor,{titleId:e,oauthConfigId:t,width:i,height:r,_isExternal:o})}))}authenticateWithPPC(e,t,i,r,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.executeCapabilityFunction(this.authenticateWithPPCExecutor,{titleId:e,signInUrl:t,width:i,height:r,_isExternal:o})}))}constructOauth2Service(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!this.signInUrlInfoServiceProvider)throw(0,s.f3)("No service is provided to retrieve signInUrl");this.oauth2Service=this.isExternalAppOauth2Service(this.signInUrlInfoServiceProvider)?this.signInUrlInfoServiceProvider:yield xe.build(this.signInUrlInfoServiceProvider)}))}isValidOauthUrl(e){if(!e)return!1;try{const t=new URL(e),i=new URL(this.getUrlParameters(t,"redirect_uri"));return this.getUrlParameters(t,"client_id"),this.getUrlParameters(t,"response_type"),"https:"===t.protocol&&i&&"https:"===i.protocol}catch(e){return!1}}isValidPPCUrl(e,t){if(!e||!t)return!1;try{const i=new URL(e);return(0,c.F6)(i,t,this.logger)}catch(e){return!1}}getUrlParameters(e,t){const i=new URLSearchParams(e.search).get(t);if(i)return i;throw Error(`${t} is undefined or null`)}isExternalAppOauth2Service(e){return void 0!==e.getSignInUrlInfo}}const He={dependentHubServiceSelector:e=>{var t;return e.authenticationService&&e.externalAppInfoService&&e.externalAppChannelService?{authenticationService:e.authenticationService,externalAppInfoService:e.externalAppInfoService,externalAppChannelService:e.externalAppChannelService,oauth2ServiceProvider:null!==(t=e.externalAppOauth2Service)&&void 0!==t?t:e.mos3TokenGenerationService}:void 0},messageHandlerFactory:(e,t,i)=>new Pe(e,new Fe(e,t.authenticationService,t.externalAppInfoService,t.externalAppChannelService,t.oauth2ServiceProvider,i,e.getLogger()),i)};class Pe extends b.R{constructor(e,t,i){super(e,i),this.appSdkHost=e,this.externalAppAuthExecutor=t,this.TAG="ExternalAppAuthenticationMessageHandler",this.isTelemetryHandledByExecutor=!0}initHandlers(){this.registerHandler(y.tz.externalAppAuthentication.authenticateAndResendRequest,this.handleAuthenticateAndResendRequest,{errorCallback:e=>this.onAuthenticateError(e)}),this.registerHandler(y.tz.externalAppAuthentication.authenticateWithSSO,this.handleAuthenticateWithSSO,{errorCallback:e=>this.onAuthenticateError(e)}),this.registerHandler(y.tz.externalAppAuthentication.authenticateWithSSOAndResendRequest,this.handleAuthenticateWithSSOAndResendRequest,{errorCallback:e=>this.onAuthenticateError(e)}),this.registerHandler(y.tz.externalAppAuthentication.authenticateWithOauth2,this.handleAuthenticateWithOauth2,{errorCallback:e=>this.onAuthenticateError(e)}),this.registerHandler(y.tz.externalAppAuthentication.authenticateWithPowerPlatformConnectorPlugins,this.authenticateWithPowerPlatformConnectorPlugins,{errorCallback:e=>this.onAuthenticateError(e)})}canHandleMessage(e){return super.canHandleMessage(e)&&(0,c.wr)(this.appDefinition)}handleAuthenticateAndResendRequest(e,t,i,r,o,a,l){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=(0,A.Yj)(e.data);return this.externalAppAuthExecutor.authenticateAndResendRequest(t,i,r,null!=l&&l,o,a).then((e=>this.postResponseToAppAndLog("notifySuccess func",n,[!0,e])),(e=>this.postResponseToAppAndLog("AuthenticateAndResendRequest",n,[!1,(0,s.f3)(e)]))),s.f1}))}handleAuthenticateWithSSO(e,t,i,r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.externalAppAuthExecutor.authenticateWithSSOInternal(t,e.origin,i,r),(0,s.PR)([!0])}))}handleAuthenticateWithSSOAndResendRequest(e,t,i,r,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield this.externalAppAuthExecutor.authenticateWithSSOAndResendRequestInternal(t,i,e.origin,r,o);return(0,s.PR)([!0,n])}))}authenticateWithPowerPlatformConnectorPlugins(e,t,i,r,o,l){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=(0,A.Yj)(e.data),l=(0,s.sC)(n);return this.externalAppAuthExecutor.authenticateWithPPC(t,i,r,o).then((()=>{this.appSdkHost.postResponseToApp(n,[!0,"success"]),this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`notifySuccess func: ${l}`)}),(e=>{this.appSdkHost.postResponseToApp(n,[!1,(0,s.f3)(e)]),this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`ppc notifyFailure func: ${l} : ${e}`)})),s.f1}))}handleAuthenticateWithOauth2(e,t,i,r,o,l){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=(0,A.Yj)(e.data),l=(0,s.sC)(n);return this.externalAppAuthExecutor.authenticateWithOauth2(t,i,r,o).then((()=>{this.appSdkHost.postResponseToApp(n,[!0,"success"]),this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`notifySuccess func: ${l}`)}),(e=>{this.appSdkHost.postResponseToApp(n,[!1,(0,s.f3)(e)]),this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`Oauth notifyFailure func: ${l} : ${e}`)})),s.f1}))}postResponseToAppAndLog(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){this.appSdkHost.postResponseToApp(t,i);const n=(0,s.sC)(t);this.appSdkHost.getLogger().log(a.$.Debug,this.TAG,`${e}: ${n}`)}))}onAuthenticateError(e){const t=(0,s.f3)(e);return(0,s.PR)([!1,t])}}class _e extends ve{constructor(e,t,i){super(t,i),this.externalAppInfoService=e,this.telemetryService=t,this.logger=i,this.getValidatedUrl=e=>{try{return new URL(e)}catch(e){throw{errorCode:f.he.INTERNAL_ERROR,message:"Invalid URL"}}},this.isDeepLinkUrl=e=>e.hostname.toLowerCase()===w.aw.hostname&&e.pathname.toLowerCase().startsWith(w.aw.pathname)}verifyAppIsAllowed(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!(yield this.externalAppInfoService.isAppAllowed(e)))throw{errorCode:f.he.INTERNAL_ERROR,message:y.u}}))}doesAppContainME(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return!!(yield this.getAppDefinition(e)).composeExtension}))}getAppDefinition(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.externalAppInfoService.getAppDefinition(e);if(!t)throw{errorCode:f.he.INTERNAL_ERROR,message:`Unable to retrieve AppDefinition for ${e}`};return t}))}validateAppIdAndScenario(e,t){t.addOrUpdateActivityDataField("RequestedForAppID",e),(0,pe.z)(e,{errorCode:ge.nq.INTERNAL_ERROR,message:"App ID is not valid."})}}class ze extends _e{constructor(e,t,i,r){super(t,i,r),this.externalAppCardActionsForCEAService=e,this.externalAppInfoService=t,this.telemetryService=i,this.logger=r,this.actionOpenUrlExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){this.validateAppIdAndScenario(e.appId.toString(),t),yield this.verifyAppIsAllowed(e.appId.toString());const i=yield this.externalAppCardActionsForCEAService.handleActionOpenUrl(e.appId,e.conversationId,e.url);return t.addOrUpdateActivityDataField("ActionOpenUrlType",i),i})),sdkMessageName:y.tz.externalAppCardActionsForCEA.processActionOpenUrl},this.actionSubmitExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){this.validateAppIdAndScenario(e.appId.toString(),t),yield this.verifyAppIsAllowed(e.appId.toString()),yield this.externalAppCardActionsForCEAService.handleActionSubmit(e.appId,e.conversationId,e.actionSubmitPayload)})),sdkMessageName:y.tz.externalAppCardActionsForCEA.processActionSubmit}}actionOpenUrl(e,t,i){return this.executeCapabilityFunction(this.actionOpenUrlExecutor,{appId:e,conversationId:t,url:i})}actionSubmit(e,t,i){return this.executeCapabilityFunction(this.actionSubmitExecutor,{appId:e,conversationId:t,actionSubmitPayload:i})}}const Le={dependentHubServiceSelector:e=>e.externalAppCardActionsForCEAService&&e.externalAppInfoService?{externalAppCardActionsForCEAService:e.externalAppCardActionsForCEAService,externalAppInfoService:e.externalAppInfoService}:void 0,messageHandlerFactory:(e,t,i)=>new Me(e,new ze(t.externalAppCardActionsForCEAService,t.externalAppInfoService,i,e.getLogger()),i)};class Me extends b.R{constructor(e,t,i){super(e,i),this.appSdkHost=e,this.externalAppCardActionsForCEAExecutor=t,this.isTelemetryHandledByExecutor=!0}initHandlers(){this.registerHandler(y.tz.externalAppCardActionsForCEA.processActionOpenUrl,this.handleActionOpenUrl,{errorCallback:e=>(0,s.IB)(y.tz.externalAppCardActionsForCEA.processActionOpenUrl,e,Object.values(ge.nq),{errorCode:ge.nq.INTERNAL_ERROR,message:s.vh},(e=>(0,s.PR)([e,null])))}),this.registerHandler(y.tz.externalAppCardActionsForCEA.processActionSubmit,this.handleActionSubmit,{errorCallback:e=>(0,s.IB)(y.tz.externalAppCardActionsForCEA.processActionSubmit,e,Object.values(f.he),s.kA,(e=>(0,s.PR)(e)))})}canHandleMessage(e){return super.canHandleMessage(e)&&(0,c.wr)(this.appDefinition)}handleActionOpenUrl(e,t,i,r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.externalAppCardActionsForCEAExecutor.actionOpenUrl(new Ae.l(t),i,new URL(r));return(0,s.PR)([null,e])}))}handleActionSubmit(e,t,i,r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.externalAppCardActionsForCEAExecutor.actionSubmit(new Ae.l(t),i,r),(0,s.PR)(void 0)}))}}class Ue extends _e{constructor(e,t,i,r){super(t,i,r),this.externalAppCardActionsService=e,this.externalAppInfoService=t,this.telemetryService=i,this.logger=r,this.actionOpenUrlExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var i;if(t.addOrUpdateActivityDataField("RequestedForAppID",e.appId),"string"==typeof e.url&&(e.url=this.getValidatedUrl(e.url)),(0,pe.z)(e.appId,{errorCode:ge.nq.INTERNAL_ERROR,message:"App ID is not valid."}),yield this.verifyAppIsAllowed(e.appId),this.isDeepLinkUrl(e.url)&&("plugins"===(null===(i=e.fromElement)||void 0===i?void 0:i.name)||!(yield this.doesAppContainME(e.appId))))throw{errorCode:f.he.INTERNAL_ERROR,message:ge.Nh};const n=yield this.externalAppCardActionsService.handleActionOpenUrl(e.appId,e.url.href,e.fromElement);return t.addOrUpdateActivityDataField("ActionOpenUrlType",n),n})),sdkMessageName:y.tz.externalAppCardActions.processActionOpenUrl},this.actionSubmitExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){if(t.addOrUpdateActivityDataField("RequestedForAppID",e.appId),(0,pe.z)(e.appId,{errorCode:f.he.INTERNAL_ERROR,message:"App ID is not valid."}),yield this.verifyAppIsAllowed(e.appId),!(yield this.doesAppContainME(e.appId)))throw{errorCode:f.he.INTERNAL_ERROR,message:ge.x};yield this.externalAppCardActionsService.handleActionSubmit(e.appId,e.actionSubmitPayload)})),sdkMessageName:y.tz.externalAppCardActions.processActionSubmit}}actionOpenUrl(e,t,i){return this.executeCapabilityFunction(this.actionOpenUrlExecutor,{appId:e,url:t,fromElement:i})}actionSubmit(e,t){return this.executeCapabilityFunction(this.actionSubmitExecutor,{appId:e,actionSubmitPayload:t})}}const Ne={dependentHubServiceSelector:e=>e.externalAppCardActionsService&&e.externalAppInfoService?{externalAppCardActionsService:e.externalAppCardActionsService,externalAppInfoService:e.externalAppInfoService}:void 0,messageHandlerFactory:(e,t,i)=>new We(e,new Ue(t.externalAppCardActionsService,t.externalAppInfoService,i,e.getLogger()),i)};class We extends b.R{constructor(e,t,i){super(e,i),this.appSdkHost=e,this.externalAppCardActionsExecutor=t,this.isTelemetryHandledByExecutor=!0}initHandlers(){this.registerHandler(y.tz.externalAppCardActions.processActionOpenUrl,this.handleActionOpenUrl,{errorCallback:e=>(0,s.IB)(y.tz.externalAppCardActions.processActionOpenUrl,e,Object.values(ge.nq),{errorCode:ge.nq.INTERNAL_ERROR,message:s.vh},(e=>(0,s.PR)([e,null])))}),this.registerHandler(y.tz.externalAppCardActions.processActionSubmit,this.handleActionSubmit,{errorCallback:e=>(0,s.IB)(y.tz.externalAppCardActions.processActionSubmit,e,Object.values(f.he),s.kA,(e=>(0,s.PR)([!1,e])))})}canHandleMessage(e){return super.canHandleMessage(e)&&(0,c.wr)(this.appDefinition)}handleActionOpenUrl(e,t,i,r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.externalAppCardActionsExecutor.actionOpenUrl(t,i,r);return(0,s.PR)([null,e])}))}handleActionSubmit(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.externalAppCardActionsExecutor.actionSubmit(t,i),(0,s.PR)([!0,null])}))}}class Be extends ve{constructor(e,t,i,r){super(i,r),this.externalAppCommandsService=e,this.externalAppInfoService=t,this.telemetryService=i,this.logger=r,this.actionCommandExecutor={execute:(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){t.addOrUpdateActivityDataField("RequestedForAppID",e.appId),(0,pe.z)(e.appId,{errorCode:f.he.INTERNAL_ERROR,message:"App ID is not valid."}),yield this.verifyAppIsAllowed(e.appId);const i=yield this.getAppDefinition(e.appId);if(!i.composeExtension)throw{errorCode:f.he.INTERNAL_ERROR,message:"Action Command is only supported in Message Extensions"};return this.validateActionCommandParameters(i,e.commandId,e.extractedParameters),yield this.externalAppCommandsService.handleActionCommand(e.appId,e.commandId,e.extractedParameters)})),sdkMessageName:y.tz.externalAppCommands.processActionCommand}}verifyAppIsAllowed(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!(yield this.externalAppInfoService.isAppAllowed(e)))throw{errorCode:f.he.INTERNAL_ERROR,message:y.u}}))}validateActionCommandParameters(e,t,i){var n,r;const o=null===(r=null===(n=e.composeExtension)||void 0===n?void 0:n.commands)||void 0===r?void 0:r.find((e=>e.id===t));if(!o)throw{errorCode:f.he.INTERNAL_ERROR,message:"commandId does not exist in app manifest"};{const e=o.parameterNames||[];if(!Object.keys(i).every((t=>e.includes(t))))throw{errorCode:f.he.INTERNAL_ERROR,message:"One or more parameters in extractedParameters do not exist in app manifest"}}}getAppDefinition(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.externalAppInfoService.getAppDefinition(e);if(!t)throw{errorCode:f.he.INTERNAL_ERROR,message:`Unable to retrieve AppDefinition for ${e}`};return t}))}actionCommand(e,t,i){return this.executeCapabilityFunction(this.actionCommandExecutor,{appId:e,commandId:t,extractedParameters:i})}}const Ve={dependentHubServiceSelector:e=>e.externalAppCommandsService&&e.externalAppInfoService?{externalAppCommandsService:e.externalAppCommandsService,externalAppInfoService:e.externalAppInfoService}:void 0,messageHandlerFactory:(e,t,i)=>new qe(e,new Be(t.externalAppCommandsService,t.externalAppInfoService,i,e.getLogger()),i)};class qe extends b.R{constructor(e,t,i){super(e,i),this.appSdkHost=e,this.externalAppCommandsExecutor=t,this.isTelemetryHandledByExecutor=!0}initHandlers(){this.registerHandler(y.tz.externalAppCommands.processActionCommand,this.handleActionCommand,{errorCallback:e=>(0,s.IB)(y.tz.externalAppCommands.processActionCommand,e,Object.values(f.he),s.kA,(e=>(0,s.PR)([e,null])))})}canHandleMessage(e){return super.canHandleMessage(e)&&(0,c.wr)(this.appDefinition)}handleActionCommand(e,t,i,r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.externalAppCommandsExecutor.actionCommand(t,i,r);return(0,s.PR)([null,e])}))}}const je={dependentHubServiceSelector:e=>e.filesService,messageHandlerFactory:(e,t,i)=>new $e(e,i,t)};class $e extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.filesService=i}initHandlers(){this.registerHandler(y.tz.files.openFilePreview,((e,...t)=>{const i={entityId:t[0],title:t[1],description:t[2],type:t[3],objectUrl:t[4],downloadUrl:t[5],webPreviewUrl:t[6],webEditUrl:t[7],baseUrl:t[8],editFile:t[9],subEntityId:t[10],viewerAction:t[11],fileOpenPreference:t[12]};return i.type&&i.objectUrl?(0,s.QY)(this.filesService.openFilePreview,i):Promise.reject("Invalid File Preview Parameters")}),{isRestrictedToFullTrustOrLobApps:!0}),this.registerHandler(y.tz.files.getCloudStorageFolders,((e,t)=>(0,s.N8)(t,this.filesService.getCloudStorageFolders)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.files.getCloudStorageFolders,e,t),isRestrictedToFullTrustApps:!0}),this.registerHandler(y.tz.files.addCloudStorageFolder,((e,t)=>(0,s.N8)(t,this.filesService.addCloudStorageFolder,(e=>[e.isFolderAdded,e.folders]),!0)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.files.addCloudStorageFolder,e,t),isRestrictedToFullTrustApps:!0}),this.registerHandler(y.tz.files.deleteCloudStorageFolder,((e,t,i)=>(0,s.N8)({channelId:t,folderToDelete:i},this.filesService.deleteCloudStorageFolder)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.files.deleteCloudStorageFolder,e,t),isRestrictedToFullTrustApps:!0}),this.registerHandler(y.tz.files.copyMoveFiles,((e,t,i,n,r,o)=>(0,s.N8)({selectedFiles:t,providerCode:i,destinationFolder:n,destinationProviderCode:r,isMove:o},this.filesService.copyMoveFiles)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.files.copyMoveFiles,e,t),isRestrictedToFullTrustApps:!0}),this.registerHandler(y.tz.files.getExternalProviders,((e,t=!1)=>(0,s.N8)(t,this.filesService.getExternalProviders)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.files.getExternalProviders,e,t),isRestrictedToFullTrustApps:!0}),this.registerHandler(y.tz.files.getCloudStorageFolderContents,((e,t,i)=>(0,s.N8)({folder:t,providerCode:i},this.filesService.getCloudStorageFolderContents)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.files.getCloudStorageFolderContents,e,t),isRestrictedToFullTrustApps:!0}),this.registerHandler(y.tz.files.openCloudStorageFile,((e,t,i,n)=>(0,s.N8)({file:t,providerCode:i,fileOpenPreference:n},this.filesService.openCloudStorageFile)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.files.openCloudStorageFile,e,t),isRestrictedToFullTrustApps:!0})}}const Ge={errorCode:f.O4.INTERNAL_ERROR,message:"Internal error"};class Ze extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.hostEntityTabService=i}initHandlers(){this.registerHandler(y.tz.hostEntity.tab.addAndConfigure,((e,t,i)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var e;const n=yield null===(e=this.hostEntityTabService)||void 0===e?void 0:e.addAndConfigure(t,i);return(0,s.PR)([n])}))),{isRestrictedToMicrosoftOwnedApps:!0,errorCallback:e=>(0,s.IB)(y.tz.hostEntity.tab.addAndConfigure,e,[Ge.errorCode],Ge,(e=>(0,s.PR)([e])))}),this.registerHandler(y.tz.hostEntity.tab.reconfigure,((e,t,i)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var e;const n=yield null===(e=this.hostEntityTabService)||void 0===e?void 0:e.reconfigure(t,i);return(0,s.PR)([n])}))),{isRestrictedToMicrosoftOwnedApps:!0,errorCallback:e=>(0,s.IB)(y.tz.hostEntity.tab.reconfigure,e,[Ge.errorCode],Ge,(e=>(0,s.PR)([e])))}),this.registerHandler(y.tz.hostEntity.tab.rename,((e,t,i)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var e;const n=yield null===(e=this.hostEntityTabService)||void 0===e?void 0:e.rename(t,i);return(0,s.PR)([n])}))),{isRestrictedToMicrosoftOwnedApps:!0,errorCallback:e=>(0,s.IB)(y.tz.hostEntity.tab.rename,e,[Ge.errorCode],Ge,(e=>(0,s.PR)([e])))}),this.registerHandler(y.tz.hostEntity.tab.remove,((e,t,i)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var e;const n=yield null===(e=this.hostEntityTabService)||void 0===e?void 0:e.remove(t,i);return(0,s.PR)([n])}))),{isRestrictedToMicrosoftOwnedApps:!0,errorCallback:e=>(0,s.IB)(y.tz.hostEntity.tab.remove,e,[Ge.errorCode],Ge,(e=>(0,s.PR)([e])))}),this.registerHandler(y.tz.hostEntity.tab.getAll,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var e;const i=yield null===(e=this.hostEntityTabService)||void 0===e?void 0:e.getAll(t);return(0,s.PR)([i])}))),{isRestrictedToMicrosoftOwnedApps:!0,errorCallback:e=>(0,s.IB)(y.tz.hostEntity.tab.getAll,e,[Ge.errorCode],Ge,(e=>(0,s.PR)([e])))})}}function Je(e){return void 0!==e.dependentHubServiceSelector}const Xe={dependentHubServiceSelector:e=>e.interactiveService,messageHandlerFactory:(e,t,i)=>new Ke(e,i,t)};class Ke extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.interactiveService=i}initHandlers(){this.registerHandler(y.tz.interactive.getFluidTenantInfo,(()=>(0,s.N8)(this.getParamsWithOrigin({}),this.interactiveService.getFluidTenantInfo)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.interactive.getFluidTenantInfo,e,t)}),this.registerHandler(y.tz.interactive.getFluidToken,((e,t)=>(0,s.N8)(this.getParamsWithOrigin({containerId:t}),this.interactiveService.getFluidToken)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.interactive.getFluidToken,e,t)}),this.registerHandler(y.tz.interactive.getFluidContainerId,(()=>(0,s.N8)(this.getParamsWithOrigin({}),this.interactiveService.getFluidContainerId)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.interactive.getFluidContainerId,e,t)}),this.registerHandler(y.tz.interactive.setFluidContainerId,((e,t)=>(0,s.N8)(this.getParamsWithOrigin({containerId:t}),this.interactiveService.setFluidContainerId)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.interactive.setFluidContainerId,e,t)}),this.registerHandler(y.tz.interactive.getNtpTime,(()=>(0,s.N8)(this.getParamsWithOrigin({}),this.interactiveService.getNtpTime)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.interactive.getNtpTime,e,t)}),this.registerHandler(y.tz.interactive.registerClientId,((e,t)=>(0,s.N8)(this.getParamsWithOrigin({clientId:t}),this.interactiveService.registerClientId)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.interactive.registerClientId,e,t)}),this.registerHandler(y.tz.interactive.getClientRoles,((e,t)=>(0,s.N8)(this.getParamsWithOrigin({clientId:t}),this.interactiveService.getClientRoles)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.interactive.getClientRoles,e,t)}),this.registerHandler(y.tz.interactive.getClientInfo,((e,t)=>(0,s.N8)(this.getParamsWithOrigin({clientId:t}),this.interactiveService.getClientInfo)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.interactive.getClientInfo,e,t)})}getParamsWithOrigin(e){const t=this.appSdkHost.getOrigin();if(!t)throw"Origin not set of AppSdkHost";return Object.assign(Object.assign({},e),{origin:t})}}class Ye{constructor(e){this.linkHandlers=e}tryGetDataFromLink(e){for(const t of this.linkHandlers){const i=t.tryGetDataFromLink(e);if(null!=i)return[t,i]}return null}executeData([e,t]){return e.executeData(t)}}class Qe extends b.R{constructor(e,t,i,n){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.linkService=i,this.linkHandler=n}initHandlers(){this.registerHandler(y.tz.links.openLink,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.executeLink(t),(0,s.PR)(!0)}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.links.openLink,e,t)})}executeLink(e){try{const t=new URL(e);if(this.appSdkHost.getHubInfo().name!==A.UH.teams&&this.appSdkHost.getHubInfo().name!==A.UH.teamsModern&&this.linkHandler){const e=this.linkHandler.tryGetDataFromLink(t);if(null!=e)return this.linkHandler.executeData(e)}}catch(e){this.appSdkHost.getLogger().log(a.$.Error,"LinkMessageHandler","There is an error parsing the URL",e)}return this.linkService.openLink(e)}validateDependencies(){if(!this.linkService)throw"No linkService provided"}}class et{constructor(e){this.pageService=e}tryGetDataFromLink(e){if(!this.pageService)return null;if("https:"!==e.protocol)return null;if(e.origin!=w.sB)return null;if(!e.pathname.startsWith("/l/entity/"))return null;const t=e.pathname.substring(10).split("/");if(2!==t.length)return null;const i=t[0],n=t[1],r=e.searchParams.get("webUrl")||void 0,o=e.searchParams.get("context");let a,s,l;if(o)try{const e=JSON.parse(o);e&&"object"==typeof e&&(a=e.subEntityId,s=e.channelId,l=e.chatId)}catch(e){}return{appId:i,pageId:n,webUrl:r,subPageId:a,channelId:s,chatId:l}}executeData(e){return this.pageService.navigateToApp(e)}}const tt="location.map is not supported on this host.",it={dependentHubServiceSelector:e=>e.locationService&&e.devicePermissionService?{locationService:e.locationService,permissionsService:e.devicePermissionService}:void 0,messageHandlerFactory:(e,t,i)=>new nt(e,i,t.permissionsService,t.locationService)};class nt extends b.R{constructor(e,t,i,n){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.permissionsService=i,this.locationService=n}initHandlers(){this.registerHandler(y.tz.location.getCurrentLocation,((e,t)=>this.handleGetCurrentLocation(t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.location.getCurrentLocation,e,t)}),this.registerHandler(y.tz.location.map.showLocation,((e,t)=>this.handleShowLocation(t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.location.map.showLocation,e,t)})}handleShowLocation(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(this.locationService.mapService)return(0,s.N8)(e,this.locationService.mapService.showLocation);throw(0,s.jC)(f.O4.INTERNAL_ERROR,tt)}))}handleGetCurrentLocation(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(yield(0,s.og)(this.permissionsService,M.m.GeoLocation),!e.allowChooseLocation&&!e.showMap)return(0,s.N8)(e,this.locationService.getCurrentLocation);if(this.locationService.mapService)return this.handleGetLocationServiceInMap(e);throw(0,s.jC)(f.O4.INTERNAL_ERROR,tt)}))}handleGetLocationServiceInMap(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return(0,s.N8)(null,!e.allowChooseLocation&&e.showMap?this.locationService.mapService.getCurrentLocationOnMap:this.locationService.mapService.chooseLocation)}))}}const rt={dependentHubServiceSelector:e=>e.logService,messageHandlerFactory:(e,t,i)=>new ot(e,i,t)};class ot extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.logService=i}initHandlers(){this.registerHandler(y.tz.logs.handleAppLog,((e,t)=>(0,s.QY)(this.logService.handleAppLog,t)))}}class at extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.handoffService=i}initHandlers(){this.registerHandler(y.tz.mail.handoff.composeMail,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var e;return yield null===(e=this.handoffService)||void 0===e?void 0:e.composeMailWithHandoff(t),(0,s.PR)()}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.mail.handoff.composeMail,e,t)})}validateDependencies(){if(!this.handoffService)throw"No handoffService provided"}}const st={dependentHubServiceSelector:e=>e.mailService,messageHandlerFactory:(e,t,i)=>new lt(e,i,t)};class lt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.mailService=i}initHandlers(){this.registerHandler(y.tz.mail.openMailItem,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.mailService.openMailItem(t),(0,s.PR)([!0])}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.mail.openMailItem,e,t)}),this.registerHandler(y.tz.mail.composeMail,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.mailService.composeMail(t),(0,s.PR)([!0])}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.mail.composeMail,e,t)})}}var dt,ct,pt,ut;!function(e){e.TACAdminUser="TACAdminUser",e.TeamsAdminUser="TeamsAdminUser",e.TeamsEndUser="TeamsEndUser"}(dt||(dt={})),function(e){e.Open="Open",e.Processing="Processing",e.Processed="Processed",e.Closed="Closed",e.Error="Error"}(ct||(ct={})),function(e){e.GetCart="GetCart",e.AddOrUpdateCartItems="AddOrUpdateCartItems",e.RemoveCartItems="RemoveCartItems",e.UpdateCartStatus="UpdateCartStatus"}(pt||(pt={})),function(e){e[e.V1=1]="V1"}(ut||(ut={}));const ht={dependentHubServiceSelector:e=>e.marketplaceService,messageHandlerFactory:(e,t,i)=>new gt(e,i,t)};class gt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.marketplaceService=i}initHandlers(){this.registerHandler(y.tz.marketplace.getCart,((e,t)=>this.dispatchMarketplaceHandlers(t,pt.GetCart)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.marketplace.getCart,e,t)}),this.registerHandler(y.tz.marketplace.addOrUpdateCartItems,((e,t)=>this.dispatchMarketplaceHandlers(t,pt.AddOrUpdateCartItems)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.marketplace.addOrUpdateCartItems,e,t)}),this.registerHandler(y.tz.marketplace.removeCartItems,((e,t)=>this.dispatchMarketplaceHandlers(t,pt.RemoveCartItems)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.marketplace.removeCartItems,e,t)}),this.registerHandler(y.tz.marketplace.updateCartStatus,((e,t)=>this.dispatchMarketplaceHandlers(t,pt.UpdateCartStatus)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.marketplace.updateCartStatus,e,t)})}dispatchMarketplaceHandlers(e,t){var i;let n;const r=t===pt.GetCart?null==e?void 0:e.majorVersion:null===(i=null==e?void 0:e.cartVersion)||void 0===i?void 0:i.majorVersion;if(r!==ut.V1)return Promise.reject({errorCode:f.O4.NOT_SUPPORTED_ON_PLATFORM,message:`Cart version ${r} is not supported`});switch(n=this.marketplaceService,t){case pt.GetCart:return(0,s.N8)(e,n.getCart);case pt.AddOrUpdateCartItems:return(0,s.N8)(e,n.addOrUpdateCartItems);case pt.RemoveCartItems:return(0,s.N8)(e,n.removeCartItems);case pt.UpdateCartStatus:return(0,s.N8)(e,n.updateCartStatus);default:return Promise.reject({errorCode:f.O4.NOT_SUPPORTED_ON_PLATFORM,message:`Marketplace method ${t} is not supported`})}}}const vt={dependentHubServiceSelector:e=>e.mediaService,messageHandlerFactory:(e,t,i)=>new mt(e,i,t)};class mt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.mediaService=i}initHandlers(){this.registerHandler(y.tz.media.selectMedia,((e,t)=>(0,s.N8)(t,this.mediaService.selectMedia)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.media.selectMedia,e,t)}),this.registerHandler(y.tz.media.captureImage,(e=>(0,s.N8)(St,this.mediaService.selectMedia)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.media.selectMedia,e,t)}),this.registerHandler(y.tz.media.getMedia,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.mediaService.getMedia(t,(t=>this.postMediaResult((0,A.Yj)(e.data),t))),s.f1}))),{errorCallback:this.onGetMediaError}),this.registerHandler(y.tz.media.viewImages,((e,t)=>(0,s.JA)(this.mediaService.viewImages,t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.media.viewImages,e,t)})}onGetMediaError(e,t){return null==t||t.fail(`GetMedia failed ${(0,s.oE)(e)}`),(0,s.PR)({error:s.UR})}postMediaResult(e,t){return t.mediaChunk?(this.appSdkHost.postResponseToApp(e,[t],t.mediaChunk.chunkSequence>0),Promise.resolve()):Promise.reject("empty media chunk")}}const St={mediaType:1,maxMediaCount:1,imageProps:{sources:[1,2],startMode:1,ink:!0,cameraSwitcher:!0,textSticker:!0,enableFilter:!1}},ft={dependentHubServiceSelector:e=>e.meetingService,messageHandlerFactory:(e,t,i)=>new At(e,i,t)};class At extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.meetingService=i}initHandlers(){this.registerHandler(y.tz.meeting.getIncomingClientAudioState,(()=>(0,s.N8)(null,this.meetingService.getIncomingClientAudioState)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.getIncomingClientAudioState,e,t)}),this.registerHandler(y.tz.meeting.toggleIncomingClientAudio,(()=>(0,s.N8)(null,this.meetingService.toggleIncomingClientAudio)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.toggleIncomingClientAudio,e,t)}),this.registerHandler(y.tz.meeting.getMeetingDetails,((e,t)=>(0,s.N8)(t,this.meetingService.getMeetingDetails)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.getMeetingDetails,e,t)}),this.registerHandler(y.tz.meeting.getAuthenticationTokenForAnonymousUser,(()=>(0,s.N8)(null,this.meetingService.getAuthenticationTokenForAnonymousUser)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.getAuthenticationTokenForAnonymousUser,e,t),isRestrictedToFullTrustApps:!0}),this.registerHandler(y.tz.meeting.getLiveStreamState,(()=>(0,s.N8)(null,this.meetingService.getLiveStreamState)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.getLiveStreamState,e,t)}),this.registerHandler(y.tz.meeting.requestStartLiveStreaming,((e,...t)=>(0,s.JA)(this.meetingService.requestStartLiveStreaming,...t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.requestStartLiveStreaming,e,t)}),this.registerHandler(y.tz.meeting.requestStopLiveStreaming,(()=>(0,s.N8)(null,this.meetingService.requestStopLiveStreaming)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.requestStopLiveStreaming,e,t)}),this.registerHandler(y.tz.meeting.shareAppContentToStage,((e,...t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.meetingService.shareAppContentToStage(...t);return(0,s.hl)(e)?Promise.reject(e):(0,s.PR)([null,e])}))),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.shareAppContentToStage,e,t)}),this.registerHandler(y.tz.meeting.appShareButton.setOptions,((e,t)=>(0,s.N8)(t,this.meetingService.appShareButton.setOptions)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.appShareButton.setOptions,e,t)}),this.registerHandler(y.tz.meeting.getAppContentStageSharingCapabilities,(()=>(0,s.N8)(null,this.meetingService.getAppContentStageSharingCapabilities)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.getAppContentStageSharingCapabilities,e,t)}),this.registerHandler(y.tz.meeting.stopSharingAppContentToStage,(()=>(0,s.N8)(null,this.meetingService.stopSharingAppContentToStage)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.stopSharingAppContentToStage,e,t)}),this.registerHandler(y.tz.meeting.getAppContentStageSharingState,(()=>(0,s.N8)(null,this.meetingService.getAppContentStageSharingState)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.getAppContentStageSharingState,e,t)}),this.registerHandler(y.tz.meeting.requestAppAudioHandling,((e,t)=>(0,s.N8)(t,this.meetingService.requestAppAudioHandling)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.requestAppAudioHandling,e,t)}),this.registerHandler(y.tz.meeting.updateMicState,((e,...t)=>(0,s.JA)(this.meetingService.updateMicState,...t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.updateMicState,e,t)}),this.registerHandler(y.tz.meeting.joinMeeting,((e,t)=>(0,s.N8)(Object.assign(Object.assign({},t),{joinWebUrl:new URL(t.joinWebUrl)}),this.meetingService.joinMeeting)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meeting.joinMeeting,e,t)})}}const Ct={dependentHubServiceSelector:e=>e.meetingRoomService,messageHandlerFactory:(e,t,i)=>new It(e,i,t)};class It extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.meetingRoomService=i}initHandlers(){this.registerHandler(y.tz.meetingRoom.getPairedMeetingRoomInfo,(()=>(0,s.N8)(null,this.meetingRoomService.getPairedMeetingRoomInfo)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meetingRoom.getPairedMeetingRoomInfo,e,t)}),this.registerHandler(y.tz.meetingRoom.sendCommandToPairedMeetingRoom,((e,t)=>(0,s.N8)(t,this.meetingRoomService.sendCommandToPairedMeetingRoom)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.meetingRoom.sendCommandToPairedMeetingRoom,e,t)})}}class yt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.messageChannelsService=i}initHandlers(){this.registerHandler(y.tz.messageChannels.dataLayer.getDataLayerPort,(e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.messageChannelsService.dataLayer.getDataLayerPort();return this.appSdkHost.postResponseToApp((0,A.Yj)(e.data),void 0,void 0,[t]),s.f1}))),{isRestrictedToMicrosoftOwnedApps:!0,errorCallback:(e,t)=>(0,s.eZ)(y.tz.messageChannels.dataLayer.getDataLayerPort,e,t)})}validateDependencies(){var e;if(!(null===(e=this.messageChannelsService)||void 0===e?void 0:e.dataLayer))throw"No data layer service for message channels provided"}}class Et extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.messageChannelsService=i}initHandlers(){this.registerHandler(y.tz.messageChannels.telemetry.getTelemetryPort,(e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.messageChannelsService.telemetry.getTelemetryPort();return this.appSdkHost.postResponseToApp((0,A.Yj)(e.data),void 0,void 0,[t]),s.f1}))),{isRestrictedToMicrosoftOwnedApps:!0,errorCallback:(e,t)=>(0,s.eZ)(y.tz.messageChannels.telemetry.getTelemetryPort,e,t)})}validateDependencies(){var e;if(!(null===(e=this.messageChannelsService)||void 0===e?void 0:e.telemetry))throw"No telemetry service provided for message channels"}}const bt={dependentHubServiceSelector:e=>e.monetizationService,messageHandlerFactory:(e,t,i)=>new Rt(e,i,t)};class Rt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.monetizationService=i}initHandlers(){this.registerHandler(y.tz.monetization.openPurchaseExperience,((e,t)=>(0,s.JA)(this.monetizationService.openPurchaseExperience,t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.monetization.openPurchaseExperience,e,t)})}}const Tt={dependentHubServiceSelector:e=>e.nestedAppAuthService,messageHandlerFactory:(e,t,i)=>new wt(e,i,t)};class wt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.nestedAppAuthService=i,this.RESPONSE_STATUS_KEY="ResponseStatus",this.ERROR_CODE_KEY="ErrorCode",this.SUB_ERROR_KEY="SubError",this.MSAL_TIMESTAMP_KEY="MsalTimestamp",this.CORRELATION_ID_KEY="CorrelationId",this.IS_DEEPLY_NESTED_REQUEST_KEY="IsDeeplyNestedRequest",this.REQUEST_METHOD_NAME="MethodName"}initHandlers(){this.registerHandler(y.tz.nestedAppAuth.execute,((e,t)=>{var i;let r=e;this.isValidRequest(r);const o=new URL(r.origin),a=null!==(i=r.isTrustedOrigin)&&void 0!==i&&i;return this.logRequestTelemetry(r,t),(0,s.N8)({payload:r.data.data,origin:o},(e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){t.markPhase("MessagePreprocessing",!0);const i=yield this.nestedAppAuthService.execute(e.payload,e.origin,a);return t.markPhase("HubProcessing",!0),this.logResponseTelemetry(i,t),i}))))}),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.nestedAppAuth.execute,e,t)})}logRequestTelemetry(e,t){var i;if(e.data&&"object"==typeof e.data&&"string"==typeof(null===(i=e.data)||void 0===i?void 0:i.data)){try{const i=JSON.parse(e.data.data),{sendTime:n,method:r,tokenParams:o}=i||{};t.addOrUpdateActivityDataField(this.MSAL_TIMESTAMP_KEY,n),t.addOrUpdateActivityDataField(this.REQUEST_METHOD_NAME,r);const a=null==o?void 0:o.correlationId;(0,re.A)(a)&&t.addOrUpdateActivityDataField(this.CORRELATION_ID_KEY,a)}catch(e){const t="Unable to log NAA payload properties in telemetry due to unknown type";this.appSdkHost.getLogger().log(a.$.Warn,t,e)}t.addOrUpdateActivityDataField(this.IS_DEEPLY_NESTED_REQUEST_KEY,e.isDeeplyNestedRequest)}}logResponseTelemetry(e,t){try{const{success:i,error:n}=JSON.parse(e);if(!i){if(n){const{status:e,code:i}=n;t.addOrUpdateActivityDataField(this.RESPONSE_STATUS_KEY,e),t.addOrUpdateActivityDataField(this.ERROR_CODE_KEY,i)}t.fail(`Nested app auth request failed: ${(null==n?void 0:n.status)||"unknown status"}`)}}catch(e){}}isValidRequest(e){if(e.isDeeplyNestedRequest&&!this.nestedAppAuthService.isDeeplyNestedAuthSupported())throw(0,s.jC)(f.O4.NOT_SUPPORTED_ON_PLATFORM,"Deeply nested request is not supported");return!0}}const Dt={dependentHubServiceSelector:e=>e.notificationService,messageHandlerFactory:(e,t,i)=>new kt(e,i,t)};class kt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.notificationService=i}initHandlers(){this.registerHandler(y.tz.notifications.showNotification,((e,t)=>(0,s.QY)(this.notificationService.showNotification,t)),{isRestrictedToFullTrustApps:!0})}}const xt={dependentHubServiceSelector:e=>e.otherAppStateChangeService,messageHandlerFactory:(e,t,i)=>new Ot(e,i,t)};class Ot extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.otherAppStateChangeService=i}initHandlers(){this.registerHandler(y.tz.otherAppStateChange.unregisterInstall,(e=>(this.otherAppStateChangeService.clearListeners(),Promise.resolve(s.f1))),{}),this.registerHandler(y.tz.otherAppStateChange.notifyInstallCompleted,((e,t)=>(this.otherAppStateChangeService.notifyInstallCompleted(new Ae.l(t)),Promise.resolve(s.f1))),{})}canHandleMessage(e){var t;if(!super.canHandleMessage(e))return!1;switch(e){case y.tz.otherAppStateChange.unregisterInstall:return(0,c.wr)(this.appDefinition);case y.tz.otherAppStateChange.notifyInstallCompleted:return(0,c.hq)(null===(t=this.appDefinition)||void 0===t?void 0:t.id);default:return!1}}}class Ft extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.configService=i}initHandlers(){if(this.appSdkHost.getFrameContext()===A.E2.settings&&!this.configService)throw new Error("Config Service needs to be implemented when in settings frame context");this.registerHandler(y.tz.pages.config.setConfig,((e,t)=>(0,s.JA)(this.configService.setConfig,t)),{errorCallback:(e,t)=>(0,s.M5)(y.tz.pages.config.setConfig,e,t)}),this.registerHandler(y.tz.pages.config.setValidityState,((e,t)=>(0,s.QY)(this.configService.setValidityState,t))),this.registerHandler(y.tz.pages.config.save.success,(e=>(0,s.QY)(this.configService.onSaveSuccess))),this.registerHandler(y.tz.pages.config.save.failure,((e,t)=>(0,s.QY)(this.configService.onSaveFailure,t))),this.registerHandler(y.tz.pages.config.remove.success,(e=>(0,s.QY)(this.configService.onRemoveSuccess))),this.registerHandler(y.tz.pages.config.remove.failure,((e,t)=>(0,s.QY)(this.configService.onRemoveFailure,t)))}validateDependencies(){if(!this.configService)throw"No configService provided"}}const Ht={dependentHubServiceSelector:e=>e.pageService,messageHandlerFactory:(e,t,i)=>new Pt(e,i,t)};class Pt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.pageService=i,this.getConfig=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=this.pageService&&this.pageService.getConfig?yield this.pageService.getConfig():this.getDefaultConfig();return(0,s.PR)(e)}))}initHandlers(){this.registerHandler(y.tz.pages.getConfig,this.getConfig),this.registerHandler(y.tz.pages.returnFocus,((e,t,i)=>(0,s.QY)(this.pageService.returnFocus,t,i))),this.registerHandler(y.tz.pages.setCurrentFrame,this.handleSetCurrentFrame),this.registerHandler(y.tz.pages.navigateCrossDomain,this.handleLoadCrossDomainUrl,{errorCallback:(e,t)=>(0,s.M5)(y.tz.pages.navigateCrossDomain,e,t)}),this.registerHandler(y.tz.pages.navigateToApp,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.pageService.navigateToApp(t),(0,s.PR)(!0)}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.pages.navigateToApp,e,t)}),this.registerHandler(y.tz.pages.shareDeepLink,((e,t,i,n)=>(0,s.QY)(this.pageService.shareDeepLink,{subEntityId:t,subEntityLabel:i,subEntityWebUrl:n}))),this.registerHandler(y.tz.pages.currentApp.navigateTo,this.buildParamsAndCallNavigateToApp,{errorCallback:(e,t)=>(0,s.eZ)(y.tz.pages.currentApp.navigateTo,e,t)}),this.registerHandler(y.tz.pages.currentApp.navigateToDefaultPage,this.buildParamsAndCallNavigateToApp,{errorCallback:(e,t)=>(0,s.eZ)(y.tz.pages.currentApp.navigateToDefaultPage,e,t)})}getDefaultConfig(){const e=this.appSdkHost.getOrigin();if(!e)throw new Error("Origin not set of AppSdkHost");const t=this.appSdkHost.getContext(),i=this.appSdkHost.getAppDefinition(),n=i&&(0,w.L9)(i,t.page.id);return{contentUrl:e,entityId:t.page.id,suggestedDisplayName:n}}handleSetCurrentFrame(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.appSdkHost.getAppContext(),i=this.appSdkHost.getLogger();try{(0,c.dA)(t.contentUrl,i,e,this.appDefinition)&&(0,c.dA)(t.websiteUrl,i,e,this.appDefinition)&&this.pageService.setCurrentFrame(t)}catch(e){i.log(a.$.Error,"handleSetCurrentFrame",y.Si,null)}return s.f1}))}handleLoadCrossDomainUrl(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=this.appSdkHost.getLogger();try{if((0,c.dA)(t,e,yield this.appSdkHost.getAppContext(),this.appDefinition))return yield this.appSdkHost.load(t,yield this.appSdkHost.getAppContext()),(0,s.PR)(!0)}catch(t){e.log(a.$.Error,"handleLoadCrossDomainUrl",y.Si,null)}throw y.Si}))}buildParamsAndCallNavigateToApp(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let e;const i=this.appSdkHost.getAppDefinition();if(!(null==i?void 0:i.id))throw(0,s.jC)(f.O4.INTERNAL_ERROR,"An error ocurred while locating application ID");let n;e=t?{appId:null==i?void 0:i.id,pageId:t.pageId,subPageId:t.subPageId}:{appId:null==i?void 0:i.id,pageId:(null==i?void 0:i.pages.static[0].entityId)?i.pages.static[0].entityId:""};try{n=(0,s.N8)(e,this.pageService.navigateToApp)}catch(e){throw(0,s.jC)(f.O4.INTERNAL_ERROR,e)}return n}))}}class _t extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.pageTabsService=i}initHandlers(){this.registerHandler(y.tz.pages.tabs.navigateToTab,((e,t)=>(0,s.JA)(this.pageTabsService.navigateToTab,t)),{errorCallback:(e,t)=>(0,s.M5)(y.tz.pages.tabs.navigateToTab,e,t)}),this.registerHandler(y.tz.pages.tabs.getTabInstances,((e,t)=>(0,s.JA)(this.pageTabsService.getTabInstances,t)),{errorCallback:(e,t)=>this.onGetTabsError(y.tz.pages.tabs.getTabInstances,e,t)}),this.registerHandler(y.tz.pages.tabs.getMruTabInstances,((e,t)=>(0,s.JA)(this.pageTabsService.getMruTabInstances,t)),{errorCallback:(e,t)=>this.onGetTabsError(y.tz.pages.tabs.getMruTabInstances,e,t)})}validateDependencies(){if(!this.pageTabsService)throw"No pageTabsService provided"}onGetTabsError(e,t,i){return null==i||i.fail(`${e} failed ${(0,s.oE)(t)}`),(0,s.PR)({teamTabs:[]})}}class zt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.backStackService=i}initHandlers(){this.registerHandler(y.tz.pages.backStack.navigateBack,(e=>(0,s.JA)(this.backStackService.navigateBack)),{errorCallback:(e,t)=>(0,s.M5)(y.tz.pages.backStack.navigateBack,e,t)})}validateDependencies(){if(!this.backStackService)throw"No backStackService provided"}}class Lt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.fullTrustService=i}initHandlers(){this.registerHandler(y.tz.pages.fullTrust.enterFullscreen,(e=>(0,s.QY)(this.fullTrustService.enterFullscreen)),{isRestrictedToFullTrustApps:!0}),this.registerHandler(y.tz.pages.fullTrust.exitFullscreen,(e=>(0,s.QY)(this.fullTrustService.exitFullscreen)),{isRestrictedToFullTrustApps:!0})}validateDependencies(){if(!this.fullTrustService)throw"No fullTrustService provided"}}const Mt={dependentHubServiceSelector:e=>e.peopleService,messageHandlerFactory:(e,t,i)=>new Ut(e,i,t)};class Ut extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.peopleService=i}initHandlers(){this.registerHandler(y.tz.people.selectPeople,((e,t)=>(0,s.N8)(t,this.peopleService.selectPeople)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.people.selectPeople,e,t)})}}const Nt={dependentHubServiceSelector:e=>e.devicePermissionService,messageHandlerFactory:(e,t,i)=>new Wt(e,i,t)};class Wt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.permissionsService=i}initHandlers(){this.registerHandler(y.tz.permissions.requestUserConsentForPermission,((e,t)=>this.handleRequestUserConsentAndStorePermissions(t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.permissions.requestUserConsentForPermission,e,t)}),this.registerHandler(y.tz.permissions.storageService.getPermissionStatus,((e,t)=>(0,s.N8)(t,this.permissionsService.storageService.getPermissionStatus,(e=>e==M.W.Consented))),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.permissions.storageService.getPermissionStatus,e,t)})}handleRequestUserConsentAndStorePermissions(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){this.verifyPermissionsInManifest(e);const t=yield this.checkPermissionsInStorage(e);if(t!==M.W.NeverAsked)return(0,s.PR)([null,t==M.W.Consented]);const i=yield this.requestUserConsent(e);return yield this.storePermissions(i),(0,s.PR)([null,i.status==M.W.Consented])}))}verifyPermissionsInManifest(e){if(!this.appDefinition.devicePermissions.some((t=>t.toLowerCase()===e.toString().toLowerCase())))throw(0,s.jC)(f.O4.INTERNAL_ERROR,"permission does not exist in the app manifest")}checkPermissionsInStorage(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.permissionsService.storageService.getPermissionStatus(e)}))}requestUserConsent(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let t;try{t=yield this.permissionsService.requestUserConsentForPermission(e)}catch(e){throw(0,s.jC)(f.O4.INTERNAL_ERROR,"An error occurred while requesting the user consent for permissions")}return t}))}storePermissions(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){yield this.permissionsService.storageService.storePermissionConsent(e)}))}}const Bt={dependentHubServiceSelector:e=>e.profileService,messageHandlerFactory:(e,t,i)=>new Vt(e,i,t)};class Vt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.profileService=i}initHandlers(){this.registerHandler(y.tz.profile.showProfile,((e,t)=>{const i=this.appSdkHost.getFrame(),{x:n,y:r}=i?i.getBoundingClientRect():{x:0,y:0},o=DOMRect.fromRect({x:t.targetRectangle.x+n,y:t.targetRectangle.y+r,width:t.targetRectangle.width,height:t.targetRectangle.height});return(0,s.N8)({modality:t.modality,persona:t.persona,targetElementBoundingRect:o,triggerType:t.triggerType},this.profileService.showProfile)}),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.profile.showProfile,e,t)})}}class qt extends b.R{constructor(e,t,i,n,r,o,s,l,d,p,u,h,g){if(super(e,t),this.appSdkHost=e,this.telemetryService=t,this.bootstrapRegistrationState=g,this.registeredHandlers=new Map,this.userSettings=[],this.cacheabilityDataService=i,this.registerHandlerImpl("themeChange",(t=>e.onThemeChanged=e=>t({data:e})),"eventDispatch.themeChange"),this.registerHandlerImpl("userSettingsChange",(t=>e.onUserSettingsChanged=(e,i)=>this.userSettings.includes(e)&&t({data:[e,i]})),"eventDispatch.userSettingsChange",!0),o&&(o.clearListeners(),this.registerHandlerImpl("log.request",(e=>o.addEventListener("log.request",e)),"eventDispatch.log.request",!1,{isRestrictedToFullTrustApps:!0})),l&&(l.clearListeners(),this.registerHandlerImpl("meeting.liveStreamChanged",(e=>l.addEventListener("liveStreamChanged",e)),"eventDispatch.meeting.liveStreamChanged"),this.registerHandlerImpl("meeting.raiseHandStateChanged",(e=>l.addEventListener("raiseHandStateChanged",e)),"eventDispatch.meeting.raiseHandStateChanged"),this.registerHandlerImpl("meeting.speakingStateChanged",(e=>l.addEventListener("speakingStateChanged",e)),"eventDispatch.meeting.speakingStateChanged"),this.registerHandlerImpl("meeting.meetingReactionReceived",(e=>l.addEventListener("meetingReactionReceived",e)),"eventDispatch.meeting.meetingReactionReceived"),this.registerHandlerImpl("meeting.micStateChanged",(e=>l.addEventListener("micStateChanged",e)),"eventDispatch.meeting.micStateChanged"),this.registerHandlerImpl("meeting.audioDeviceSelectionChanged",(e=>l.addEventListener("audioDeviceSelectionChanged",e)),"eventDispatch.meeting.audioDeviceSelectionChanged")),d&&(d.clearListeners(),this.registerHandlerImpl("meetingRoom.meetingRoomCapabilitiesUpdate",(e=>d.addEventListener("meetingRoomCapabilitiesUpdate",e)),"eventDispatch.meetingRoomCapabilitiesUpdate"),this.registerHandlerImpl("meetingRoom.meetingRoomStatesUpdate",(e=>d.addEventListener("meetingRoomStatesUpdate",e)),"eventDispatch.meetingRoomStatesUpdate")),u&&(u.clearListeners(),this.registerHandlerImpl("search.queryChange",(e=>u.addEventListener("queryChange",e)),"eventDispatch.search.queryChange"),this.registerHandlerImpl("search.queryClose",(e=>u.addEventListener("queryClose",e)),"eventDispatch.search.queryClose"),this.registerHandlerImpl("search.queryExecute",(e=>u.addEventListener("queryExecute",e)),"eventDispatch.search.queryExecute")),r){if(r.clearListeners(),this.registerHandlerImpl("fullScreenChange",(e=>r.addEventListener("fullScreenChange",e)),"eventDispatch.fullScreenChange"),this.registerHandlerImpl("focusEnter",(e=>r.addEventListener("focusEnter",(t=>{let i=t;i.data="boolean"!=typeof t.data?t.data:[t.data],e(i)}))),"eventDispatch.focusEnter",!0),r.appButtonService){const e=r.appButtonService;e.clearListeners(),this.registerHandlerImpl("appButtonClick",(t=>e.addEventListener("click",t)),"eventDispatch.appButtonClick"),this.registerHandlerImpl("appButtonHoverEnter",(t=>e.addEventListener("hoverEnter",t)),"eventDispatch.appButtonHoverEnter"),this.registerHandlerImpl("appButtonHoverLeave",(t=>e.addEventListener("hoverLeave",t)),"eventDispatch.appButtonHoverLeave")}if(r.configService){const e=r.configService;e.clearListeners(),this.registerHandlerImpl("changeSettings",(t=>e.addEventListener("changeSettings",t)),"eventDispatch.changeSettings"),e.addEventListener("settings.save",(e=>{this.logEventDispatchScenario("eventDispatch.settings.save"),this.appSdkHost.sendRequestMessage("settings.save",e.data?[e.data]:[])})),e.addEventListener("settings.remove",(e=>{this.logEventDispatchScenario("eventDispatch.settings.remove"),this.appSdkHost.sendRequestMessage("settings.remove",e.data?[e.data]:[])}))}if(r.backStackService){const e=r.backStackService;e.clearListeners(),this.registerHandlerImpl("backButton",(t=>e.addEventListener("backButton",t)),"eventDispatch.backButtonPress",!1,{eventRaiseType:"backButtonPress"})}}p&&(p.clearListeners(),this.registerHandlerImpl("remoteCamera.capableParticipantsChange",(e=>p.addEventListener("capableParticipantsChange",e)),"eventDispatch.remoteCamera.capableParticipantsChange"),this.registerHandlerImpl("remoteCamera.handlerError",(e=>p.addEventListener("handlerError",e)),"eventDispatch.remoteCamera.handlerError"),this.registerHandlerImpl("remoteCamera.deviceStateChange",(e=>p.addEventListener("deviceStateChange",e)),"eventDispatch.remoteCamera.deviceStateChange"),this.registerHandlerImpl("remoteCamera.sessionStatusChange",(e=>p.addEventListener("sessionStatusChange",e)),"eventDispatch.remoteCamera.sessionStatusChange")),s&&this.registerHandlerImpl("video.mediaStream.audioInferenceDiscardStatusChange",(e=>s.addEventListener("audioInferenceDiscardStatusChange",e)),"eventDispatch.video.mediaStream.audioInferenceDiscardStatusChange"),h&&(0,c.wr)(this.appSdkHost.getAppDefinition())&&this.registerHandlerImpl("otherApp.install",(e=>h.addEventListener("install",e)),"eventDispatch.otherApp.install"),this.registerHandlerImpl("load",(e=>{}),"eventDispatch.load"),this.registerHandlerImpl("beforeUnload",(e=>{}),"eventDispatch.beforeUnload"),this.registeredHandlers.set("currentFreeMemoryInMb",(()=>{null==i||i.addEventListener("currentFreeMemoryInMb",(e=>{var t;this.logEventDispatchScenario("eventDispatch.currentFreeMemoryInMb"),null===(t=null==n?void 0:n.auditAndRemoveCachedApps)||void 0===t||t.call(n,{currentFreeMemoryInMb:e.data,currentMemoryUsageInMb:void 0})}))})),this.registeredHandlers.set("hostMemoryConsumptionInMb",(()=>{null==i||i.addEventListener("hostMemoryConsumptionInMb",(e=>{var t;this.logEventDispatchScenario("eventDispatch.hostMemoryConsumptionInMb"),null===(t=null==n?void 0:n.auditAndRemoveCachedApps)||void 0===t||t.call(n,{currentMemoryUsageInMb:e.data,currentFreeMemoryInMb:void 0})}))})),this.registeredHandlers.set("removeAppFromCache",(()=>{null==i||i.addEventListener("removeAppFromCache",(()=>{this.logEventDispatchScenario("eventDispatch.removeAppFromCache");try{const e=this.appSdkHost.getCacheablePageInfo();null==n||n.removeAppFromCache(e,y.Wt.HostExplicitRemoval)}catch(e){this.appSdkHost.getLogger().log(a.$.Error,"RegisterHandlerMessageHandler",e)}}))}))}initHandlers(){var e,t,i;this.registerHandler(y.tz.registerHandler,((e,t,i)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return i&&(this.userSettings=i),this.isValidRegistrationType(t)&&(this.registeredHandlers.get(t)(),this.appSdkHost.saveCacheableRegistrationState(t,this.userSettings)),s.f1})))),this.cacheabilityDataService&&(null===(e=this.registeredHandlers.get("currentFreeMemoryInMb"))||void 0===e||e(),null===(t=this.registeredHandlers.get("hostMemoryConsumptionInMb"))||void 0===t||t(),null===(i=this.registeredHandlers.get("removeAppFromCache"))||void 0===i||i()),this.bootstrapRegistrationState&&this.runRegisteredHandlers(this.bootstrapRegistrationState)}isValidRegistrationType(e){return this.registeredHandlers.has(e)}runRegisteredHandlers(e){var t,i;let n;try{for(n in e)this.registeredHandlers.has(n)&&((0,w.x7)(n)&&(null===(t=e.userSettingsChange)||void 0===t?void 0:t.userSettingTypes)&&(this.userSettings=e.userSettingsChange.userSettingTypes),null===(i=this.registeredHandlers.get(n))||void 0===i||i())}catch(e){this.appSdkHost.getLogger().log(a.$.Error,"RegisterHandlerMessageHandler","failed to run registered handlers")}}registerHandlerImpl(e,t,i,n=!1,r){if(this.registeredHandlers.has(e))throw new Error("handler already registered");this.registeredHandlers.set(e,(()=>{var o;if((null==r?void 0:r.isRestrictedToFullTrustApps)&&!(null===(o=this.appSdkHost.getAppDefinition())||void 0===o?void 0:o.isFullTrust))throw(0,s.jC)(f.O4.INTERNAL_ERROR,y.u);t((t=>{var o;this.logEventDispatchScenario(i),n||null==t.data||(t.data=[t.data]),this.appSdkHost.sendRequestMessage(null!==(o=null==r?void 0:r.eventRaiseType)&&void 0!==o?o:e,t.data?t.data:[])}))}))}logEventDispatchScenario(e){var t;const i=null===(t=this.telemetryService)||void 0===t?void 0:t.createScenario(e,void 0,void 0,"unknown");null==i||i.stop()}}const jt={dependentHubServiceSelector:e=>e.remoteCameraService,messageHandlerFactory:(e,t,i)=>new $t(e,i,t)};class $t extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.remoteCameraService=i}initHandlers(){this.registerHandler(y.tz.remoteCamera.getCapableParticipants,(()=>(0,s.N8)(null,this.remoteCameraService.getCapableParticipants)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.remoteCamera.getCapableParticipants,e,t)}),this.registerHandler(y.tz.remoteCamera.requestControl,((e,t)=>(0,s.N8)(t,this.remoteCameraService.requestControl)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.remoteCamera.requestControl,e,t)}),this.registerHandler(y.tz.remoteCamera.sendControlCommand,((e,t)=>(0,s.JA)(this.remoteCameraService.sendControlCommand,t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.remoteCamera.sendControlCommand,e,t)}),this.registerHandler(y.tz.remoteCamera.terminateSession,(()=>(0,s.JA)(this.remoteCameraService.terminateSession)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.remoteCamera.terminateSession,e,t)})}}const Gt={dependentHubServiceSelector:e=>e.searchService,messageHandlerFactory:(e,t,i)=>new Zt(e,i,t)};class Zt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.searchService=i}initHandlers(){this.registerHandler(y.tz.search.unregister,(e=>(this.searchService.clearListeners(),Promise.resolve(s.f1))),{}),this.registerHandler(y.tz.search.closeSearch,(e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.searchService.closeSearch(),(0,s.PR)([!0])}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.search.closeSearch,e,t)})}}const Jt={dependentHubServiceSelector:e=>e.sharingService,messageHandlerFactory:(e,t,i)=>new Xt(e,i,t)};class Xt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.sharingService=i}initHandlers(){this.registerHandler(y.tz.sharing.shareWebContent,((e,t)=>(0,s.JA)(this.sharingService.shareWebContent,t)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.sharing.shareWebContent,e,t)}),this.registerHandler(y.tz.sharing.history.getContent,(()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.sharingService.historyService.getContent();return(0,s.PR)([null,e])}))),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.sharing.history.getContent,e,t)})}}var Kt;!function(e){e.modal="modal",e.popout="popout",e.popoutWithChat="popoutWithChat"}(Kt||(Kt={}));const Yt={dependentHubServiceSelector:e=>e.stageViewService,messageHandlerFactory:(e,t,i)=>new Qt(e,i,t)};class Qt extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.stageViewService=i}initHandlers(){this.registerHandler(y.tz.stageView.open,((e,t)=>(0,s.N8)(t,this.stageViewService.open)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.stageView.open,e,t)})}}class ei{constructor(e,t){this.stageViewService=e,this.logger=t}tryGetDataFromLink(e){var t;if(!this.stageViewService)return null;if(e.origin!=w.sB)return null;const i=e.pathname.match(ei.STAGE_VIEW_URL_REGEX);if(!i)return null;const n=i[1],r=e.searchParams.get("context");if(!r)return null;let o;try{o=JSON.parse(r)}catch(e){return null===(t=this.logger)||void 0===t||t.log(a.$.Error,"StageViewLegacyLinkHandler","There is an error parsing the URL",e),null}const s=o.contentUrl;return s?{appId:n,contentUrl:s,threadId:o.threadId||void 0,title:o.title||void 0,websiteUrl:o.websiteUrl||void 0,entityId:o.entityId||void 0,openMode:o.openMode in Kt?o.openMode:void 0,messageId:o.messageId||void 0}:null}executeData(e){return this.stageViewService.open(e)}}ei.STAGE_VIEW_URL_REGEX=/^\/l\/stage\/([^\/]+)\/?0$/;class ti extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.stageViewSelfService=i}initHandlers(){this.registerHandler(y.tz.stageView.self.close,(e=>(0,s.N8)(null,this.stageViewSelfService.close)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.stageView.self.close,e,t)})}}const ii=(0,s.jC)(f.O4.INTERNAL_ERROR,"Invalid store dialog size"),ni={dependentHubServiceSelector:e=>e.storeService,messageHandlerFactory:(e,t,i)=>new ai(e,i,t)},ri=e=>"string"==typeof e,oi=e=>Array.isArray(e)&&e.every(ri);class ai extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.storeService=i}initHandlers(){this.registerHandler(y.tz.store.openAppDetail,this.handleAppDetailDialog,{isRestrictedToMicrosoftOwnedOrFullTrustApps:!0,errorCallback:(e,t)=>(0,s.eZ)(y.tz.store.openAppDetail,e,t)}),this.registerHandler(y.tz.store.openFullStore,this.handleFullStore,{isRestrictedToMicrosoftOwnedOrFullTrustApps:!0,errorCallback:(e,t)=>(0,s.eZ)(y.tz.store.openFullStore,e,t)}),this.registerHandler(y.tz.store.openInContextStore,this.handleInContextStoreDialog,{isRestrictedToMicrosoftOwnedOrFullTrustApps:!0,errorCallback:(e,t)=>(0,s.eZ)(y.tz.store.openInContextStore,e,t)}),this.registerHandler(y.tz.store.openSpecificStore,this.handleSpecificStoreDialog,{isRestrictedToMicrosoftOwnedOrFullTrustApps:!0,errorCallback:(e,t)=>(0,s.eZ)(y.tz.store.openSpecificStore,e,t)})}handleAppDetailDialog(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!i)throw(0,s.jC)(f.O4.INVALID_ARGUMENTS,"appId is required for AppDetail dialog");const e=t?this.parseAndValidateDialogSize(t):void 0;return yield this.storeService.openAppDetail({appId:new Ae.l(i),size:e}),(0,s.PR)()}))}handleFullStore(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=t?this.parseAndValidateDialogSize(t):void 0;return yield this.storeService.openFullStore({size:e}),(0,s.PR)()}))}handleInContextStoreDialog(e,t,i,r,o,a){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(void 0!==i&&!ri(i))throw(0,s.jC)(f.O4.INVALID_ARGUMENTS,"invalid appCapability.");if(void 0!==r&&!oi(r))throw(0,s.jC)(f.O4.INVALID_ARGUMENTS,"invalid appMetaCapabilities.");if(void 0!==o&&!ri(o))throw(0,s.jC)(f.O4.INVALID_ARGUMENTS,"invalid installationScope.");if(void 0!==a&&!oi(a))throw(0,s.jC)(f.O4.INVALID_ARGUMENTS,"invalid filteredOutAppIds.");const e=t?this.parseAndValidateDialogSize(t):void 0,n={appCapability:i,appMetaCapabilities:r,installationScope:o,filteredOutAppIds:null==a?void 0:a.map((e=>new Ae.l(e))),size:e};return yield this.storeService.openInContextStore(n),(0,s.PR)()}))}handleSpecificStoreDialog(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!i)throw(0,s.jC)(f.O4.INVALID_ARGUMENTS,"collectionId is required for SpecificStore dialog");const e=t?this.parseAndValidateDialogSize(t):void 0;return yield this.storeService.openSpecificStore({collectionId:i,size:e}),(0,s.PR)()}))}parseAndValidateDialogSize(e){const t=JSON.parse(e),{width:i,height:n}=t||{};if("number"==typeof i&&i<0)throw ii;if("number"==typeof n&&n<0)throw ii;return{width:i,height:n}}}class si extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.joinedTeamsService=i}initHandlers(){this.registerHandler(y.tz.teams.fullTrust.joinedTeams.getUserJoinedTeams,((e,t)=>(0,s.JA)(this.joinedTeamsService.getUserJoinedTeams,t)),{isRestrictedToFullTrustApps:!0})}validateDependencies(){if(!this.joinedTeamsService)throw"No joinedTeamsService provided"}}class li extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.fullTrustService=i}initHandlers(){this.registerHandler(y.tz.teams.fullTrust.getConfigSetting,((e,t)=>(0,s.JA)(this.fullTrustService.getConfigSetting,t)),{isRestrictedToFullTrustApps:!0})}validateDependencies(){if(!this.fullTrustService)throw"No fullTrustService provided"}}const di={dependentHubServiceSelector:e=>e.teamsService,messageHandlerFactory:(e,t,i)=>new ci(e,i,t)};class ci extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.teamsService=i}initHandlers(){this.registerHandler(y.tz.teams.getTeamChannels,((e,t)=>(0,s.N8)(t,this.teamsService.getTeamChannels)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.teams.getTeamChannels,e,t),isRestrictedToFullTrustApps:!1}),this.registerHandler(y.tz.teams.refreshSiteUrl,((e,t)=>(0,s.N8)(t,this.teamsService.refreshSiteUrl)),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.teams.refreshSiteUrl,e,t),isRestrictedToFullTrustApps:!1})}}const pi={dependentHubServiceSelector:e=>e.thirdPartyCloudStorageService,messageHandlerFactory:(e,t,i)=>new ui(e,i,t)};class ui extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.thirdPartyCloudStorageService=i}initHandlers(){this.registerHandler(y.tz.thirdPartyCloudStorageService.getDragAndDropFiles,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return yield this.thirdPartyCloudStorageService.getDragAndDropFiles(t,(t=>this.callGetDragAndDropFiles((0,A.Yj)(e.data),t))),s.f1}))),{errorCallback:(e,t)=>(0,s.eZ)(y.tz.thirdPartyCloudStorageService.getDragAndDropFiles,e,t)})}callGetDragAndDropFiles(e,t){return t.fileChunk?(this.appSdkHost.postResponseToApp(e,[t],t.fileChunk.chunkSequence>0),Promise.resolve()):Promise.reject("Received an empty file chunk from the host")}}class hi extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.mediaStreamService=i}initHandlers(){this.registerHandler(y.tz.video.mediaStream.registerForVideoFrame,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.mediaStreamService.addEventListener("setFrameProcessTimeLimit",(e=>{this.appSdkHost.sendRequestMessage(y.tz.video.setFrameProcessTimeLimit,[e.data])})),(yield this.mediaStreamService.registerForVideoFrame(t))&&this.mediaStreamService.addEventListener("mediaStreamChangedEvent",(e=>{const{streamId:t,metadataInTexture:i}=e.data;t&&this.appSdkHost.sendRequestMessage(y.tz.video.startVideoExtensibilityVideoStream,[{streamId:t,metadataInTexture:i}])})),s.f1}))))}validateDependencies(){if(!this.mediaStreamService)throw new Error("No mediaStreamService provided")}}var gi,vi,mi;!function(e){e.EffectChanged="EffectChanged",e.EffectDisabled="EffectDisabled"}(gi||(gi={})),function(e){e.Fatal="fatal",e.Warn="warn"}(vi||(vi={})),function(e){e.NV12="NV12"}(mi||(mi={}));const Si={dependentHubServiceSelector:e=>e.videoExtensibilityService,messageHandlerFactory:(e,t,i)=>new fi(e,i,t)};class fi extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.videoExtensibilityService=i}initHandlers(){this.registerHandler(y.tz.video.registerForVideoEffect,(e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.videoExtensibilityService.addEventListener("videoEffectToApply",(e=>{const t=[e.data.effectId];e.data.effectParameter&&t.push(e.data.effectParameter),this.appSdkHost.sendRequestMessage(y.tz.video.effectParameterChange,t)})),this.videoExtensibilityService.registerForVideoEffect(),s.f1})))),this.registerHandler(y.tz.video.videoEffectChanged,((e,t,i,r)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.videoExtensibilityService.videoEffectPickedInVideoApp(t,i,r),s.f1})))),this.registerHandler(y.tz.video.videoEffectReadiness,((e,t,i,r,o)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.videoExtensibilityService.setVideoEffectAppliedResult(t,i,r,o),s.f1})))),this.registerHandler(y.tz.video.personalizedEffectsChanged,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.videoExtensibilityService.personalizedEffectsChanged(t),s.f1})))),this.registerHandler(y.tz.video.notifyError,((e,t,i)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.videoExtensibilityService.notifyError(t,i||vi.Warn),s.f1})))),this.registerHandler(y.tz.video.performance.firstFrameProcessed,((e,t,i,r)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=parseInt(t);if(isNaN(e))throw new Error("Invalid firstFrameProcessed timestamp");return this.videoExtensibilityService.firstFrameProcessed(parseInt(t),i,r),s.f1})))),this.registerHandler(y.tz.video.performance.frameProcessingSlow,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.videoExtensibilityService.frameProcessingSlow(t),s.f1})))),this.registerHandler(y.tz.video.performance.performanceDataGenerated,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.videoExtensibilityService.performanceDataGenerated(t),s.f1})))),this.registerHandler(y.tz.video.performance.textureStreamAcquired,((e,t,i)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.videoExtensibilityService.textureStreamAcquired(t,i),s.f1}))))}validateDependencies(){if(!this.videoExtensibilityService.mediaStreamService&&!this.videoExtensibilityService.sharedFrameService)throw new Error("Either mediaStreamService or sharedFrameService should be provided")}}class Ai extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.sharedFrameService=i}initHandlers(){this.registerHandler(y.tz.video.sharedFrame.registerForVideoFrame,((e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.sharedFrameService.addEventListener("setFrameProcessTimeLimit",(e=>{this.appSdkHost.sendRequestMessage(y.tz.video.setFrameProcessTimeLimit,[e.data])})),(yield this.sharedFrameService.registerForVideoFrame(t))&&this.sharedFrameService.addEventListener("ipcChangedEvent",(e=>{const{frameProcessedEventName:t,frameReadyEventName:i,sharedMemoryName:n}=e.data;this.appSdkHost.sendRequestMessage(y.tz.video.videoExtensibilityIpcChangedEvent,[{frameProcessedEventName:t,frameReadyEventName:i,sharedMemoryName:n}])})),s.f1}))))}validateDependencies(){if(!this.sharedFrameService)throw new Error("No sharedFrameService provided")}}const Ci={dependentHubServiceSelector:e=>e.webStorageService,messageHandlerFactory:(e,t,i)=>new Ii(e,i,t)};class Ii extends b.R{constructor(e,t,i){super(e,t),this.appSdkHost=e,this.telemetryService=t,this.webStorageService=i}initHandlers(){this.registerHandler(y.tz.webStorage.isWebStorageClearedOnUserLogOut,(()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return(0,s.PR)(yield this.webStorageService.isWebStorageClearedOnUserLogOut())}))),{errorCallback:(e,t)=>(0,s.M5)(y.tz.webStorage.isWebStorageClearedOnUserLogOut,e,t)})}}const yi=[R,D,z,U,B,$,J,Q,te,He,Ce,Ne,Le,Ve,je,Xe,it,rt,st,ht,vt,ft,Ct,bt,Tt,Dt,xt,Ht,Mt,Nt,Bt,jt,Gt,Jt,Yt,ni,di,pi,Si,Ci];class Ei extends W.B{constructor(e,t,i,n,r,o,a,s){var l,d,c,p,u,h,g,v,m,S,f,A,C,I,y,b,R;super(e),this.appSdkHost=e,this.hubServices=t,this.telemetryService=i,this.messageHandlers=[];const T=new Ye([new x(t.appInstallDialogService),new et(t.pageService),new q(t.calendarService),new Z(t.callService),new K(t.chatService),new ei(t.stageViewService,e.getLogger())]);for(const n of yi)if(Je(n)){const r=n.dependentHubServiceSelector(t);void 0!==r&&this.messageHandlers.push(n.messageHandlerFactory(e,r,i))}else this.messageHandlers.push(n.messageHandlerFactory(e,i));this.messageHandlers.push(new Qe(e,i,t.linkService,T)),this.messageHandlers.push((0,E.n)(e,t,i,r,o,a,s)),this.messageHandlers.push(new qt(e,i,null===(l=t.lifecycleService)||void 0===l?void 0:l.cacheabilityDataService,t.cacheManagementService,t.pageService,t.logService,null===(d=t.videoExtensibilityService)||void 0===d?void 0:d.mediaStreamService,t.meetingService,t.meetingRoomService,t.remoteCameraService,t.searchService,t.otherAppStateChangeService,n)),this.messageHandlers.push(new oe(e,i,null===(c=t.copilotService)||void 0===c?void 0:c.customTelemetryService)),this.messageHandlers.push(new ne(e,i,null===(p=t.copilotService)||void 0===p?void 0:p.eligibilityService)),this.messageHandlers.push(new Ze(e,i,null===(u=t.hostEntityService)||void 0===u?void 0:u.tabService)),this.messageHandlers.push(new ti(e,i,null===(h=t.stageViewService)||void 0===h?void 0:h.selfService)),this.messageHandlers.push(new _t(e,i,null===(g=t.pageService)||void 0===g?void 0:g.tabsService)),this.messageHandlers.push(new Ft(e,i,null===(v=t.pageService)||void 0===v?void 0:v.configService)),this.messageHandlers.push(new Lt(e,i,null===(m=t.pageService)||void 0===m?void 0:m.fullTrustService)),this.messageHandlers.push(new zt(e,i,null===(S=t.pageService)||void 0===S?void 0:S.backStackService)),this.messageHandlers.push(new li(e,i,null===(f=t.teamsService)||void 0===f?void 0:f.fullTrustService)),this.messageHandlers.push(new si(e,i,null===(C=null===(A=t.teamsService)||void 0===A?void 0:A.fullTrustService)||void 0===C?void 0:C.joinedTeamsService)),this.messageHandlers.push(new le(e,i,t.dialogService,r)),this.messageHandlers.push(new de(e,i,null===(I=t.dialogService)||void 0===I?void 0:I.updateService)),this.messageHandlers.push(new at(e,i,null===(y=t.mailService)||void 0===y?void 0:y.handoffService)),this.messageHandlers.push(new yt(e,i,t.messageChannelsService)),this.messageHandlers.push(new Et(e,i,t.messageChannelsService)),this.messageHandlers.push(new hi(e,i,null===(b=t.videoExtensibilityService)||void 0===b?void 0:b.mediaStreamService)),this.messageHandlers.push(new Ai(e,i,null===(R=t.videoExtensibilityService)||void 0===R?void 0:R.sharedFrameService)),this.messageHandlers.forEach((e=>e.initHandlers()))}tryCustomProcessing(e){return this.hubServices.customMessageService?this.hubServices.customMessageService.tryProcessMessage(e,this.appSdkHost.postMessageToFrame.bind(this.appSdkHost)):super.tryCustomProcessing(e)}}var bi=i(35574),Ri=i(90850),Ti=i(80378);class wi extends Ti.X{constructor(e,t,i,r,o,l,d,p,h=!1){var g;super(e,i,r.authenticationService,r.logger,r.telemetryService,o),this.hostWindow=e,this.communicationBridge=t,this.context=i,this.hubServices=r,this.onAppInitStateChanged=o,this.hostVersionsInfo=l,this.isNAAChannelRecommended=d,this.hostInsecureOrigins=p,this.isCachedLaunch=h,this.isMetaOSMounted=!1,this.getIsCachedLaunch=()=>this.isCachedLaunch,this.getAppDefinition=()=>this.appDefinition,this.getOrigin=()=>this.communicationBridge.getOrigin(),this.getDisplayName=()=>{var e,t;return(null===(e=this.context.page.config)||void 0===e?void 0:e.instanceId)?null===(t=this.context.page.config)||void 0===t?void 0:t.displayName:this.appDefinition&&(0,w.L9)(this.appDefinition,this.context.page.id)},this.prefetchAuthToken=(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var i;const n=null===(i=this.telemetryService)||void 0===i?void 0:i.createScenario("preFetchAuthToken",null==t?void 0:t.id,void 0,"no_value");if(this.hubServices.authenticationService)try{const i=(0,c.T3)(t,e);if(i&&(0,c.fc)(i))return yield this.hubServices.authenticationService.acquireToken(i,void 0,!0),null==n||n.stop(),!0}catch(e){const t="Unable to prefetch token via authentication service: "+(0,s.oE)(e);this.getLogger().log(a.$.Error,"prefetchAuthToken",t,e),null==n||n.fail(t)}else{const e="Cancelled since authenticationService is not available";this.getLogger().log(a.$.Error,"prefetchAuthToken",e),null==n||n.fail(e)}return!1})),this.urlToLoad=e=>e,this.setAppInitInfo=e=>{this.checkIfCacheableAndInvoke((t=>{var i;null===(i=this.hubServices.cacheManagementService)||void 0===i||i.setAppState(t,e)})),this.onAppInitStateChanged&&this.onAppInitStateChanged(e)},this.loadCacheableRegistrationState=()=>{if(!this.hubServices.cacheManagementService)return;const e=this.getCacheablePageInfo();return e&&this.hubServices.cacheManagementService.loadBootstrapRegistrationState(e)},this.saveCacheableRegistrationState=(e,t)=>{this.checkIfCacheableAndInvoke((i=>{var n;null===(n=this.hubServices.cacheManagementService)||void 0===n||n.saveBootstrapRegistrationState(i,(0,w.YF)(e,t))}))},this.checkIfCachedAndRequestAllowed=e=>{if(!this.hubServices.cacheManagementService||!this.hubServices.cacheManagementService.isCachedAndAllowRequest)return!0;const t=this.getCacheablePageInfo();return!t||this.hubServices.cacheManagementService.isCachedAndAllowRequest(t,e)},this.unloadCachedApp=e=>{const t=this.hubServices.cacheManagementService;(null==t?void 0:t.shouldTriggerUnload(e))?(null==t||t.setAppState(e,{state:f.Jz.Unloading}),this.sendRequestMessage("beforeUnload")):null==t||t.setAppState(e,{state:f.Jz.Unloaded})},this.disposeBridge=()=>{var e,t;!(0,bi.eZ)().disableDebuggingTelemetryToAria&&u(this.telemetryService,this.communicationBridge.id,null===(e=this.appDefinition)||void 0===e?void 0:e.id),this.getLogger().log(a.$.Debug,"disposeBridge",`Disposing communication bridge. AppDefId: ${null===(t=this.appDefinition)||void 0===t?void 0:t.id}, CommunicationBridgeId: ${this.communicationBridge.id}`),this.communicationBridge.dispose()},this.checkIfCacheableAndInvoke=(e,t)=>{if(this.hubServices.cacheManagementService){const i=this.getCacheablePageInfo();i?e(i):null==t||t()}else null==t||t()},this.getCacheablePageInfo=()=>{var e;return this.appDefinition?{appId:this.appDefinition.id,entityId:this.context.page.id,displayName:this.getDisplayName(),instanceId:null===(e=this.context.page.config)||void 0===e?void 0:e.instanceId,contentUrl:this.getOrigin(),frameContext:this.getFrameContext()}:void 0},this.isMetaOSMounted=!0,this.initializeAuthenticationContext(i),t.onSdkInitialized&&t.onSdkInitialized(e),!(0,bi.eZ)().disableDebuggingTelemetryToAria&&this.createTelemetryScenarioForWebContentSdkCreated(!!t.onSdkInitialized,this.communicationBridge.id),null===(g=this.getLogger())||void 0===g||g.log(a.$.Info,"WebContentSdkService created",`WebContentSdkService:  isSdkInitialized: ${!!t.onSdkInitialized}, CommunicationBridgeId: ${this.communicationBridge.id}`)}setFrameAndLoadOrigin(e,t,i,r,o,s){var l,d;return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{let n,c=!1;(0,bi.eZ)().recreateCommBridgeListenersBeforeLoadingApp&&(null===(d=(l=this.communicationBridge).onSdkInitialized)||void 0===d||d.call(l,this.hostWindow),c=!0),(0,Ri.e5)(Ri.Ct.Start,Ri.Z1.IframeSetAndLoadOrigin),this.getLogger().log(a.$.Info,"setFrameAndLoadOrigin called",`CommBridgeListenersAdded: ${c}, AppDefinition: ${JSON.stringify(i)}, UserClickTime: ${r}, UsingCachedApp: ${o}, UserClickTimeV2: ${s}, CommunicationBridgeId: ${this.communicationBridge.id}`),!(0,bi.eZ)().disableDebuggingTelemetryToAria&&this.createTelemetryScenarioForSetFrameAndLoadOrigin(c,i,r,o,s,this.communicationBridge.id),this.isCachedLaunch=null!=o?o:this.isCachedLaunch,this.appDefinition=i,this.setAppInitInfo({state:f.Jz.Loading}),this.setInitialized(this.isCachedLaunch),this.telemetryService.setAppDefinition(i),this.telemetryService.setUsingCachedApp(this.isCachedLaunch),this.frame=e,this.setUserClickTime(r),s&&this.setUserClickTimeV2(s),this.messageProcessor&&this.messageProcessor.cleanup(),this.isCachedLaunch&&(n=this.loadCacheableRegistrationState(),this.communicationBridge.onSdkInitialized&&this.communicationBridge.onSdkInitialized(this.hostWindow));const p=yield this.getAppContext();this.prefetchAuthToken(p,i);const u=new be(this.hostInsecureOrigins,this.getAppInitializationScenario());this.messageProcessor=new Ei(this,this.hubServices,this.telemetryService,n,this.hostVersionsInfo,this.isCachedLaunch,this.isNAAChannelRecommended,u),this.load(t,p,this.isCachedLaunch)}catch(e){this.getLogger().log(a.$.Debug,"setFrameAndLoadOrigin",`Error occurred while loading origin: ${t}`),this.getLogger().log(a.$.Error,"setFrameAndLoadOrigin","An error occurred while loading URL",e),this.handleAppLoadFailure(e)}(0,Ri.e5)(Ri.Ct.End,Ri.Z1.IframeSetAndLoadOrigin),(0,Ri.e5)(Ri.Ct.End,Ri.Z1.OverallAppLoadTimeBeforeInitialize)}))}handleAppLoadFailure(e){var t,i;let n,r;e===y.jp?(n=y.Af.Validation_InvalidDomains,r=y.jp):(n=y.Af.Validation,r=y.Si),null===(t=this.getAppInitializationScenario())||void 0===t||t.fail(n,r),this.setAppInitInfo({state:f.Jz.Failed,reason:n}),null===(i=this.messageProcessor)||void 0===i||i.cleanup()}sendRequestMessage(e,t){if(this.getOrigin()&&this.frame){const i={func:e,args:t,monotonicTimestamp:(0,P.So)()};this.communicationBridge.postMessage(this.frame,i)}}sendResponseMessage(e,t,i,n,r,o){if(this.getOrigin()){const a={id:t,uuidAsString:null==i?void 0:i.toString(),args:n,isPartialResponse:r,origin:this.getOrigin(),monotonicTimestamp:(0,P.So)()};o?this.communicationBridge.postMessageWithTransferables(e,a,o):this.communicationBridge.postMessage(e,a)}}sendResponseMessageToNestedIframe(e,t,i,n,r){const o={id:e,uuidAsString:null==i?void 0:i.toString(),args:n,isPartialResponse:r,origin:t.origin,monotonicTimestamp:(0,P.So)()};this.communicationBridge.postMessageToNestedIframe(o,t)}setOrigin(e,t){this.communicationBridge.setOrigin(e,t)}postResponseToApp(e,t,i,n){if(this.frame){const r=Re(e);this.sendResponseMessage(this.frame,r.id,r.uuid,t,i,n)}}postDeeplyNestedResponseToApp(e,t,i,n){const r=Re(e);this.sendResponseMessageToNestedIframe(r.id,t,r.uuid,i,n)}postMessageToFrame(e){this.frame&&this.communicationBridge.postMessage(this.frame,e)}handleMessage(e){if(!this.messageProcessor)throw new Error("Unable to handle message. Undefined message processor");e.isDeeplyNestedRequest?this.messageProcessor.processForDeeplyNestedRequest(e):this.messageProcessor.process(e)}load(e,t,i=!1){if(!this.isMetaOSMounted)return;let n;this.frame&&this.appDefinition&&this.communicationBridge.onSetFrameAndLoadOrigin(this.frame,e,this.appDefinition,t,this.handleMessage.bind(this),i);try{n=(0,c.dA)(e,this.getLogger(),t,this.getAppDefinition())}catch(e){this.handleInvalidUrlError(t)}if(n&&this.frame)if(this.getLogger().log(a.$.Debug,"load",`origin: ${n}`),this.setOrigin(n,i),this.setAppInitInfo({state:f.Jz.WaitingForAppLoad}),i)this.sendRequestMessage("load",[{entityId:t.page.id,contentUrl:n}]);else{const e=new URL(n);this.frame.src=(0,c.Xl)(this.urlToLoad(e))}else this.handleInvalidUrlError(t)}handleInvalidUrlError(e){throw(0,bi.eZ)().wildcardValidDomainRuleDetection&&this.getAppDefinition()&&(0,c.NJ)((0,c.I)(this.getAppDefinition(),e)).length>0?y.jp:y.Si}unloadApp(e,t="unknown"){var i;if(null===(i=this.messageProcessor)||void 0===i||i.cleanup(),this.hubServices.cacheManagementService){const e=this.getCacheablePageInfo();e&&this.unloadCachedApp(e)}else super.createTelemetryScenarioForAppTermination(e,t)}unloadSDK(){var e;null===(e=this.messageProcessor)||void 0===e||e.cleanup(),this.isMetaOSMounted=!1,this.onAppInitStateChanged=void 0,this.hubServices.cacheManagementService||this.disposeBridge(),super.createTelemetryScenarioForUnloadSdk(this.communicationBridge.id)}getFrame(){return this.frame}}var Di=i(61044);class ki{constructor(e,t,i,n){this.pageInfo=e,this.communicationBridge=t,this.frameInfo=i,this.bootstrapRegistrationState=n,this.currentAppState={state:f.Jz.Loading},this.unloadingTimeoutId=0,this.unloadingTimeoutDeferred=null}loadBootstrapRegistrationState(){return this.bootstrapRegistrationState}saveBootstrapRegistrationState(e){this.bootstrapRegistrationState=Object.assign(Object.assign({},this.bootstrapRegistrationState),e)}isCached(){return this.currentAppState.state===f.Jz.Cached}}class xi{constructor(e){this.constraintsService=e,this.removeLeastRecentlyUsedAppIf=(e,t,i)=>{if(t){const t=e.shift();if(t&&t.currentAppState.state===f.Jz.Cached)return{app:t,reason:i}}}}determineAppsToRemoveBasedOnConstraints(e,t,i){const n=e.filter((e=>this.hasAppExceededMaxLifetime(e.pageInfo)));if(n.length>0){const e=n.shift();return e?[{app:e,reason:y.Wt.AppExpiration}]:[]}const r=this.removeLeastRecentlyUsedAppIf(e,void 0!==t&&!this.isFreeMemoryAboveMinimum(t),y.Wt.FreeMemoryUnderMinimum)||this.removeLeastRecentlyUsedAppIf(e,void 0!==i&&!this.isMemoryUsageWithinLimit(i),y.Wt.HostMemoryLimitExceeded)||this.removeLeastRecentlyUsedAppIf(e,!!this.constraintsService.maxAppsAllowedInCache&&e.length>this.constraintsService.maxAppsAllowedInCache,y.Wt.NumAppsExceeded);return r?[r]:[]}isMemoryUsageWithinLimit(e){return e<this.constraintsService.maxHostMemoryAllowedInMb}isFreeMemoryAboveMinimum(e){return e>this.constraintsService.minFreeDeviceMemoryInMbToCache}hasAppExceededMaxLifetime(e){const t=60*this.constraintsService.appExpirationInMinutes*1e3;return Date.now()-(e.lastAccessedTimestampInMs||0)>t}}class Oi{constructor(e,t,i){this.logger=i,this.isCached=e=>e.isCached(),this.cachedApps=[],e&&(this.cacheMonitoringService=new xi(e)),this.telemetryService=t}isAppRegisteredForCaching(e){return!!this.cacheMonitoringService&&!!e.loadBootstrapRegistrationState().load&&!!e.loadBootstrapRegistrationState().beforeUnload}getCachedCommunicationBridge(e){const t=this.getCachedApp(e);return t&&this.isAppRegisteredForCaching(t)?t.communicationBridge:void 0}updateServices(e,t,i){this.cacheMonitoringService=e?new xi(e):void 0,t&&(this.telemetryService=t),i&&(this.logger=i)}runAppTerminateTelemetryScenario(e,t,i,n,r="monotonic"){var o;const a=null===(o=this.telemetryService)||void 0===o?void 0:o.createScenario("appTermination",e,t,void 0,r);a.addOrUpdateActivityDataField(l.u7.CACHEDAPP_IND_FIELD_NAME,n||!0),a.addOrUpdateActivityDataField(l.u7.APP_TERMINATE_REASON,i),a.stop()}auditAndRemoveCachedApps({currentFreeMemoryInMb:e,currentMemoryUsageInMb:t}){this.cacheMonitoringService&&this.cacheMonitoringService.determineAppsToRemoveBasedOnConstraints(this.getCachedApps(),e,t).forEach((e=>{this.removeAppFromCache(e.app.pageInfo,e.reason)}))}addAppToCache(e,t,i){const n=new ki(e,t,i,{});return this.cachedApps.push(n),n}removeAppFromCache(e,t){const i=this.getCachedApp(e);if(i){this.cachedApps.splice(this.cachedApps.indexOf(i),1);const n=(0,P.qV)("monotonic");this.runAppTerminateTelemetryScenario(e.appId,n.value,t,!0,n.type),this.disposeCachedApps([i])}}getCachedApps(){return this.cachedApps.filter(this.isCached)}getCachedApp(e){if(!e.frameContext||e.frameContext===A.E2.content)return this.cachedApps.find((t=>t.pageInfo.appId===e.appId))}shouldDisplayLoadingUI(e,t,i){if(!t&&!i)return!1;const n=e.state;return n===f.Jz.Loading||n===f.Jz.WaitingForAppLoad}disposeCachedApps(e){var t,i,n;for(const r of e)null===(t=r.communicationBridge)||void 0===t||t.dispose(),u(this.telemetryService,null===(i=r.communicationBridge)||void 0===i?void 0:i.id,r.pageInfo.appId),null===(n=r.frameInfo)||void 0===n||n.remove(),r.unloadingTimeoutDeferred&&(r.unloadingTimeoutDeferred.reject(new Error("Unloading timeout")),r.unloadingTimeoutDeferred=null)}logTelemetryForAppStateChange(e,t){var i,n;const r=null===(i=this.telemetryService)||void 0===i?void 0:i.createScenario("appStateUpdated",e);null===(n=null==r?void 0:r.addOrUpdateActivityDataField)||void 0===n||n.call(r,l.u7.APP_STATE_UPDATED,t),null==r||r.stop()}handleUnloading(e,t){e.unloadingTimeoutId||(this.startAppSuspendScenario(t.appId),e.unloadingTimeoutId=window.setTimeout((()=>{this.failAppSuspendScenario(y.Wt.AppUnloadTimeout),this.removeAppFromCache(t,y.Wt.AppUnloadTimeout)}),15e3))}setAppState(e,t){var i,n;const r=this.getCachedApp(e);if(r&&(t.state!==f.Jz.Loaded||r.currentAppState.state===f.Jz.WaitingForAppLoad)&&(t.state!==f.Jz.Unloaded||(e=>e===f.Jz.Unloading||e===f.Jz.Loaded||e===f.Jz.Loading||e===f.Jz.WaitingForAppLoad||e===f.Jz.Failed)(r.currentAppState.state))){switch(t.state){case f.Jz.Unloaded:r.unloadingTimeoutId&&window.clearTimeout(r.unloadingTimeoutId),r.unloadingTimeoutId=0,this.stopAppSuspendScenario(),(null==r?void 0:r.unloadingTimeoutDeferred)&&(r.unloadingTimeoutDeferred.resolve(!0),r.unloadingTimeoutDeferred=null),r.communicationBridge.dispose(),u(this.telemetryService,null===(i=r.communicationBridge)||void 0===i?void 0:i.id,r.pageInfo.appId),this.isAppRegisteredForCaching(r)?(r.currentAppState.state=f.Jz.Cached,r.pageInfo.lastAccessedTimestampInMs=Date.now()):this.removeAppFromCache(e,y.Wt.AppDidNotRegisterForCaching),this.auditAndRemoveCachedApps({currentFreeMemoryInMb:void 0,currentMemoryUsageInMb:void 0});break;case f.Jz.Unloading:r.currentAppState=t,this.handleUnloading(r,e);break;case f.Jz.Failed:r.currentAppState.state===f.Jz.Cached||(r.currentAppState=t),this.removeAppFromCache(e,t.reason);break;case f.Jz.Loaded:r.currentAppState=t,this.updateAppRecency(e);break;default:r.currentAppState=t}null===(n=this.logger)||void 0===n||n.log(a.$.Info,"AppStateChange",`Logging telemetry for app state change. AppId: ${r.pageInfo.appId}, NewState: ${t.state}`),!(0,bi.eZ)().disableDebuggingTelemetryToAria&&this.logTelemetryForAppStateChange(r.pageInfo.appId,t.state)}}updateAppRecency(e){const t=this.cachedApps.findIndex((t=>t.pageInfo.appId===e.appId));if(-1!==t){const[e]=this.cachedApps.splice(t,1);this.cachedApps.push(e)}}isAppLoading(e){return e.currentAppState.state===f.Jz.Loading}shouldTriggerUnload(e){var t;const i=this.getCachedApp(e);return!!i&&!this.isAppLoading(i)&&!!(null===(t=i.loadBootstrapRegistrationState())||void 0===t?void 0:t.beforeUnload)}loadBootstrapRegistrationState(e){const t=this.getCachedApp(e);return t?t.loadBootstrapRegistrationState():void 0}saveBootstrapRegistrationState(e,t){var i;null===(i=this.getCachedApp(e))||void 0===i||i.saveBootstrapRegistrationState(t)}startAppSuspendScenario(e){var t;this.appSuspendOrTerminateScenario=null===(t=this.telemetryService)||void 0===t?void 0:t.createScenario("appSuspend",e)}stopAppSuspendScenario(){var e;null===(e=this.appSuspendOrTerminateScenario)||void 0===e||e.stop(),this.appSuspendOrTerminateScenario=void 0}failAppSuspendScenario(e){var t;null===(t=this.appSuspendOrTerminateScenario)||void 0===t||t.fail(e),this.appSuspendOrTerminateScenario=void 0}}const Fi=(0,Di.Pf)(void 0,(()=>{const[e,t]=(0,r.useState)(),[i,n]=(0,r.useState)(void 0),[o,a]=(0,r.useState)(void 0),[s,l]=(0,r.useState)(void 0);return(0,r.useEffect)((()=>{var n,r;if(!e&&i){const e=new Oi(null===(n=i.cacheabilityDataService)||void 0===n?void 0:n.constraints,o,s);t(e)}else e&&i&&e.updateServices(null===(r=i.cacheabilityDataService)||void 0===r?void 0:r.constraints,o,s)}),[e,i,o,s]),{cacheManagementService:e,setLifecycleService:n,setTelemetryService:a,setLogger:l}})),Hi={media:["camera","microphone"],geolocation:["geolocation"],midi:["midi"]};var Pi=i(11154),_i=i(62120),zi=i(7940),Li=i(3703),Mi=i(15639),Ui=i(69036),Ni=i(62013),Wi=i(95306),Bi=i(62935);const Vi=({reason:e,hubUiService:t})=>{const i=qi(),n=t.getErrorUiData(e),[o,a]=r.useState(!0);return r.createElement(Pi.q,null,r.createElement("div",{id:"hubBubbleErrorUI",style:{display:o?"flex":"none"},className:i.root},r.createElement("div",{className:i.contentContainer},r.createElement(Wi.xEh,{className:i.warning,color:_i.L.colorStatusWarningBackground3}),r.createElement("div",{className:i.textContainer},r.createElement(zi.W,null,n.localizedErrorStrings.bubbleHeading),r.createElement(Li.M,null,n.localizedErrorStrings.bubbleSubtitle)),r.createElement(Bi.p4K,{className:i.dismiss,"aria-label":"Dismiss warning bubble",onClick:()=>{a(!1)}})),r.createElement("div",{className:i.buttonContainer},n.openDesktopApp&&r.createElement(Mi.$,{"aria-label":n.localizedErrorStrings.openInDesktopAltText,onClick:()=>{var e;return null===(e=n.openDesktopApp)||void 0===e?void 0:e.call(n)}},n.localizedErrorStrings.openInDesktopButtonTitle),n.openBrowser&&r.createElement(Mi.$,{"aria-label":n.localizedErrorStrings.openInWebBrowserAltText,onClick:()=>{var e;return null===(e=n.openBrowser)||void 0===e?void 0:e.call(n)}},n.localizedErrorStrings.openInWebBrowserButtonTitle),n.openLegacyUrl&&r.createElement(Mi.$,{"aria-label":n.localizedErrorStrings.openInLegacyBrowserAltText,onClick:()=>{var e;return null===(e=n.openLegacyUrl)||void 0===e?void 0:e.call(n)}},n.localizedErrorStrings.openInLegacyBrowserButtonTitle))))},qi=(0,Ui.n)({root:Object.assign(Object.assign(Object.assign({flexDirection:"column",alignItems:"center",textAlign:"center",rowGap:"1em",backgroundColor:_i.L.colorStatusWarningBackground1},Ni.Pt.border("1px","solid",_i.L.colorStatusWarningBorder1)),Ni.Pt.padding("1em")),Ni.Pt.borderRadius(_i.L.borderRadiusLarge)),contentContainer:{width:"100%",display:"flex",flexDirection:"row",justifyContent:"space-between"},textContainer:Object.assign(Object.assign(Object.assign({},Ni.Pt.margin("0","1em")),Ni.Pt.gap("0.5em")),{display:"flex",textAlign:"start"}),buttonContainer:Object.assign({display:"flex",marginLeft:"auto"},Ni.Pt.gap("1em")),warning:{minWidth:"2em"},dismiss:{minWidth:"2em",marginLeft:"auto"}});var ji=i(76053),$i=i(31410),Gi=i(43403),Zi=i(57964);const Ji=({reason:e,hubUiService:t})=>{var i,n,o,a,s;const l=Xi(),d=t.getErrorUiData(e);return r.createElement(Pi.q,{id:"hubErrorUi",className:l.root},r.createElement("div",{className:l.imageContainer,"aria-label":null===(i=d.errorImage)||void 0===i?void 0:i.altText},"string"==typeof(null===(n=d.errorImage)||void 0===n?void 0:n.image)?r.createElement(ji._,{src:null===(o=d.errorImage)||void 0===o?void 0:o.image,alt:null===(a=d.errorImage)||void 0===a?void 0:a.altText}):null===(s=d.errorImage)||void 0===s?void 0:s.image),r.createElement($i.K,null,d.localizedErrorStrings.errorHeading),r.createElement(Gi.j,null,d.localizedErrorStrings.errorSubtitle),r.createElement("div",{className:l.buttonContainer},d.openDesktopApp&&r.createElement(Mi.$,{"aria-label":d.localizedErrorStrings.openInDesktopAltText||d.localizedErrorStrings.openInDesktopButtonTitle,appearance:"primary",onClick:()=>{var e;return null===(e=d.openDesktopApp)||void 0===e?void 0:e.call(d)}},d.localizedErrorStrings.openInDesktopButtonTitle||d.localizedErrorStrings.openInDesktopAltText),d.openBrowser&&r.createElement(Mi.$,{"aria-label":d.localizedErrorStrings.openInWebBrowserAltText||d.localizedErrorStrings.openInWebBrowserButtonTitle,onClick:()=>{var e;return null===(e=d.openBrowser)||void 0===e?void 0:e.call(d)}},d.localizedErrorStrings.openInWebBrowserButtonTitle),d.openLegacyUrl&&r.createElement(Mi.$,{"aria-label":d.localizedErrorStrings.openInLegacyBrowserAltText||d.localizedErrorStrings.openInLegacyBrowserButtonTitle,onClick:()=>{var e;return null===(e=d.openLegacyUrl)||void 0===e?void 0:e.call(d)}},d.localizedErrorStrings.openInLegacyBrowserButtonTitle),d.retry&&r.createElement(Mi.$,{appearance:"transparent",icon:r.createElement(Zi.CDe,null),"aria-label":d.localizedErrorStrings.retryButtonAltText||d.localizedErrorStrings.retryButtonTitle,onClick:d.retry},d.localizedErrorStrings.retryButtonTitle)))},Xi=(0,Ui.n)({root:{display:"flex",height:"100%",width:"100%",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",rowGap:"1em"},buttonContainer:{marginTop:"2em",display:"flex",rowGap:".5em",flexDirection:"column",alignItems:"center","> button":{width:"100%"}},imageContainer:{width:"auto",maxHeight:"33%"}});let Ki;const Yi=Date.now(),Qi=e=>{var t;(0,Ri.e5)(Ri.Ct.Start,Ri.Z1.OverallAppLoadTimeBeforeInitialize),(0,Ri.e5)(Ri.Ct.Start,Ri.Z1.MetaOsAppContainerInitiation);const i=e.context.page.frameContext;if(e.context.dialogParameters&&"task"!==i)throw new Error('dialogParameters should be provided only in "task" frameContext');let o=e.hubServices;const s=Fi();r.useEffect((()=>{null==s||s.setLifecycleService(o.lifecycleService)}),[s,o.lifecycleService]),Ki=null==s?void 0:s.cacheManagementService,o.lifecycleService&&(o=Object.assign(Object.assign({},e.hubServices),{cacheManagementService:e.hubServices.cacheManagementService||Ki}));const[l,d]=r.useState(!1),c=r.useMemo((()=>{var t,n;return null!==(n=null===(t=e.isolationProvider)||void 0===t?void 0:t.communicationBridge)&&void 0!==n?n:en({appId:e.appDefinition.id,frameContext:i},e.hubServices.logger)}),[null===(t=e.isolationProvider)||void 0===t?void 0:t.communicationBridge,e.contentUrl,e.appDefinition.id,e.hubServices.logger,Ki]),p=(()=>{const[t,i]=r.useState(void 0);return(()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){(0,Ri.e5)(Ri.Ct.Start,Ri.Z1.GetPermissions);const t=yield(()=>nn(e.hubServices.devicePermissionService))();(0,Ri.e5)(Ri.Ct.End,Ri.Z1.GetPermissions);const n=t.map((e=>Hi[e.permission])).flat().concat(["autoplay; clipboard-write"]).join("; ");i(n)}))})(),t})();if(e.hostVersionsInfo&&e.hostVersionsInfo.adaptiveCardSchemaVersion&&(0,w.Hk)(e.hostVersionsInfo.adaptiveCardSchemaVersion))throw new Error(`dialogService.cardService requires that the host specifies an adaptive card version of at least ${(0,w.Zn)()}`);if((o.locationService||o.barCodeService)&&!o.devicePermissionService)throw new Error("devicePermissionService needs to be provided if any of following services is provided: locationService, barCodeService");e.featureFlags&&(0,bi.Eh)(e.featureFlags);const{appHostSdk:u,appInitInfo:h}=((e,t,i,n,o,a,s,l,d)=>{const[c,p]=r.useState({state:f.Jz.Unknown});return r.useEffect((()=>{c.state===f.Jz.Failed&&p({state:f.Jz.Unknown})}),[n]),{appHostSdk:r.useMemo((()=>new wi(e,o,t,i,p,a,s,l,d)),[e,t.page.frameContext,p,t.app.host.clientType,i.cacheManagementService,o,s,l]),appInitInfo:c}})(e.hostWindow,e.context,o,e.appDefinition,c,e.hostVersionsInfo,e.isNAAChannelRecommended,e.hostInsecureOrigins,e.isCachedLaunch);r.useEffect((()=>{null==s||s.setTelemetryService(u.getTelemetryService()),null==s||s.setLogger(u.getLogger())}),[u,s]);const g=e.context.app.theme;r.useEffect((()=>{g&&(u.onThemeChanged&&u.onThemeChanged(g),u.onUserSettingsChanged&&u.onUserSettingsChanged(A.hn.theme,g))}),[u,g]);const v=e.context.app.userFileOpenPreference;r.useEffect((()=>{v&&u.onUserSettingsChanged&&u.onUserSettingsChanged(A.hn.fileOpenPreference,v)}),[u,v]),r.useEffect((()=>{u.initializeAuthenticationContext(e.context)}),[u,e.context]),r.useEffect((()=>function(){u.unloadSDK()}),[u]);const[S,E]=r.useState((0,w.Xs)(h,e.appDefinition.showLoadingIndicator));r.useEffect((()=>{E((0,w.Xs)(h,e.appDefinition.showLoadingIndicator))}),[h,e.appDefinition]),r.useEffect((()=>{S&&h.state===f.Jz.Loaded&&e.hubServices.logger.log(a.$.Warn,"Error Bubble Reason",y.f)}),[h.state,e.hubServices.logger,S]);const b=tn(e.appDefinition.showLoadingIndicator,o,h,u.getIsCachedLaunch(),u.getCacheablePageInfo()),R=r.useCallback((()=>nn(e.hubServices.devicePermissionService)),[e.hubServices.devicePermissionService]),T=r.useCallback((()=>S?r.createElement(Vi,{reason:h.reason,hubUiService:e.hubServices.hubUiService}):null),[S,h,e.hubServices.hubUiService]),D=r.useCallback((()=>{var t;if(!((e,t,i,n)=>!!t||void 0!==e&&!(i&&!n))(p,e.isolationProvider,o.lifecycleService,o.cacheManagementService))return null;const n=Object.assign(Object.assign({},e),{sdkHost:u,isLoading:b,frameContext:i,userClickTime:null!==(t=e.context.app.userClickTime)&&void 0!==t?t:Yi,userClickTimeV2:e.context.app.userClickTimeV2,communicationBridge:c,getRequiredPermissions:R,allowList:p});return e.isolationProvider?r.createElement(I,{isolationProvider:e.isolationProvider,hostProps:n,errorUI:T,appHostSdk:u}):r.createElement("div",{id:"default-app-host-container",style:{flex:1,display:"flex",flexDirection:"column"}},T(),o.cacheManagementService&&o.lifecycleService&&i===A.E2.content?r.createElement(C,Object.assign({cacheManagementService:o.cacheManagementService},n,{allowList:p,setIsUnLoading:d})):r.createElement(m,Object.assign({},n)))}),[p,u,c,i,R,o.cacheManagementService,o.lifecycleService,b,e,T]),k=r.useMemo((()=>D()),[D]);if((0,w.OL)(h,e.appDefinition.showLoadingIndicator)){const t=u.getTelemetryService().createScenario("errorScreenLoad"),i=h.reason;return t.fail(i),e.hubServices.logger.log(a.$.Error,"Show HubError UI",i),r.createElement(Ji,{reason:i,hubUiService:e.hubServices.hubUiService})}return(0,Ri.e5)(Ri.Ct.End,Ri.Z1.MetaOsAppContainerInitiation),r.createElement(r.Fragment,null,(b||l)&&o.hubUiService.getLoadingUi(),k)},en=(e,t)=>{var i;return null!==(i=null==Ki?void 0:Ki.getCachedCommunicationBridge(e))&&void 0!==i?i:new p(t)},tn=(e,t,i,n,r)=>t.cacheManagementService?t.cacheManagementService.shouldDisplayLoadingUI(i,e,n,r):!(!e||i.state!==f.Jz.Loading&&i.state!==f.Jz.WaitingForAppLoad),nn=e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){let t;return t=e?yield e.storageService.getPermissions():[],t.filter((e=>e.status==M.W.Consented))}))},87353:(e,t,i)=>{var n;i.d(t,{A:()=>d});var r=new Uint8Array(16);function o(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}for(var a=i(23145),s=[],l=0;l<256;++l)s.push((l+256).toString(16).substr(1));const d=function(e,t,i){var n=(e=e||{}).random||(e.rng||o)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase();if(!(0,a.A)(i))throw TypeError("Stringified UUID is invalid");return i}(n)}},23145:(e,t,i)=>{i.d(t,{A:()=>r});const n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,r=function(e){return"string"==typeof e&&n.test(e)}},72672:e=>{e.exports={rE:"6.3.0"}}}]);
//# sourceMappingURL=vendors-b6bdc8b1.e8a0cc5f995f8ff17a78.js.map